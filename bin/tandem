#!/usr/bin/env node
var createApp = require('../lib/@tandem/back-end/server').create;

var argv = require('yargs').argv;
var path = require('path');
var exec = require('child_process').exec;

var filepath = argv._[0];

if (!/^\//.test(filepath)) {
  filepath = path.join(process.cwd(), filepath);
}

var projectConfig = {};

[
  path.dirname(filepath),
  process.cwd()
].forEach(function(dir) {
  try {
    Object.assign(projectConfig, require(dir + "/tandem.config"));
  } catch(e) { }
});

var app = createApp(projectConfig);

app.bus.execute({
  type  : 'openProjectFile',
  path  : filepath
}).then(function() {
  exec(`open http://localhost:${app.config.port}/editor`);
});
