!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r(e.paperclip={})}(this,function(e){"use strict";function r(e,r){function n(){this.constructor=e}for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t]);e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}function n(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function t(e,r){return r={exports:{}},e(r,r.exports),r.exports}const a=Object.assign||function(e){for(var r,n=1;n<arguments.length;n++){r=arguments[n];for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=r[t])}return e};!function(e){e[e.STRING=0]="STRING",e[e.BLOCK=1]="BLOCK",e[e.STRING_BLOCK=2]="STRING_BLOCK",e[e.ELEMENT=3]="ELEMENT",e[e.SELF_CLOSING_ELEMENT=4]="SELF_CLOSING_ELEMENT",e[e.TEXT_NODE=5]="TEXT_NODE",e[e.COMMENT=6]="COMMENT",e[e.ATTRIBUTE=7]="ATTRIBUTE",e[e.START_TAG=8]="START_TAG",e[e.BLOCK_STRING=9]="BLOCK_STRING",e[e.FRAGMENT=10]="FRAGMENT",e[e.END_TAG=11]="END_TAG"}(e.PCExpressionType||(e.PCExpressionType={})),function(e){e.TYPE="TYPE",e.BIND="BIND",e.IF="IF",e.STRING="STRING",e.OBJECT="OBJECT",e.ARRAY="ARRAY",e.KEY_VALUE_PAIR="KEY_VALUE_PAIR",e.NUMBER="NUMBER",e.PROPERTY="PROPERTY",e.RESERVED_KEYWORD="RESERVED_KEYWORD",e.ELSEIF="ELSEIF",e.NOT="NOT",e.OPERATION="OPERATION",e.GROUP="GROUP",e.VAR_REFERENCE="VAR_REFERENCE",e.PROP_REFERENCE="PROP_REFERENCE",e.ELSE="ELSE",e.REPEAT="REPEAT"}(e.BKExpressionType||(e.BKExpressionType={})),function(e){e[e.SHEET=0]="SHEET",e[e.DECLARATION_PROPERTY=1]="DECLARATION_PROPERTY",e[e.STYLE_RULE=2]="STYLE_RULE",e[e.AT_RULE=3]="AT_RULE",e[e.IMPORT=4]="IMPORT",e[e.CHARSET=5]="CHARSET"}(e.CSSExpressionType||(e.CSSExpressionType={})),function(e){e.COLOR="COLOR",e.CALL="CALL",e.MEASUREMENT="MEASUREMENT",e.SPACED_LIST="SPACED_LIST",e.COMMA_LIST="COMMA_LIST",e.KEYWORD="KEYWORD",e.LIST="LIST"}(e.DcExpressionType||(e.DcExpressionType={}));var o=function(r){return r.type==e.PCExpressionType.SELF_CLOSING_ELEMENT?[]:r.childNodes},i=function(r){return r.type==e.PCExpressionType.SELF_CLOSING_ELEMENT?r.name:r.startTag.name},u=function(e){return e.value.value},s=function(e){return S(e).attributes},c=function(e){return S(e).modifiers},p=function(r){return r.type===e.PCExpressionType.ELEMENT||r.type===e.PCExpressionType.ELEMENT||r.type===e.PCExpressionType.START_TAG||r.type===e.PCExpressionType.END_TAG||r.type===e.PCExpressionType.SELF_CLOSING_ELEMENT},E=function(r,n){return O(r,function(r){return r.type===e.PCExpressionType.SELF_CLOSING_ELEMENT?n(r):r.type===e.PCExpressionType.ELEMENT&&n(r.startTag)})},l=function(r){return r.type===e.PCExpressionType.SELF_CLOSING_ELEMENT||r.type==e.PCExpressionType.START_TAG?r:r.startTag},T=function(e,r){if(f(e,r)){var n=l(e).attributes.find(function(e){return e.name===r});return n&&n.value&&n.value.value}},f=function(r,n){return(r.type===e.PCExpressionType.ELEMENT||r.type===e.PCExpressionType.SELF_CLOSING_ELEMENT||r.type===e.PCExpressionType.START_TAG)&&Boolean(l(r).attributes.find(function(e){return e.name===n}))},d=function(r){return O(r,function(r){return r.type===e.PCExpressionType.ELEMENT&&"style"===r.startTag.name})},y=function(r){return O(r,function(r){return r.type===e.PCExpressionType.SELF_CLOSING_ELEMENT&&"link"===r.name&&"stylesheet"===T(r,"rel")})},v=function(e){return d(e).concat(y(e))},_=function(e){return A(e,"meta")},R=function(e){var r=_(e).find(function(e){return Boolean(T(e,"name"))});return r&&T(r,"content")},N=function(e,r,n){if(void 0===n&&(n=[]),!1===r(e,n))return!1;if(e.childNodes)for(var t=e,a=0,o=t.childNodes.length;a<o;a++){var i=t.childNodes[a];if(!1===N(i,r,n.concat(["childNodes",a])))return!1}},S=function(r){return r.type===e.PCExpressionType.ELEMENT?r.startTag:r},h=function(e,r){return S(e).modifiers.find(function(e){return e.value.type===r})},C=function(e,r){var n;return N(r,function(r,t){if(r===e)return n=t,!1}),n},O=function(e,r){var n=[];return N(e,function(e){r(e)&&n.push(e)}),n},A=function(e,r){return E(e,function(e){return e.name===r})},m=function(r,n){return O(r,function(r){return r.childNodes&&r.childNodes.find(function(r){return r===n||n.type===e.PCExpressionType.START_TAG&&r.type===e.PCExpressionType.ELEMENT&&r.startTag===n})})[0]},L=function(e){var r=[];return N(e,function(e){p(e)&&-1===r.indexOf(S(e).name)&&r.push(S(e).name)}),r};!function(e){e.WARNING="WARNING",e.ERROR="ERROR"}(e.DiagnosticType||(e.DiagnosticType={}));var g,x=function(e,r){for(var n=e.location,t=(e.filePath,e.message+"\n\n"),a=r.split("\n").slice(n.start.line-1,n.end.line).map(function(e){return e+"\n"}),o=0,i=a.length;o<i;o++)t+=n.start.line+o+"| "+a[o];return t},I=function(r){return Boolean(r.find(function(r){return r.type===e.DiagnosticType.ERROR}))},P=function(e,r,n){return{type:e,pos:r,value:n}},M={},U=function(e){if(M[e])return M[e];var r=1,n=0,t={};return(e+" ").split("").forEach(function(e,a){t[a]=[n,r],"\n"===e&&(n=0,r++),n++}),M[e]=t},D=function(e,r){var n="number"==typeof e?e:e.pos,t=U(r)[n];return{column:t[0],line:t[1],pos:n}},B=function(e,r,n){return{start:e.line?e:D(e,n),end:r&&r.line?r:D(r||n.length,n)}},b=function(e,r){return B(e,e.pos+e.value.length,r)},K=function(){function e(e){this._target=e,this.pos=0,this.length=e.length}return e.prototype.curr=function(){return this._target[this.pos]},e.prototype.shift=function(){var e=this._target[this.pos];return this.next(),e},e.prototype.hasNext=function(){return this.pos<this.length-1},e.prototype.next=function(){return this._target[Math.min(this.pos=this.pos+1,this.length)]},e.prototype.prev=function(){return this._target[Math.max(this.pos=this.pos-1,0)]},e.prototype.ended=function(){return this.pos>=this.length},e}(),w=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return r(n,e),n.prototype.scan=function(e){for(var r="";this.pos<this.length;){var n=this._target[this.pos];if(!n.match(e))break;r+=n,this.pos++}return r},n.prototype.match=function(e){var r=this._target.substr(this.pos),n=r.match(e);if(n){var t=n[0];return this.pos+=r.indexOf(t)+t.length,t}return null},n.prototype.peek=function(e){return this._target.substr(this.pos,e)},n.prototype.take=function(e){var r=this._target.substr(this.pos,e);return this.pos+=e,r},n}(K),Y=function(e){function n(r,n){var t=e.call(this,n)||this;return t.source=r,t}return r(n,e),n.prototype.peek=function(e){return void 0===e&&(e=1),this._target[this.pos+e]},n.prototype.peekUntil=function(e){for(var r=this.pos;r<this.length-1;)if(e(this._target[++r]))return this._target[r]},n.prototype.curr=function(){return e.prototype.curr.call(this)},n.prototype.next=function(){return e.prototype.next.call(this)},n}(K);!function(e){e[e.LESS_THAN=0]="LESS_THAN",e[e.LESS_THAN_OR_EQUAL=1]="LESS_THAN_OR_EQUAL",e[e.CLOSE_TAG=2]="CLOSE_TAG",e[e.COMMA=3]="COMMA",e[e.GREATER_THAN=4]="GREATER_THAN",e[e.GREATER_THAN_OR_EQUAL=5]="GREATER_THAN_OR_EQUAL",e[e.COMMENT=6]="COMMENT",e[e.BACKSLASH=7]="BACKSLASH",e[e.PERIOD=8]="PERIOD",e[e.BANG=9]="BANG",e[e.AND=10]="AND",e[e.OR=11]="OR",e[e.PLUS=12]="PLUS",e[e.COLON=13]="COLON",e[e.SEMICOLON=14]="SEMICOLON",e[e.QUESTION_MARK=15]="QUESTION_MARK",e[e.MINUS=16]="MINUS",e[e.NUMBER=17]="NUMBER",e[e.AT=18]="AT",e[e.STAR=19]="STAR",e[e.PERCENT=20]="PERCENT",e[e.PAREN_OPEN=21]="PAREN_OPEN",e[e.PAREN_CLOSE=22]="PAREN_CLOSE",e[e.DOUBLE_EQUALS=23]="DOUBLE_EQUALS",e[e.TRIPPLE_EQUELS=24]="TRIPPLE_EQUELS",e[e.NOT_EQUALS=25]="NOT_EQUALS",e[e.NOT_DOUBLE_EQUALS=26]="NOT_DOUBLE_EQUALS",e[e.BRACKET_OPEN=27]="BRACKET_OPEN",e[e.BRACKET_CLOSE=28]="BRACKET_CLOSE",e[e.CURLY_BRACKET_OPEN=29]="CURLY_BRACKET_OPEN",e[e.CURLY_BRACKET_CLOSE=30]="CURLY_BRACKET_CLOSE",e[e.EQUALS=31]="EQUALS",e[e.SINGLE_QUOTE=32]="SINGLE_QUOTE",e[e.HASH=33]="HASH",e[e.DOUBLE_QUOTE=34]="DOUBLE_QUOTE",e[e.TEXT=35]="TEXT",e[e.RESERVED_KEYWORD=36]="RESERVED_KEYWORD",e[e.WHITESPACE=37]="WHITESPACE"}(g||(g={}));var G=function(e){for(var r=new w(e),n=[];!r.ended();){var t=r.curr(),a=void 0;if("<"===t)if("</"===r.peek(2))a=P(g.CLOSE_TAG,r.pos,r.take(2));else if("\x3c!--"===r.peek(4)){for(var o=r.take(4);!r.ended();){var i=r.curr();if("-"===i&&"--\x3e"===r.peek(3)){o+=r.take(3);break}r.next(),o+=i}a=P(g.COMMENT,r.pos,o)}else a="<="===r.peek(2)?P(g.LESS_THAN_OR_EQUAL,r.pos,r.take(2)):P(g.LESS_THAN,r.pos,r.shift());else if("&"===t&&"&&"===r.peek(2))a=P(g.AND,r.pos,r.take(2));else if("|"===t&&"||"===r.peek(2))a=P(g.OR,r.pos,r.take(2));else if(">"===t)a=">="===r.peek(2)?P(g.GREATER_THAN_OR_EQUAL,r.pos,r.take(2)):P(g.GREATER_THAN,r.pos,r.shift());else if("="===t)a="==="===r.peek(3)?P(g.TRIPPLE_EQUELS,r.pos,r.take(3)):"=="===r.peek(2)?P(g.DOUBLE_EQUALS,r.pos,r.take(2)):P(g.EQUALS,r.pos,r.shift());else if(":"===t)a=P(g.COLON,r.pos,r.shift());else if("?"===t)a=P(g.QUESTION_MARK,r.pos,r.shift());else if(";"===t)a=P(g.SEMICOLON,r.pos,r.shift());else if("@"===t)a=P(g.AT,r.pos,r.shift());else if(","===t)a=P(g.COMMA,r.pos,r.shift());else if("'"===t)a=P(g.SINGLE_QUOTE,r.pos,r.shift());else if("#"===t)a=P(g.HASH,r.pos,r.shift());else if("!"===t)a="!=="===r.peek(3)?P(g.NOT_DOUBLE_EQUALS,r.pos,r.take(3)):"!="===r.peek(2)?P(g.NOT_EQUALS,r.pos,r.take(2)):P(g.BANG,r.pos,r.shift());else if("/"===t){if("/*"===r.peek(2)){r.match(/.*?\*\//);continue}a=P(g.BACKSLASH,r.pos,r.shift())}else if("."===t)a=/\.\d/.test(r.peek(2))?V(r):P(g.PERIOD,r.pos,r.shift());else if('"'===t)a=P(g.DOUBLE_QUOTE,r.pos,r.shift());else if("+"===t)a=P(g.PLUS,r.pos,r.shift());else if("-"===t)a=/\-\d/.test(r.peek(2))?V(r):P(g.MINUS,r.pos,r.shift());else if("*"===t)a=P(g.STAR,r.pos,r.shift());else if("%"===t)a=P(g.PERCENT,r.pos,r.shift());else if("["===t)a=P(g.BRACKET_OPEN,r.pos,r.shift());else if("]"===t)a=P(g.BRACKET_CLOSE,r.pos,r.shift());else if("("===t)a=P(g.PAREN_OPEN,r.pos,r.shift());else if(")"===t)a=P(g.PAREN_CLOSE,r.pos,r.shift());else if("{"===t)a=P(g.CURLY_BRACKET_OPEN,r.pos,r.shift());else if("}"===t)a=P(g.CURLY_BRACKET_CLOSE,r.pos,r.shift());else if(/\d/.test(t))a=V(r);else if(/[\s\r\n\t]/.test(t))a=P(g.WHITESPACE,r.pos,r.scan(/[\s\r\n\t]/));else{var u=r.pos,s=r.scan(/[^-<>,='":@;\.\/\?\\(){}\[\]\s\r\n\t]/)||r.shift();a=P("undefined"===s||"null"===s||"true"===s||"false"===s?g.RESERVED_KEYWORD:g.TEXT,u,s)}n.push(a)}return new Y(e,n)},V=function(e){return P(g.NUMBER,e.pos,e.match(/^\-?(\d+(\.\d+)?|\.\d+)/))},F="undefined"!=typeof window&&window.cache?window.cache.parseModuleSource||(window.cache.parseModuleSource={}):{},k=function(e,r){if(F[e])return F[e];var n={source:e,filePath:r,scanner:G(e),diagnostics:[]},t=j(n);return F[e]={root:a({},t,{input:e}),diagnostics:n.diagnostics}},H=function(e,r){if(F[e])return F[e];var n={source:e,scanner:G(e),filePath:r,diagnostics:[]},t=ve(n);return F[e]={root:t,diagnostics:n.diagnostics}},j=function(r){for(var n=r.scanner,t=[];!n.ended();){var a=$(r);if(!a)return null;t.push(a)}return 1===t.length?t[0]:{type:e.PCExpressionType.FRAGMENT,location:B(0,n.source.length,n.source),childNodes:t}},$=function(e){if(!Ue(e))return null;var r=e.scanner;switch(r.curr().type){case g.WHITESPACE:return ge(e);case g.LESS_THAN:return he(e);case g.CLOSE_TAG:return Se(e);case g.COMMENT:return de(e);default:return ye(r)?Q(e,W):ge(e)}},Q=function(r,n){var t=r.scanner,a=t.curr();t.next(),t.next(),xe(r);var o=n(r);return o?(xe(r),De(r,[g.BRACKET_CLOSE],null,B(a,t.curr(),r.source))?(t.next(),De(r,[g.BRACKET_CLOSE],"Missing closing ] character.",b(a,r.source))?(t.next(),{type:e.PCExpressionType.BLOCK,location:B(a,t.curr(),t.source),value:o}):null):null):null},X=function(r){var n=r.scanner;switch(n.curr().value){case"bind":return se(r);case"repeat":return Ee(r);case"if":return pe(r,e.BKExpressionType.IF);case"elseif":return pe(r,e.BKExpressionType.ELSEIF);case"else":return pe(r,e.BKExpressionType.ELSE);case"property":return ce(r,e.BKExpressionType.PROPERTY);default:return Me(r,"Unexpected block type "+n.curr().value+"."),null}},W=function(e){var r=e.scanner;switch(r.curr().value){case"bind":return se(e);case"elseif":case"else":case"if":return Me(e,"Condition blocks can only be added to elements, for example: <div [[if condition]]></div>."),null;case"repeat":return Me(e,"Repeat blocks can only be added to elements, for example: <div [[repeat items in item, i]]></div>."),null;default:return Me(e,"Unexpected block type "+r.curr().value+"."),null}},J=function(e){var r=e.scanner;switch(r.curr().value){case"bind":return se(e);case"elseif":case"else":case"if":return Me(e,"Condition blocks cannot be assigned to attributes."),null;case"repeat":return Me(e,"Repeat blocks cannot be assigned to attributes."),null;default:return Me(e,"Unexpected block type "+r.curr().value+"."),null}},q=function(e){return Z(e)},z=function(e){return"*"===e||"/"===e},Z=function(r){if(!Ue(r))return null;var n=r.scanner,t=ee(r);xe(r);var o=n.curr(),i=o?o.type:-1;if(!(i===g.AND||i===g.OR||i==g.PLUS||i===g.MINUS||i===g.STAR||i===g.BACKSLASH||i===g.DOUBLE_EQUALS||i===g.TRIPPLE_EQUELS||i===g.GREATER_THAN||i===g.LESS_THAN||i===g.LESS_THAN_OR_EQUAL||i===g.GREATER_THAN_OR_EQUAL||i===g.NOT_EQUALS||i===g.NOT_DOUBLE_EQUALS))return t;n.next(),xe(r);var u=Z(r);if(!u)return null;var s={type:e.BKExpressionType.OPERATION,left:t,right:u,operator:o.value,location:B(t.location.start,u.location.end,n.source)};if(u.type===e.BKExpressionType.OPERATION&&z(o.value)){var c=u;s=a({},c,{left:a({},s,{right:c.left})})}return s},ee=function(e){var r=e.scanner;switch(xe(e),r.curr().type){case g.BANG:return fe(e);case g.SINGLE_QUOTE:case g.DOUBLE_QUOTE:return re(e);case g.NUMBER:return ne(e);case g.CURLY_BRACKET_OPEN:return te(e);case g.BRACKET_OPEN:return ae(e);case g.PAREN_OPEN:return ie(e);case g.TEXT:return le(e);case g.RESERVED_KEYWORD:return ue(e);default:return Me(e),null}},re=function(r){var n=r.scanner,t=n.curr();n.next();for(var a="";!n.ended();){var o=n.curr();if(o.value===t.value)break;"\\"!==o.value?(a+=o.value,n.next()):(a+=n.next().value,n.next())}return me(r,t)?(n.next(),{type:e.BKExpressionType.STRING,location:B(t,n.curr(),n.source),value:a}):null},ne=function(r){var n=r.scanner,t=n.curr();return n.next(),{type:e.BKExpressionType.NUMBER,value:t.value,location:B(t,n.curr(),n.source)}},te=function(r){var n=r.scanner,t=n.curr();n.next();for(var a=[];!n.ended()&&(xe(r),n.curr().type!==g.CURLY_BRACKET_CLOSE);){var o=oe(r);if(!o)return null;a.push(o),xe(r);var i=n.curr();if(i.type!==g.CURLY_BRACKET_CLOSE){if(i.type!==g.COMMA&&i)return Me(r),null;n.next()}}return n.next(),{type:e.BKExpressionType.OBJECT,location:B(t,n.curr(),n.source),properties:a}},ae=function(r){var n=r.scanner,t=n.curr();n.next(),xe(r);var a=[];if(n.curr().type!==g.BRACKET_CLOSE)for(;;){if(a.push(ee(r)),xe(r),n.curr().type===g.BRACKET_CLOSE)break;if(!De(r,[g.COMMA],"Missing , delimiter in array.",B(t,n.curr(),r.source)))return null;n.next()}return n.next(),{type:e.BKExpressionType.ARRAY,location:B(t,n.curr(),n.source),values:a}},oe=function(r){var n,t=r.scanner;switch(t.curr().type){case g.SINGLE_QUOTE:case g.DOUBLE_QUOTE:n=re(r);break;default:n=Te(r)}if(xe(r),!De(r,[g.COLON],"Missing : for object."))return null;t.next(),xe(r);var a=q(r);return{type:e.BKExpressionType.KEY_VALUE_PAIR,location:B(n.location.start,a.location.end,t.source),key:n.name,value:a}},ie=function(r){var n=r.scanner,t=n.curr();n.next();var a=q(r);return n.next(),{type:e.BKExpressionType.GROUP,value:a,location:B(t,n.curr(),n.source)}},ue=function(r){var n=r.scanner,t=n.curr();return n.next(),{type:e.BKExpressionType.RESERVED_KEYWORD,value:t.value,location:B(t,n.curr(),n.source)}},se=function(r){var n=r.scanner,t=n.curr();n.next(),n.next(),r.startToken=t;var a=q(r);return r.startToken=void 0,a?{type:e.BKExpressionType.BIND,value:a,location:B(t,n.curr(),n.source)}:null},ce=function(e,r){var n=e.scanner,t=n.curr();return n.next(),n.next(),{type:r,name:Te(e).name,location:B(t,n.curr(),n.source)}},pe=function(e,r){var n=e.scanner,t=n.curr();return n.next(),xe(e),{type:r,condition:n.curr().type!==g.BRACKET_CLOSE?q(e):null,location:B(t,n.curr(),n.source)}},Ee=function(r){var n=r.scanner,t=n.curr();if(n.next(),xe(r),!De(r,[g.TEXT],"Repeat block missing collection parameter.",b(t,r.source)))return null;var a=q(r);if(xe(r),!De(r,[g.TEXT],null,B(t,n.curr(),r.source)))return null;if("as"!==n.curr().value)return Me(r,'Repeat block missing "as" keyword.',B(t,n.curr(),r.source)),null;if(n.next(),xe(r),!De(r,[g.TEXT],null,B(t,n.curr(),r.source)))return null;var o,i=Te(r);if(xe(r),","===n.curr().value){if(n.next(),xe(r),!De(r,[g.TEXT],"Unexpected token. Repeat index parameter should only contain characters a-zA-Z.",B(t,n.curr(),r.source)))return null;o=Te(r)}return{type:e.BKExpressionType.REPEAT,location:B(t,n.curr(),n.source),each:a,asKey:o,asValue:i}},le=function(r){for(var n=r.scanner,t=Te(r),a=[t];!n.ended()&&n.curr().type===g.PERIOD;){if(n.next(),!De(r,[g.TEXT]))return null;a.push(Te(r))}return 1===a.length?a[0]:{type:e.BKExpressionType.PROP_REFERENCE,path:a,location:B(t.location.start,n.curr(),n.source)}},Te=function(r){var n=r.scanner;xe(r);var t=n.curr();n.next();var a=!1;return n.curr()&&n.curr().type===g.QUESTION_MARK&&(a=!0,n.next()),{type:e.BKExpressionType.VAR_REFERENCE,name:t.value,optional:a,location:B(t,n.curr(),n.source)}},fe=function(r){var n=r.scanner,t=n.curr();return n.next(),{type:e.BKExpressionType.NOT,value:ee(r),location:B(t,n.curr(),n.source)}},de=function(r){var n=r.scanner,t=n.curr();return n.next(),{type:e.PCExpressionType.COMMENT,value:t.value.substr(4,t.value.length-7),location:B(t,n.curr(),n.source)}},ye=function(e){return e.curr().type===g.BRACKET_OPEN&&e.peek(1).type===g.BRACKET_OPEN},ve=function(r){for(var n=r.scanner,t=n.curr(),a=[];;){if(xe(r),n.ended()||n.curr().type===g.CLOSE_TAG)break;var o=_e(r);if(!o)return null;a.push(o)}return{type:e.CSSExpressionType.SHEET,children:a,location:B(t,n.curr(),n.source)}},_e=function(e){switch(e.scanner.curr().type){case g.AT:return Re(e);default:return Ne(e)}},Re=function(r){var n=r.scanner,t=n.curr();n.next();for(var a="";n.curr().type!==g.WHITESPACE&&n.curr().type!==g.CURLY_BRACKET_OPEN;)a+=n.curr().value,n.next();n.next();var o=[],i=[];for(xe(r);!n.ended()&&(xe(r),n.curr().type!==g.CURLY_BRACKET_OPEN&&n.curr().type!==g.SEMICOLON);)n.curr().type===g.SINGLE_QUOTE||n.curr().type===g.DOUBLE_QUOTE?o.push(re(r).value):(o.push(n.curr().value),n.next());var u=n.curr();if(n.next(),u.type===g.CURLY_BRACKET_OPEN){for(;!n.ended()&&(xe(r),n.curr().type!==g.CURLY_BRACKET_CLOSE);){var s=_e(r);if(!s)return null;i.push(s)}if(!De(r,[g.CURLY_BRACKET_CLOSE],"Missing closing } character.",b(t,r.source)))return null;n.next()}return{type:e.CSSExpressionType.AT_RULE,name:a,params:o,children:i,location:B(t,n.curr(),n.source)}},Ne=function(r){for(var n=r.scanner,t=n.curr(),a="";!n.ended();){var o=n.curr();if(o.type==g.CURLY_BRACKET_OPEN||o.type===g.SEMICOLON||o.type===g.CURLY_BRACKET_CLOSE||o.type===g.CLOSE_TAG)break;o.type===g.SINGLE_QUOTE||o.type===g.DOUBLE_QUOTE?a+=o.value+re(r).value+o.value:(a+=o.value,n.next())}if(!De(r,[g.SEMICOLON,g.CURLY_BRACKET_OPEN,g.CURLY_BRACKET_CLOSE]))return null;if(n.curr().type===g.SEMICOLON||n.curr().type===g.CURLY_BRACKET_CLOSE){var i=a.match(/(.+?):(.+)/),u=(i[0],i[1]),s=i[2];return n.curr().type===g.SEMICOLON&&n.next(),{type:e.CSSExpressionType.DECLARATION_PROPERTY,location:B(t,n.curr(),n.source),name:u,value:s}}n.next();var c=[];for(xe(r);!n.ended()&&n.curr().type!==g.CURLY_BRACKET_CLOSE;){var p=Ne(r);if(!p)return null;c.push(p),xe(r)}return De(r,[g.CURLY_BRACKET_CLOSE],"Missing closing } character.",b(t,r.source))?(n.next(),a=a.trim(),{type:e.CSSExpressionType.STYLE_RULE,children:c,selectorText:a,location:B(t,n.curr(),n.source)}):null},Se=function(r){var n=r.scanner,t=n.curr();n.next();var a=Ie(r);return a?De(r,[g.GREATER_THAN],"Missing > character.",B(t,n.curr(),r.source))?(n.next(),{type:e.PCExpressionType.END_TAG,name:a,location:B(t,n.curr(),n.source)}):null:(Me(r,"Missing close tag name.",b(t,r.source)),null)},he=function(r){var n=r.scanner,t=n.curr();n.next();var a=Ie(r);if(!a)return Me(r,"Missing open tag name.",b(t,r.source)),null;if(!n.ended()&&!De(r,[g.WHITESPACE,g.GREATER_THAN],'Tag name contains a character where " " or > is expected.',b(t,r.source)))return null;for(var o=[],i=[];!n.ended();){xe(r);var u=n.curr();if(u.type===g.BACKSLASH||u.type==g.GREATER_THAN)break;if(ye(n)){var s=Q(r,X);if(!s)return null;i.push(s)}else{if(u.type!==g.TEXT)return Me(r),null;var c=Oe(r);if(!c)return null;o.push(c)}}if(!Ue(r))return null;if(n.curr().type===g.BACKSLASH)return n.next(),n.next(),{type:e.PCExpressionType.SELF_CLOSING_ELEMENT,name:a,attributes:o,modifiers:i,location:B(t,n.curr(),n.source)};n.next();var p=n.curr(),E=Ce(a,r);if(!E)return null;var l=E[0],T=E[1];return T?{type:e.PCExpressionType.ELEMENT,startTag:{name:a,type:e.PCExpressionType.START_TAG,location:B(t,p,n.source),modifiers:i,attributes:o},childNodes:l,location:B(t,n.curr(),n.source),endTag:T}:(Me(r,"Close tag is missing.",B(t,p,r.source)),null)},Ce=function(r,n){var t=n.scanner,a=[];if("style"===r){var o=ve(n);if(!o)return null;if(xe(n),!De(n,[g.CLOSE_TAG]))return null;var i=Se(n);return i?[[o],i]:null}if("style"===r||"script"===r){for(var u="",s=t.curr();!t.ended()&&t.curr().type!==g.CLOSE_TAG;)u+=t.curr().value,t.next();return[[{type:e.PCExpressionType.TEXT_NODE,value:u,location:B(s,t.curr(),t.source)}],$(n)]}for(var c;!t.ended();){var p=$(n);if(!p)return null;if(p.type===e.PCExpressionType.END_TAG){c=p;break}a.push(p)}return[a,c]},Oe=function(r){var n,t=r.scanner,a=t.curr(),o=Ie(r);return t.curr().type!==g.EQUALS||(t.next(),n=Ae(r))?{type:e.PCExpressionType.ATTRIBUTE,name:o,value:n,location:B(a,t.curr(),t.source)}:null},Ae=function(e){if(!Ue(e))return null;var r=e.scanner;switch(r.curr().type){case g.SINGLE_QUOTE:case g.DOUBLE_QUOTE:return Le(e);default:return ye(r)?Q(e,J):(Me(e),null)}},me=function(e,r){return De(e,[r.type],"Missing closing "+r.value+" character.",b(r,e.source))},Le=function(r){var n=r.scanner,t=n.curr(),a=[],o=!1;for(n.next();!n.ended();){var i=n.curr();if(i.type===t.type)break;if(ye(n)){o=!0;var u=Q(r,J);if(!u)return null;a.push(u)}else n.next(),a.push({type:e.PCExpressionType.STRING,value:i.value,location:B(i.pos,n.curr(),n.source)})}if(!me(r,t))return null;n.next();var s=B(t,n.curr(),n.source);return o?{type:e.PCExpressionType.STRING_BLOCK,location:s,values:a}:{type:e.PCExpressionType.STRING,location:s,value:a.map(function(e){return e.value}).join("")}},ge=function(r){var n=r.scanner,t=n.curr();n.next();for(var a=t.value;!n.ended();){var o=n.curr();if(o.type===g.COMMENT||o.type===g.LESS_THAN||o.type==g.CLOSE_TAG||ye(n))break;n.next(),a+=o.value}return{type:e.PCExpressionType.TEXT_NODE,value:a,location:B(t,n.curr(),n.source)}},xe=function(e){for(var r=e.scanner;!r.ended()&&r.curr().type===g.WHITESPACE;)r.next()},Ie=function(e){for(var r=e.scanner,n="";!r.ended()&&/[a-zA-Z-][a-zA-Z0-9-]*/.test(r.curr().value);)n+=r.curr().value,r.next();return n||null},Pe=function(e,r){if(!r)throw new Error("Unexpected end of file (missing closing expression).");var n=D(r,e);throw new Error('Unexpected token "'+r.value+'" at '+n.line+":"+n.column)},Me=function(r,n,t){var a=r.scanner.curr(),o=t||(r.startToken?B(r.startToken,r.scanner.curr(),r.source):{start:D(a||r.scanner.source.length-1,r.scanner.source),end:D(a?a.pos+a.value.length:r.scanner.source.length,r.scanner.source)});return r.diagnostics.push({type:e.DiagnosticType.ERROR,location:o,message:n||(a?"Unexpected token.":"Unexpected end of file."),filePath:r.filePath}),!0},Ue=function(e,r,n){return!!e.scanner.curr()||(Me(e,r,n),!1)},De=function(e,r,n,t){var a=e.scanner.curr();return!(!a||-1===r.indexOf(a.type))||(Me(e,n,t),!1)};!function(e){e.TANDEM="TANDEM",e.WEB="WEB"}(e.PaperclipTargetType||(e.PaperclipTargetType={}));var Be=function(e){var r=Symbol();return function(n){for(var t=[],a=1;a<arguments.length;a++)t[a-1]=arguments[a];return n[r]?n[r]:n[r]=e.apply(void 0,[n].concat(t))}},be=function(e,r){if(Array.isArray(e))e.forEach(r);else for(var n in e)r(e[n],n)},Ke=Symbol(),we=function(e,r){if(e[Ke]&&e[Ke][0]===e)return e[Ke][1];var n=qe(e,r);return e[Ke]=[e,n],n},Ye=Be(function(e){var r={};for(var n in e)for(var t=0,a=e[n].module.components;t<a.length;t++){var o=a[t];r[o.id]=o}return r}),Ge=Be(function(e){var r=[];for(var n in e){var t=e[n].module;r.push.apply(r,t.globalStyles)}return r}),Ve=Be(function(e){var r={};for(var n in e)for(var t=0,a=e[n].module.components;t<a.length;t++)r[a[t].id]=n;return r}),Fe=function(e,r){var n=r.split("/");n.pop();var t=(e=e.replace("./","")).split("../"),a=t.pop();return n.splice(n.length-t.length,n.length),n.join("/")+"/"+a},ke=function(e,r){var n={};return L(e).forEach(function(e){var t=We(e,r);t&&(n[e]=t)}),n},He=function(e){var r={};for(var n in e)for(var t=0,a=e[n].module.components;t<a.length;t++){var o=a[t];r[o.id]={filePath:n,expression:o.source}}return r},je=function(e,r){var n={};return e.module.components.forEach(function(e){Object.assign(n,ke(e.template,r))}),n},$e=function(e,r){return r.components.find(function(r){return r.id===e})},Qe=function(e,r){var n=[],t=(je(e,r),je(e,r));for(var a in t){var o=t[a];-1===n.indexOf(o)&&n.push(o)}return n},Xe=function(e,r){var n=e.resolvedImportUris,t=[];for(var a in n)t.push(r[n[a]]);return t},We=function(e,r){for(var n in r)for(var t=r[n],a=0,o=t.module.components.length;a<o;a++)if(t.module.components[a].id===e)return t},Je=function(e,r,n,t){var a=r.readFile,o=r.resolveFile,i=void 0===o?Fe:o;return void 0===n&&(n={}),void 0===t&&(t=[]),n[e]?Promise.resolve({diagnostics:t,graph:n}):Promise.resolve(a(e)).then(function(r){return k(r,e)}).then(function(r){return t.push.apply(t,r.diagnostics),r.root?we(r.root,e):null}).then(function(r){if(!r)return null;var o={};return n[e]={module:r,resolvedImportUris:o},r.imports.length?Promise.all(r.imports.map(function(r){return Promise.resolve(i(r.href,e)).then(function(e){return o[r.href]=e,Je(e,{readFile:a,resolveFile:i},n,t)})})):Promise.resolve(n)}).then(function(){return{graph:n,diagnostics:t}})},qe=function(r,n){for(var t=r.type===e.PCExpressionType.FRAGMENT?r.childNodes:[r],a=[],u=[],p=[],E=[],l=0,T=t.length;l<T;l++){var f=t[l];if(f.type===e.PCExpressionType.SELF_CLOSING_ELEMENT||f.type===e.PCExpressionType.ELEMENT){var d=f,y=i(d),v=o(d),_=s(d),R=c(d);if("component"===y&&d.type===e.PCExpressionType.ELEMENT){u.push(rr(d,R,_,v));continue}if("link"===y){a.push(tr(_));continue}if("style"===y){p.push(d);continue}}E.push(f)}return{source:r,uri:n,imports:a,components:u,globalStyles:p,unhandledExpressions:E}},ze=function(e){for(var r={},n=0,t=e.split(/,\s+/g);n<t.length;n++){var a=t[n].split("="),o=a[0],i=a[1];r[o]=i}return r},Ze=function(e,r){return e.metadata.filter(function(e){return e.name===r})},er=function(e,r){return Ze(e,r).shift()},rr=function(r,n,t,a){for(var c,p,E,l=[],f=[],d=0,y=t.length;d<y;d++){var v=t[d];"id"===v.name&&(c=u(v))}for(var d=0,y=a.length;d<y;d++){var _=a[d];if(_.type===e.PCExpressionType.SELF_CLOSING_ELEMENT||_.type===e.PCExpressionType.ELEMENT){var R=_,N=i(R);s(R),o(R);"style"===N?p=R:"template"===N?E=R:"preview"===N?_.type===e.PCExpressionType.ELEMENT&&_.childNodes.find(function(r){return r.type===e.PCExpressionType.ELEMENT||r.type===e.PCExpressionType.SELF_CLOSING_ELEMENT})&&Boolean(T(R,"name"))&&l.push(R):"meta"===N&&f.push({name:T(R,"name"),params:ze(T(R,"content")||"")})}}return{source:r,id:c,style:p,metadata:f,template:E,previews:l}},nr=function(e,r){return r.previews.find(function(r){return T(r,"name")===e})},tr=function(e){for(var r,n,t=0,a=e.length;t<a;t++){var o=e[t];"href"===o.name?r=u(o):"type"===o.name&&(n=u(o))}return{type:n,href:r}};!function(e){e[e.OBJECT=1]="OBJECT",e[e.ARRAY=2]="ARRAY",e[e.STRING=4]="STRING",e[e.NUMBER=8]="NUMBER",e[e.BOOLEAN=16]="BOOLEAN",e[e.PRIMITIVE=28]="PRIMITIVE",e[e.ANY=31]="ANY",e[e.OBJECT_OR_ARRAY=3]="OBJECT_OR_ARRAY"}(e.InferenceType||(e.InferenceType={}));var ar=function(){return{type:e.InferenceType.ANY,properties:{}}},or=ar(),ir=Be(function(e,r,n){void 0===n&&(n={});var t=sr(e,ur(r,n));return{diagnostics:t.diagnostics,inference:t.inference}}),ur=function(r,n){return{filePath:r,options:n,inference:ar(),diagnostics:[],currentScopes:{},typeLimit:e.InferenceType.ANY}},sr=function(r,n){switch(r.type){case e.PCExpressionType.BLOCK:return vr(r,n);case e.PCExpressionType.FRAGMENT:return dr(r,n);case e.PCExpressionType.SELF_CLOSING_ELEMENT:case e.PCExpressionType.ELEMENT:return lr(r,n)}return n},cr=function(r,n){for(var t=r.attributes,a=(r.name,r.modifiers),o=0,i=a.length;o<i;o++){var u=a[o].value;u.type!==e.BKExpressionType.IF&&u.type!==e.BKExpressionType.ELSEIF&&u.type!==e.BKExpressionType.BIND||(n=_r(u,Cr(e.InferenceType.ANY,null,n)))}for(var o=0,i=t.length;o<i;o++)n=pr(r,t[o],Cr(e.InferenceType.ANY,null,n));return n},pr=function(e,r,n){r.name;var t=r.value;return t&&(n=Er(e,t,n)),n},Er=function(r,n,t){switch(n.type){case e.PCExpressionType.STRING:return t;case e.PCExpressionType.STRING_BLOCK:for(var a=0,o=(i=n).values.length;a<o;a++)t=Er(r,i.values[a],Cr(e.InferenceType.STRING,null,t));return t;case e.PCExpressionType.BLOCK:var i=n;return _r(i.value,t)}return t},lr=function(r,n){var t,a=[];if(r.type===e.PCExpressionType.SELF_CLOSING_ELEMENT)a=[],t=r;else{var o=r;a=o.childNodes,t=o.startTag}if(n.options.ignoreTagNames&&-1!==n.options.ignoreTagNames.indexOf(t.name))return n;for(var i,u=t.modifiers,s=0,c=u.length;s<c;s++){var p=u[s].value;if(p.type===e.BKExpressionType.REPEAT&&Tr(p.each)){i=p;break}}return i&&(n=_r(i,n),n=xr(i.asValue.name,fr(i.each).concat(["$$each"]),n)),n=cr(t,n),n=yr(a,n),i&&(n=Pr(i.asValue.name,n)),n},Tr=function(r){return r.type===e.BKExpressionType.VAR_REFERENCE||r.type===e.BKExpressionType.PROP_REFERENCE},fr=function(r){return r.type===e.BKExpressionType.VAR_REFERENCE?[r.name]:r.path.map(function(e){return e.name})},dr=function(e,r){return yr(e.childNodes,r)},yr=function(e,r){for(var n=0,t=e.length;n<t;n++)r=sr(e[n],r);return r},vr=function(r,n){return _r(r.value,Cr(e.InferenceType.ANY,null,n))},_r=function(r,n){switch(r.type){case e.BKExpressionType.NUMBER:return Ur(e.InferenceType.NUMBER,n)?Cr(e.InferenceType.NUMBER,null,n):Dr(r,e.InferenceType.NUMBER,n);case e.BKExpressionType.STRING:return Ur(e.InferenceType.STRING,n)?Cr(e.InferenceType.STRING,null,n):Dr(r,e.InferenceType.STRING,n);case e.BKExpressionType.OPERATION:var t=r,a=t.left,o=t.operator,i=t.right,u=/^[\*\/\-%]$/.test(o)?e.InferenceType.NUMBER:n.typeLimit;if(!Ur(u,n))return Dr(r,u,n);n.typeLimit;var s=u;return n=_r(a,Cr(u,"The left-hand side of an arithmetic operation must be "+mr(u),n)),n=_r(i,"==="!==o?Cr(s,"The right-hand side of an arithmetic operation must be "+mr(n.typeLimit),n):n);case e.BKExpressionType.GROUP:f=r.value;return _r(f,n);case e.BKExpressionType.VAR_REFERENCE:case e.BKExpressionType.PROP_REFERENCE:var c=fr(r);return n=Rr(r,c,n);case e.BKExpressionType.BIND:f=r.value;return _r(f,n);case e.BKExpressionType.OBJECT:for(var p=r.properties,E=0,l=p.length;E<l;E++){var T=p[E],f=(T.key,T.value);n=_r(f,Cr(e.InferenceType.ANY,null,n))}return Cr(e.InferenceType.OBJECT,null,n);case e.BKExpressionType.NOT:f=r.value;return Cr(e.InferenceType.BOOLEAN,null,_r(f,Cr(e.InferenceType.ANY,null,n)));case e.BKExpressionType.ELSEIF:case e.BKExpressionType.IF:var d=r.condition;return _r(d,Cr(e.InferenceType.ANY,null,n));case e.BKExpressionType.REPEAT:var y=r.each;return _r(y,n);default:return n}},Rr=function(e,r,n){var t=hr(r,n)&n.typeLimit;return Ur(t,n)?Cr(t,n.typeLimitErrorMessage,gr(e,r,t,n)):Br(e,n,n.typeLimitErrorMessage)},Nr=function(e,r){var n=Ir(e,r);return Sr(n,r.inference)},Sr=function(e,r){for(var n=r,t=0,a=e.length;t<a;t++)if(!(n=n.properties[e[t]]))return null;return n},hr=function(r,n,t){void 0===t&&(t=e.InferenceType.ANY);var a=Nr(r,n);return a?a.type:t},Cr=function(e,r,n){return a({},n,{typeLimit:e,typeLimitErrorMessage:r})},Or=function(r,n,t,o){return void 0===o&&(o=-1),o++,o===r.length?a({},t,n):a({},t,{type:t.type&e.InferenceType.OBJECT_OR_ARRAY,properties:a({},t.properties,(i={},i[r[o]]=Or(r,n,t.properties[r[o]]||ar(),o),i))});var i},Ar=function(r){var n=[];return r&e.InferenceType.ARRAY&&n.push("array"),r&e.InferenceType.OBJECT&&n.push("object"),r&e.InferenceType.STRING&&n.push("string"),r&e.InferenceType.NUMBER&&n.push("number"),r&e.InferenceType.BOOLEAN&&n.push("boolean"),n},mr=function(e){var r=Ar(e);return 1===r.length?"a "+r[0]:"an "+r.slice(0,r.length-1).join(", ")+", or "+r[r.length-1]},Lr=function(r,n,t){for(var a=t.inference,o=0,i=r.length;o<i-1;o++){if(!(a=a.properties[r[o]]))return t;a.type&e.InferenceType.OBJECT_OR_ARRAY||(t=Br(n,Cr(t.typeLimit,null,t),'Cannot call property "'+r.slice(o+1).join(".")+'" on primitive "'+r.slice(0,o+1).join(".")+'"'))}return t},gr=function(e,r,n,t){return t=Lr(r,e,t),Mr(Or(Ir(r,t),{type:n},t.inference),t)},xr=function(e,r,n){return a({},n,{currentScopes:a({},n.currentScopes,(t={},t[e]=r,t))});var t},Ir=function(e,r){var n=r.currentScopes[e[0]];return n?Ir(n,r).concat(e.slice(1)):e},Pr=function(e,r){return a({},r,{currentScopes:a({},r.currentScopes,(n={},n[e]=null,n))});var n},Mr=function(e,r){return a({},r,{inference:e})},Ur=function(e,r){var n=r.typeLimit;return Boolean(e&n)},Dr=function(e,r,n){return Br(e,n,n.typeLimitErrorMessage||"Type mismatch "+r+" to "+n.typeLimit)},Br=function(r,n,t){return br(r,e.DiagnosticType.ERROR,n,t)},br=function(r,n,t,o){return a({},t,{diagnostics:t.diagnostics.concat([{type:e.DiagnosticType.ERROR,location:r.location,message:o,filePath:t.filePath}])})},Kr=Be(function(e,r){void 0===r&&(r={});var n={};for(var t in e)for(var o=0,i=e[t].module.components;o<i.length;o++)n[(p=i[o]).id]={filePath:t,component:p};var u={graph:e,currentComponentId:null,options:r,currentFilePath:null,ignoreTagNames:{},callstack:[],components:n,diagnostics:[]};for(var s in n){var c=n[s],t=c.filePath,p=c.component;u=Yr(p,a({},u,{currentComponentId:s,currentFilePath:t}))}return{diagnostics:wr(u.diagnostics)}}),wr=function(e){for(var r=e.map(function(e){return JSON.stringify(e)}),n={},t=[],a=0,o=r.length;a<o;a++){var i=r[a];n[i]||(n[i]=1,t.push(e[a]))}return t},Yr=function(e,r){r=Gr(e.template,r);for(var n=0,t=e.previews.length;n<t;n++){var a=e.previews[n];r=Gr(a,r)}return r},Gr=function(r,n){switch(r.type){case e.PCExpressionType.FRAGMENT:return kr(r,n);case e.PCExpressionType.SELF_CLOSING_ELEMENT:case e.PCExpressionType.ELEMENT:return Hr(r,n);case e.PCExpressionType.BLOCK:return Vr(r,n)}return n},Vr=function(e,r){return Zr(e.value,r)},Fr=function(e,r){for(var n=0,t=e.length;n<t;n++)r=Gr(e[n],r);return r},kr=function(e,r){return Fr(e.childNodes,r)},Hr=function(r,n){var t,o;if(r.type===e.PCExpressionType.ELEMENT)t=(i=r).childNodes,o=i.startTag;else{var i=r;o=i,t=[]}if(n.callstack.filter(function(e){return e.source===o}).length>10)return Xr(r,"Maximum callstack exceeded",n);if(n.ignoreTagNames[o.name.toLowerCase()])return n;for(var u,s,c=0,p=o.modifiers.length;c<p;c++){var E=o.modifiers[c].value;E.type===e.BKExpressionType.IF||E.type===e.BKExpressionType.ELSEIF?u=E:E.type===e.BKExpressionType.REPEAT&&(s=E)}if(u&&!(n=Zr(u,n)).currentExprEvalResult.value)return n;if(s){var l=s.each,T=s.asValue,f=s.asKey,d=T.name,y=f&&f.name||void 0,v=(n=Zr(l,n)).currentFilePath,_=n.currentExprEvalResult.source;be(n.currentExprEvalResult.value,function(e,r){n=$r(o,an(_,v,a({},n.caller&&n.caller.props||{},(i={},i[d]=e,i[y]=f?{value:r,source:f}:void 0,i)),n)),n=Fr(t,n),n=en(n);var i})}else n=$r(o,n),n=Fr(t,n);return n},jr={},$r=function(r,n){for(var t={},a=(n.currentFilePath,{}),o=0,i=r.attributes.length;o<i;o++)a[(s=r.attributes[o]).name]=s;for(var u in a){var s=a[u];n=Jr(s,n),t[u]=n.currentExprEvalResult}for(var c=r,o=0,i=r.modifiers.length;o<i;o++){var p=r.modifiers[o].value;p.type===e.BKExpressionType.BIND&&(c=(n=Zr(p,n)).currentExprEvalResult.source,Object.assign(t,n.currentExprEvalResult.value))}var E=n.components[r.name.toLowerCase()]||jr,l=E.filePath,T=E.component;if(!T)return n;var f=n.currentComponentId;return n=Gr(T.source,rn("preview",an(c,l,t,nn(r.name,n)))),tn("preview",en(nn(f,n)))},Qr=function(r){if(Array.isArray(r))return e.InferenceType.ARRAY;if(null===r)return e.InferenceType.ANY;switch(typeof r){case"object":return e.InferenceType.OBJECT;case"number":return e.InferenceType.NUMBER;case"boolean":return e.InferenceType.BOOLEAN;case"string":return e.InferenceType.STRING;default:return e.InferenceType.ANY}},Xr=function(r,n,t){return Wr(r,e.DiagnosticType.ERROR,n,t)},Wr=function(r,n,t,o){return a({},o,{diagnostics:o.diagnostics.concat([{type:e.DiagnosticType.ERROR,location:r.location,message:t,filePath:o.currentFilePath}])})},Jr=function(r,n){if(!r.value)return un(!0,r,n);if(r.value.type===e.PCExpressionType.STRING_BLOCK)for(var t=r.value,a=0,o=t.values.length;a<o;a++){var i=t.values[a];i.type===e.PCExpressionType.BLOCK&&(n=Zr(i,n))}else n=r.value.type===e.PCExpressionType.STRING?un(r.value.value,r.value,n):Zr(r.value.value,n);return n},qr=function(e,r,n){return void 0===n&&(n=0),null==r?r:n===e.length?r.value:qr(e,r.value&&r.value[e[n]],n+1)},zr=function(e,r){var n=r.props[e[0]];if(null==n)return r.source;for(var t=n,a=1,o=e.length;a<o;a++){var i=t.value&&t.value[a];if(!i)break;t=i}return t.source},Zr=function(r,n){switch(r.type){case e.BKExpressionType.OPERATION:var t=r,o=t.left,i=t.operator,u=t.right,s=n.optionalVars;"||"===i&&(n=on(!0,n));var c=(n=Zr(o,n)).currentExprEvalResult.value,p=(n=Zr(u,on(s,n))).currentExprEvalResult.value;switch(i){case"+":return un(c+p,r,n);case"-":return un(c-p,r,n);case"*":return un(c*p,r,n);case"/":return un(c/p,r,n);case"%":return un(c%p,r,n);case"==":return un(c==p,r,n);case"===":return un(c===p,r,n);case"!=":case"!==":return un(c!==p,r,n);case"||":return un(c||p,r,n);case"&&":return un(c&&p,r,n);case">":return un(c>p,r,n);case">=":return un(c>=p,r,n);case"<":return un(c<p,r,n);case"<=":return un(c<=p,r,n)}return n;case e.BKExpressionType.PROP_REFERENCE:case e.BKExpressionType.VAR_REFERENCE:var E=fr(r);if(n.caller){var l=(n.components[n.currentComponentId]||{}).component,T=l&&ir(l.source),f=zr(E,n.caller),d=qr(E.slice(1),n.caller.props[E[0]]);if(n=un(d,f,n),void 0===d&&(E.length>1||!n.optionalVars))n=Xr(f,'Property "'+E.join(".")+'" is undefined',n);else if(T){var y=Sr(E,T.inference)||or,v=Qr(d);y.type&v||(n=Xr(f,'Type mismatch: attribute "'+E.join(".")+'" expecting '+mr(y.type)+", "+Ar(v)+" provided.",n))}}else n=un(null,r,n);return n;case e.BKExpressionType.OBJECT:for(var _=r,R={},N=0,S=_.properties.length;N<S;N++){var h=_.properties[N],C=h.key,d=h.value;n=Zr(d,n),R[C]=n.currentExprEvalResult}return n=un(R,r,n);case e.BKExpressionType.ARRAY:for(var O=r,A=[],N=0,S=O.values.length;N<S;N++)n=Zr(O.values[N],n),A.push(n.currentExprEvalResult);return n=un(A,r,n);case e.BKExpressionType.GROUP:return Zr(r.value,n);case e.BKExpressionType.NUMBER:var m=r;return un(Number(m.value),r,n);case e.BKExpressionType.STRING:var L=r;return un(String(L.value),r,n);case e.BKExpressionType.RESERVED_KEYWORD:return"undefined"===(d=r.value)?un(void 0,r,n):"null"===d?un(null,r,n):"true"===d||"false"==d?un("true"===d,r,n):n;case e.BKExpressionType.NOT:return n=Zr(r.value,n),un(!n.currentExprEvalResult.value,r,n);case e.BKExpressionType.BIND:return Zr(r.value,a({},n,{currentExprEvalResult:void 0,optionalVars:!1}));case e.BKExpressionType.IF:case e.BKExpressionType.ELSEIF:return Zr(r.condition,a({},n,{currentExprEvalResult:void 0,optionalVars:!0}));default:return n}},en=function(e){return a({},e,{callstack:e.callstack.slice(0,e.callstack.length-1),caller:e.callstack[e.callstack.length-2]})},rn=function(e,r){return a({},r,{ignoreTagNames:a({},rn,(n={},n[e]=(r.ignoreTagNames[e]||0)+1,n))});var n},nn=function(e,r){return a({},r,{currentComponentId:e})},tn=function(e,r){return a({},r,{ignoreTagNames:a({},rn,(n={},n[e]=(r.ignoreTagNames[e]||1)-1,n))});var n},an=function(e,r,n,t){var o={filePath:r,source:e,props:n};return a({},t,{callstack:t.callstack.concat([o]),caller:o})},on=function(e,r){return a({},r,{optionalVars:e})},un=function(e,r,n){return a({},n,{currentExprEvalResult:{value:e,source:r}})},sn=function(e,r){return Je(e,r.io).then(function(r){var n=r.graph;return{code:En(e,n),graph:n,diagnostics:Kr(n).diagnostics,entryDependency:n[e]}})},cn=function(r){switch(r.type){case e.BKExpressionType.NOT:return"!"+cn(r.value);case e.BKExpressionType.PROP_REFERENCE:return(t=r).path.map(cn).join(".");case e.BKExpressionType.STRING:var n=r;return JSON.stringify(n.value);case e.BKExpressionType.NUMBER:return r.value;case e.BKExpressionType.VAR_REFERENCE:var t=r;return t.name;case e.BKExpressionType.ARRAY:return"["+r.values.map(cn)+"]";case e.BKExpressionType.OBJECT:for(var a=r,o="{",i=0,u=a.properties.length;i<u;i++){var s=a.properties[i];o+=s.key+":"+cn(s.value)+", "}return o+="}";case e.BKExpressionType.GROUP:return"("+cn(r.value)+")";case e.BKExpressionType.RESERVED_KEYWORD:return r.value;case e.BKExpressionType.OPERATION:var c=r,p=c.left,E=c.operator,l=c.right;return cn(p)+" "+E+" "+cn(l);default:throw new Error("Unable to transpile BK block "+r.type)}},pn=function(e){return e.replace(/[\d-]+/g,"_")},En=function(e,r){var n="((window) => {";n+='var document = window.document;const __each = (object, iterator) => {if (Array.isArray(object)) {object.forEach(iterator);} else {for (const key in object) {iterator(object[key], key);}}};const __count = (object) => {return Array.isArray(object) ? object.length : Object.keys(object).length;};const __defineModule = (run) => {let exports;return () => {if (exports) return exports;exports = {};return exports = run((dep) => {return $$modules[dep]()});}};const __setElementProperty = (element, property, value) => {if (property === "style" && typeof value !== "string") {\nelement.style = "";\nObject.assign(element.style, value);\n} else {\nelement[property] = value;}\n};let updating = false;let toUpdate = [];const __requestUpdate = (object) => {if (toUpdate.indexOf(object) === -1) {toUpdate.push(object);}if (updating) {return;}updating = true;requestAnimationFrame(function() {for(let __i = 0; i < toUpdate.length; __i++) {const target = toUpdate[__i];target.update();}toUpdate = [];updating = false;});};',n+="$$modules = {};";for(var t in r)n+='$$modules["'+t+'"] = '+ln(r[t].module,r[t].resolvedImportUris)+";";return n+='const entry = $$modules["'+e+'"]();',n+="return {entry,modules: $$modules};})(window)"},ln=function(e,r){var n=e.source,t=e.imports,a=e.globalStyles,o=e.components,i=(e.unhandledExpressions,{uri:e.uri,aliases:{},varCount:0,root:n}),u="__defineModule((require) => {";u+="var $$previews = {};";for(var s=kn(a,i),c=0,p=s.length;c<p;c++)u+=(l=s[c]).content,u+="document.body.appendChild("+l.varName+");";for(var c=0,p=t.length;c<p;c++){var E=t[c],l=jn("import","require("+JSON.stringify(r[E.href])+")",i);u+=l.content}for(var c=0,p=o.length;c<p;c++)u+=fn(o[c],i).content;return u+="return {previews: $$previews};",u+="})"},Tn=function(e){return"(() => { const binding = () => { "+e+" }; binding(); return binding; })()"},fn=function(r,n){var t=r.previews,o=r.source,i=r.id,u=r.style,s=r.template,c=$n(pn(i),n),p=a({},n,{varCount:0,contextName:"this"}),E=Object.keys(ir(o).inference.properties),l=u&&An(u,p),f="class "+c+" extends HTMLElement {constructor() {super();this.__bindings = [];}connectedCallback() {this.render();}"+E.map(function(e){return"get "+e+"() {return this.__"+e+";}set "+e+"(value) {if (this.__"+e+" === value || String(this.__"+e+") === String(value)) {return;}const oldValue = this.__"+e+";this.__"+e+' = value;if (typeof value !== "object") {this.setAttribute('+JSON.stringify(e)+", value);}if (this._rendered) {__requestUpdate(this);}}"}).join("\n")+'render() {if (this._rendered) {return;}this._rendered = true;const shadow = this.attachShadow({ mode: "open" });'+(l?l.content+"shadow.appendChild("+l.varName+");":"")+E.map(function(e){return"if (this.__"+e+" == null) {this.__"+e+' = this.getAttribute("'+e+'");}'}).join("\n")+"let __bindings = [];"+(s?s.childNodes.map(function(e){var r=dn(e,p);return e&&r?r.content+(r.bindings.length?"__bindings = __bindings.concat("+r.bindings.map(function(e){return"(() => {const __binding = () => {const { "+E.join(",")+" } = this;"+e+"};__binding();return __binding;})()"})+");":"")+"shadow.appendChild("+r.varName+");":""}).join(""):"")+"this.__bindings = __bindings;}cloneShallow() {const clone = super.cloneShallow();clone._rendered = true;return clone;}static get observedAttributes() {return "+JSON.stringify(E)+";}attributeChangedCallback(name, oldValue, newValue) {if (super.attributeChangedCallback) {super.attributeChangedCallback(name, oldValue, newValue);}this[name] = newValue;}update() {if (!this._rendered) {return;}let bindings = this.__bindings || [];"+Cn("bindings")+'}}if (!customElements.get("'+i+'")) {customElements.define("'+i+'", '+c+');} else {console.error("Custom element \\"'+i+'\\" is already defined, ignoring");}';return f+='$$previews["'+i+'"] = {};',t.forEach(function(r){var t=T(r,"name"),o=r.childNodes.find(function(r){return r.type===e.PCExpressionType.SELF_CLOSING_ELEMENT||r.type===e.PCExpressionType.ELEMENT});if(o){var u=dn(o,a({},n,{aliases:a({},n.aliases,{preview:i})}));f+='$$previews["'+i+'"]["'+t+'"] = () => {'+u.content+u.bindings.map(function(e){return e})+"return "+u.varName+";};"}}),{varName:c,bindings:[],content:f}},dn=function(r,n){switch(r.type){case e.PCExpressionType.FRAGMENT:return yn(r,n);case e.PCExpressionType.TEXT_NODE:return vn(r,n);case e.PCExpressionType.BLOCK:return _n(r,n);case e.PCExpressionType.ELEMENT:return On(r,n);case e.PCExpressionType.SELF_CLOSING_ELEMENT:return Rn(r,n)}return null},yn=function(e,r){return Qn('document.createDocumentFragment("")',r)},vn=function(e,r){return Jn(Qn("document.createTextNode("+JSON.stringify(e.value.replace(/[\s\r\n\t]+/g," "))+")",r),e,r)},_n=function(e,r){var n=Qn('document.createTextNode("")',r),t=(n=Jn(n,e,r)).varName+"$$currentValue";return n.content+="let "+t+";",n.bindings.push(hn(t,cn(e.value.value),function(e){return n.varName+".nodeValue = "+e},r)),n},Rn=function(e,r){return Nn(e,Jn(Sn(e,r),e,r),r)},Nn=function(r,n,t){if(!r.modifiers.length)return n;for(var a,o,i,u,s,c=r.modifiers,E=n,l=0,T=c.length;l<T;l++)(M=c[l].value).type===e.BKExpressionType.IF?a=M:M.type===e.BKExpressionType.ELSE?o=M:M.type===e.BKExpressionType.ELSEIF?i=M:M.type===e.BKExpressionType.REPEAT?u=M:M.type===e.BKExpressionType.BIND&&(s=M);if(s){var f=s.value,d=(E={varName:n.varName,content:n.content,bindings:n.bindings.slice()}).varName+"$$spreadValue",y=cn(f);E.content+="let "+d+";",E.bindings.push(hn(d,y,function(e){return"for (const __key in "+d+") {__setElementProperty("+n.varName+", __key, "+d+"[__key]);}"},t)),n=E}if(u){var v=u.each,_=u.asKey,R=u.asValue,N=cn(v),S=_?cn(_):"index",O=cn(R),A=Wn(t),L=A.fragment,g=A.start,x=A.end,I=(E=L).varName+"$$currentValue",P=E.varName+"$$childBindings";E.content+="let "+I+" = [];let "+P+" = [];",E.bindings.push("let $$newValue = ("+N+") || [];if ($$newValue === "+I+") {return;}const $$oldValue = "+I+";"+I+" = $$newValue;const $$parent = "+g.varName+".parentNode;const $$startIndex = Array.prototype.indexOf.call($$parent.childNodes, "+g.varName+"); const $$newValueCount = __count($$newValue);const $$oldValueCount = __count($$oldValue);if ($$newValueCount > $$oldValueCount) {for (let __i = $$newValueCount - $$oldValueCount; __i--;) {"+n.content+"$$parent.insertBefore("+n.varName+", "+x.varName+");const __bindings = ["+n.bindings.map(function(e){return"("+O+", "+S+") => { "+e+"}"}).join(",")+"];"+P+".push(($$newValue, $$newKey) => {"+Cn("__bindings","$$newValue, $$newKey")+"});}} else if ($$oldValue.length < $$newValue.length) {}let __i = 0;__each($$newValue, (value, k) => {"+P+"[__i++](value, k);});"),n=E}if(a||i||o){for(var M=a||i||o,U=M.condition,D=t.root===r||t.root.startTag===r?[t.root]:m(t.root,r).childNodes,B=D.findIndex(function(n){return n===r||r.type===e.PCExpressionType.START_TAG&&n.type===e.PCExpressionType.ELEMENT&&n.startTag===r}),b=void 0,l=B+1;l--;){var K=D[l];if(p(K)&&h(K,e.BKExpressionType.IF)){b="condition_"+C(K,t.root).join("");break}}if(!b)throw new Error("Element condition "+e.BKExpressionType[M.type]+" defined without an IF block.");var w=Wn(t),L=w.fragment,g=w.start,x=w.end,Y=(E=L).varName+"__bindings",I=E.varName+"$$currentValue";L.content+="let "+Y+" = [];let "+I+" = false;",a&&(L.content+="let "+b+" = Infinity;"),E.bindings.push("const newValue = Boolean("+(U?cn(U):"true")+") && "+b+" >= "+B+";if (newValue) {"+b+" = "+B+";} else if ("+b+" === "+B+") {"+b+" = Infinity;}if (newValue && newValue === "+I+") {if ("+I+") {"+Cn(Y)+"}return;}"+I+" = newValue;"+Y+" = [];if (newValue) {const elementFragment = document.createDocumentFragment();"+n.content+(n.bindings.length?Y+" = "+Y+".concat("+n.bindings.map(Tn)+");":"")+"elementFragment.appendChild("+n.varName+");"+x.varName+".parentNode.insertBefore(elementFragment, "+x.varName+");} else {let curr = "+g.varName+".nextSibling;while(curr !== "+x.varName+") {curr.parentNode.removeChild(curr);curr = "+g.varName+".nextSibling;}}")}return E},Sn=function(r,n){for(var t=Qn('document.createElement("'+(n.aliases[r.name.toLowerCase()]||r.name)+'")',n),a=0,o=r.attributes.length;a<o;a++)!function(a,o){var i=r.attributes[a],u=i.name,s=i.value,c=pn(u);if(s){if(s.type===e.PCExpressionType.STRING){var p=s;t.content+=t.varName+'.setAttribute("'+u+'", '+JSON.stringify(p.value)+");\n"}else if(s.type===e.PCExpressionType.STRING_BLOCK||s.type===e.PCExpressionType.BLOCK){var E=t.varName+"$$"+c+"$$currentValue";t.content+="let "+E+";\n";var l=void 0;l=s.type===e.PCExpressionType.STRING_BLOCK?hn(E,s.values.map(function(r){return r.type===e.PCExpressionType.BLOCK?cn(r.value.value):JSON.stringify(r.value)}).join(" + "),function(e){return t.varName+'.setAttribute("'+u+'", '+e+")"},n):hn(E,cn(s.value.value),function(e){return"__setElementProperty("+t.varName+', "'+c+'", '+e+")"},n),t.bindings.push(l)}}else t.content+=t.varName+'.setAttribute("'+u+'", "true");'}(a);return t},hn=function(e,r,n,t){return"let $$newValue = "+r+";if ($$newValue !== "+e+") {"+e+" = $$newValue;"+n(e)+"}"},Cn=function(e,r){return void 0===r&&(r=""),"for (let __i = 0, n = "+e+".length; __i < n; __i++) {"+e+"[__i]("+r+");}"},On=function(e,r){switch(e.startTag.name){case"style":return An(e,r);default:return Nn(e.startTag,Hn(e,r),r)}},An=function(e,r){var n=Qn('document.createElement("style")',r);(n=Jn(n,e,r)).content+="if (window.$synthetic) {";var t=mn(e.childNodes[0],r);return n.content+=t.content+(n.varName+".$$setSheet(")+t.varName+");",n.content+="} else {"+n.varName+".textContent = "+JSON.stringify(Vn(e.childNodes[0]))+";}",n},mn=function(e,r){var n=Ln(e.children,r),t=Xn("new CSSStyleSheet(["+n.map(function(e){return e.varName}).join(",")+"])",r);return t=Jn(t,e,r),t.content=n.map(function(e){return e.content}).join("\n")+t.content,t},Ln=function(e,r){return e.map(function(e){return gn(e,r)}).filter(Boolean)},gn=function(r,n){switch(r.type){case e.CSSExpressionType.AT_RULE:return xn(r,n);case e.CSSExpressionType.STYLE_RULE:return Yn(r,n)}throw new Error("Unexpected rule "+r.type)},xn=function(e,r){switch(e.name){case"media":return In(e,r);case"keyframes":return Un(e,r);case"font-face":return Pn(e,r);case"import":return bn(e,r);case"charset":return Kn(e,r)}},In=function(e,r){return Dn(e,r,"CSSMediaRule",Yn)},Pn=function(e,r){return Jn(Xn("new CSSFontFaceRule("+Gn(Mn(e),r)+")",r),e,r)},Mn=function(r){return r.children.filter(function(r){return r.type===e.CSSExpressionType.DECLARATION_PROPERTY})},Un=function(e,r){return Dn(e,r,"CSSKeyframesRule",Bn)},Dn=function(e,r,n,t){var a=e.children.map(function(e){return t(e,r)}).filter(Boolean),o=Xn("new "+n+"("+JSON.stringify(e.params.join(" "))+", ["+a.map(function(e){return e.varName}).join(",")+"])",r);return o.content=a.map(function(e){return e.content}).join("\n")+o.content,o},Bn=function(e,r){return wn(e,"CSSKeyframeRule",r)},bn=function(e,r){return null},Kn=function(e,r){return null},wn=function(e,r,n){return Xn("new "+r+"("+JSON.stringify(e.selectorText)+", "+Gn(Mn(e),n)+")",n)},Yn=function(e,r){return wn(e,"CSSStyleRule",r)},Gn=function(e,r){for(var n="{",t=0,a=e;t<a.length;t++){var o=a[t];n+='"'+o.name+'": "'+o.value.replace(/"/g,'\\"').replace(/[\s\r\n\t]+/g," ")+'", '}return"CSSStyleDeclaration.fromObject("+(n+="}")+")"},Vn=function(e,r){return void 0===r&&(r=function(e){return e}),e.children.map(function(e){return Fn(e,r)}).filter(Boolean).join(" ")},Fn=function(r,n){switch(r.type){case e.CSSExpressionType.AT_RULE:var t=r;if("charset"===t.name||"import"===t.name)return null;i="@"+t.name+" "+t.params+" {";return i+=t.children.map(function(e){return Fn(e,n)}).filter(Boolean).join(" "),i+="}";case e.CSSExpressionType.DECLARATION_PROPERTY:var a=r;return a.name+": "+a.value+";";case e.CSSExpressionType.STYLE_RULE:var o=r,i=n(o.selectorText,o)+" {";return i+=o.children.map(function(e){return Fn(e,n)}).filter(Boolean).join(""),i+="}"}},kn=function(r,n){for(var t=[],a=0,o=r.length;a<o;a++){var i=r[a];if(i.type===e.PCExpressionType.TEXT_NODE&&/^[\s\r\n\t]+$/.test(i.value)){var u=r[a-1],s=r[a+1];if((!u||p(u))&&(!s||p(s)))continue}var c=dn(i,n);c&&t.push(c)}return t},Hn=function(e,r){var n=Sn(e.startTag,r);n=Jn(n,e,r);for(var t=kn(e.childNodes,r),a=0,o=t.length;a<o;a++){var i=t[a];n.content+=i.content,n.content+=n.varName+".appendChild("+i.varName+");\n",(u=n.bindings).push.apply(u,i.bindings)}return n;var u},jn=function(e,r,n){var t=$n(e,n);return{varName:t,bindings:[],content:r?"let "+t+" = "+r+";\n":"let "+t+";\n"}},$n=function(e,r){return e+"_"+r.varCount++},Qn=function(e,r){return jn("node",e,r)},Xn=function(e,r){return jn("rule",e,r)},Wn=function(e){var r=Qn('document.createDocumentFragment("")',e),n=Qn('document.createTextNode("")',e),t=Qn('document.createTextNode("")',e);return r.content+=n.content+""+t.content+r.varName+".appendChild("+n.varName+");"+r.varName+".appendChild("+t.varName+");",{fragment:r,start:n,end:t}},Jn=function(e,r,n){var t=a({uri:n.uri,type:r.type},r.location);return e.content+=e.varName+".source = "+JSON.stringify(t)+";",e},qn=function(e){},zn={},Zn=function(e,r){if(zn[e])return zn[e];var n={filePath:r,source:e,diagnostics:[],scanner:G(e)};return zn[e]={root:et(n),diagnostics:n.diagnostics}},et=function(r){for(var n,t=r.scanner,a=t.curr(),o=[];!t.ended();)if(o.push(rt(r)),!n){if((n=t.curr())&&n.type!==g.WHITESPACE&&n.type!==g.COMMA&&!De(r,[g.COMMA]))return null;t.next()}return 1===o.length?o[0]:{type:n.type===g.WHITESPACE?e.DcExpressionType.SPACED_LIST:e.DcExpressionType.COMMA_LIST,items:o,location:B(a,t.curr(),t.source)}},rt=function(e){var r=e.scanner;switch(xe(e),r.curr().type){case g.SINGLE_QUOTE:case g.DOUBLE_QUOTE:return re(e);case g.HASH:return nt(e);case g.NUMBER:return tt(e);case g.MINUS:return r.hasNext()&&r.peek(1).type===g.NUMBER?tt(e):ot(e);case g.TEXT:return ot(e);default:Pe(r.source,r.curr())}},nt=function(r){for(var n=r.scanner,t=n.curr(),a="";!n.ended()&&n.curr().type!==g.WHITESPACE;)a+=n.curr().value,n.next();return{type:e.DcExpressionType.COLOR,value:a,location:B(t,n.curr(),n.source)}},tt=function(r){var n=r.scanner,t=n.curr(),a=at(r),o="";return n.ended()||n.curr().type===g.WHITESPACE||n.curr().type===g.COMMA||n.curr().type===g.PAREN_CLOSE||(o=n.curr().value,n.next()),{type:e.DcExpressionType.MEASUREMENT,value:a,unit:o,location:B(t,n.curr(),n.source)}},at=function(e){var r=e.scanner,n=r.curr().value;return"-"===n&&(n+=r.next().value),r.next(),n},ot=function(r){var n=r.scanner,t=n.curr(),a=ut(r);return n.ended()||n.curr().type!==g.PAREN_OPEN?{type:e.DcExpressionType.KEYWORD,name:a}:{type:e.DcExpressionType.CALL,name:a,params:it(r),location:B(t,n.curr(),n.source)}},it=function(e){for(var r=e.scanner,n=[];!r.ended()&&r.curr().type!==g.PAREN_CLOSE;)r.next(),xe(e),n.push(rt(e));return De(e,[g.PAREN_CLOSE])?(r.next(),n):null},ut=function(e){for(var r=e.scanner,n="";!r.ended()&&r.curr().type!==g.WHITESPACE&&r.curr().type!==g.PAREN_OPEN&&r.curr().type!==g.PAREN_CLOSE;)n+=r.curr().value,r.next();return n},st=function(r){switch(r.type){case e.DcExpressionType.SPACED_LIST:return(n=r).items.map(st).join(" ");case e.DcExpressionType.COMMA_LIST:var n=r;return n.items.map(st).join(", ");case e.DcExpressionType.KEYWORD:return r.name;case e.DcExpressionType.CALL:var t=r;return t.name+"("+t.params.map(st).join(", ")+")";case e.DcExpressionType.COLOR:return r.value;case e.BKExpressionType.STRING:return JSON.stringify(r.value);case e.DcExpressionType.MEASUREMENT:var a=r;return""+a.value+a.unit;default:throw new Error("Unable to stringify CSS declaration value type "+r.type)}},ct="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},pt=t(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.MUTATED="MUTATED",r.SET_VALUE_MUTATION="SET_VALUE_MUTATION",r.INSERT_CHILD_MUTATION="INSERT_CHILD_MUTATION",r.REMOVE_CHILD_MUTATION="REMOVE_CHILD_MUTATION",r.SET_PROPERTY_MUTATION="SET_PROPERTY_MUTATION",r.REMOVE_MUTATION="REMOVE_MUTATION",r.createMutationEvent=function(e){return{type:r.MUTATED,mutation:e}},r.createSetValueMutation=function(e,r,n){return{type:e,target:r,newValue:n}},r.createInsertChildMutation=function(e,r,n,t,a){return void 0===t&&(t=Number.MAX_SAFE_INTEGER),{type:e,target:r,child:n,index:t,clone:a}},r.createRemoveChildMutation=function(e,r,n,t){return{type:e,target:r,child:n,index:t}},r.createMoveChildMutation=function(e,r,n,t,a){return{type:e,target:r,child:n,index:t,oldIndex:a}},r.createPropertyMutation=function(e,r,n,t,a,o,i){return{type:e,target:r,name:n,newValue:t,oldValue:a,oldName:o,index:i}},r.createRemoveMutation=function(e,r,n,t,a,o){return{type:e,target:r}}});n(pt);pt.MUTATED,pt.SET_VALUE_MUTATION,pt.INSERT_CHILD_MUTATION,pt.REMOVE_CHILD_MUTATION,pt.SET_PROPERTY_MUTATION,pt.REMOVE_MUTATION,pt.createMutationEvent,pt.createSetValueMutation,pt.createInsertChildMutation,pt.createRemoveChildMutation,pt.createMoveChildMutation,pt.createPropertyMutation,pt.createRemoveMutation;var Et=t(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.STRING_REPLACE="STRING_REPLACE",r.createStringMutation=function(e,n,t){return void 0===t&&(t=""),{startIndex:e,endIndex:n,value:t,type:r.STRING_REPLACE}},r.editString=function(e,r,n){void 0===n&&(n=[]);for(var t=e,a=n.length,o=n.concat(r),i=0,u=r.length;i<u;i++){for(var s=r[i],c=s.startIndex,p=s.endIndex,E=s.value,l=c,T=p,f=!1,d=c===p,y=i+a,v=0;v<y;v++){var _=o[v],R=_.startIndex,N=_.endIndex,S=_.value,h=R===N,C=c===R,O=p===N,A=C&&d,m=O&&d,L=C&&h,g=O&&h,x=A||m||L||g;if(R<p&&R>c&&(T-=p-R),N>c&&N<p&&(l+=N-c),(c>=R&&p<=N||c<R&&p>=N)&&!x){f=!0;break}if(R<=c&&p>R){var I=S.length-(N-R);l=Math.max(0,l+I),T=Math.max(0,T+I)}}f||(t=t.substr(0,l)+E+t.substr(T))}return t}});n(Et);Et.STRING_REPLACE,Et.createStringMutation,Et.editString;var lt=t(function(e,r){function n(e,n,t){for(var a=[].concat(e),o=[].concat(e),i=[].concat(n),u=[],s=[],c=0,p=o.length;c<p;c++){for(var E=o[c],l=void 0,T=1/0,f=0,d=i.length;f<d;f++){var y=t(E,R=i[f]);if(~y&&y<T&&(l=R,T=y),0===T)break}null!=l&&(o.splice(c--,1),p--,i.splice(i.indexOf(l),1),s[n.indexOf(l)]=[E,l])}for(c=o.length;c--;){var E=o[c],v=e.indexOf(E);u.push(r.createArrayDeleteMutation(E,v)),a.splice(v,1)}for(var c=0,p=i.length;c<p;c++){R=i[c];s[v=n.indexOf(R)]=[void 0,R]}for(var c=0,p=s.length;c<p;c++)if(null!=s[c]){var _=s[c],E=_[0],R=_[1],N=c;if(null==E)u.push(r.createArrayInsertMutation(N,R)),a.splice(N,0,R);else{var S=a.indexOf(E);u.push(r.createArrayUpdateMutation(e.indexOf(E),S,R,N)),S!==N&&(a.splice(S,1),a.splice(N,0,E))}}return r.createArrayMutation(u)}function t(e,n,t,a){void 0===t&&(t=function(e,r){return r}),void 0===a&&(a=function(e){return e});var o=e.slice();return r.eachArrayValueMutation(n,{insert:function(e){var r=e.index,n=e.value;o.splice(r,0,a(n))},delete:function(e){var r=e.index;o.splice(r,1)},update:function(e){var r=e.patchedOldIndex,n=e.newValue,a=e.index,i=o[r],u=t(i,n);u===i&&r===a||(r!==a&&o.splice(r,1),o.splice(a,0,u))}}),o}Object.defineProperty(r,"__esModule",{value:!0}),r.ARRAY_DIFF="ARRAY_DIFF",r.ARRAY_INSERT="ARRAY_INSERT",r.ARRAY_UPDATE="ARRAY_UPDATE",r.ARRAY_DELETE="ARRAY_DELETE",r.createArrayInsertMutation=function(e,n){return{type:r.ARRAY_INSERT,index:e,value:n}},r.createArrayUpdateMutation=function(e,n,t,a){return{type:r.ARRAY_UPDATE,index:a,newValue:t,originalOldIndex:e,patchedOldIndex:n}},r.createArrayDeleteMutation=function(e,n){return{type:r.ARRAY_DELETE,value:e,index:n}},r.createArrayMutation=function(e){return{type:r.ARRAY_DIFF,mutations:e}},r.diffArray=n,r.eachArrayValueMutation=function(e,n){e.mutations.forEach(function(e){switch(e.type){case r.ARRAY_INSERT:return n.insert(e);case r.ARRAY_DELETE:return n.delete(e);case r.ARRAY_UPDATE:return n.update(e)}})},r.patchArray=t});n(lt);lt.ARRAY_DIFF,lt.ARRAY_INSERT,lt.ARRAY_UPDATE,lt.ARRAY_DELETE,lt.createArrayInsertMutation,lt.createArrayUpdateMutation,lt.createArrayDeleteMutation,lt.createArrayMutation,lt.diffArray,lt.eachArrayValueMutation,lt.patchArray;var Tt=t(function(e,r){function n(e){for(var n in e)r.hasOwnProperty(n)||(r[n]=e[n])}Object.defineProperty(r,"__esModule",{value:!0}),n(pt),n(Et),n(lt)});n(Tt);var ft=Tt.createStringMutation,dt=t(function(e,r){Object.defineProperty(r,"__esModule",{value:!0});!function(e){e.PX="PX",e.PERC="%",e.VW="vw",e.VH="vh",e.CM="cm",e.EM="em",e.EX="ex",e.IN="in",e.MM="mm",e.PC="pc",e.PT="pt",e.VMIN="vmin"}(r.CSSMeasurementTypes||(r.CSSMeasurementTypes={}));!function(e){e.HORIZONTAL="HORIZONTAL",e.VERTICAL="VERTICAL"}(r.Axis||(r.Axis={}));!function(e){e[e.azimuth=0]="azimuth",e[e.borderCollapse=1]="borderCollapse",e[e.borderSpacing=2]="borderSpacing",e[e.captionSide=3]="captionSide",e[e.color=4]="color",e[e.cursor=5]="cursor",e[e.direction=6]="direction",e[e.elevation=7]="elevation",e[e.emptyCells=8]="emptyCells",e[e.fontFamily=9]="fontFamily",e[e.fontSize=10]="fontSize",e[e.fontStyle=11]="fontStyle",e[e.fontVariant=12]="fontVariant",e[e.fontWeight=13]="fontWeight",e[e.font=14]="font",e[e.letterSpacing=15]="letterSpacing",e[e.lineHeight=16]="lineHeight",e[e.listStyleImage=17]="listStyleImage",e[e.listStylePosition=18]="listStylePosition",e[e.listStyleType=19]="listStyleType",e[e.listStyle=20]="listStyle",e[e.orphans=21]="orphans",e[e.pitchRange=22]="pitchRange",e[e.pitch=23]="pitch",e[e.quotes=24]="quotes",e[e.richness=25]="richness",e[e.speakHeader=26]="speakHeader",e[e.speakNumeral=27]="speakNumeral",e[e.speakPunctuation=28]="speakPunctuation",e[e.speak=29]="speak",e[e.speechRate=30]="speechRate",e[e.stress=31]="stress",e[e.textAlign=32]="textAlign",e[e.textIndent=33]="textIndent",e[e.textDecoration=34]="textDecoration",e[e.textTransform=35]="textTransform",e[e.visibility=36]="visibility",e[e.voiceFamily=37]="voiceFamily",e[e.volume=38]="volume",e[e.whiteSpace=39]="whiteSpace",e[e.widows=40]="widows",e[e.wordSpacing=41]="wordSpacing"}(r.INHERITED_CSS_STYLE_PROPERTIES||(r.INHERITED_CSS_STYLE_PROPERTIES={}))});n(dt);dt.CSSMeasurementTypes,dt.Axis,dt.INHERITED_CSS_STYLE_PROPERTIES;var yt=t(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.CSS_STYLE_RULE_SET_SELECTOR_TEXT="CSS_STYLE_RULE_SET_SELECTOR_TEXT",r.CSS_STYLE_RULE_SET_STYLE="CSS_STYLE_RULE_SET_STYLE",r.CSS_STYLE_RULE_SET_STYLE_PROPERTY="CSS_STYLE_RULE_SET_STYLE_PROPERTY",r.CSS_PARENT_INSERT_RULE="CSS_PARENT_INSERT_RULE",r.CSS_PARENT_DELETE_RULE="CSS_PARENT_DELETE_RULE",r.CSS_PARENT_MOVE_RULE="CSS_PARENT_MOVE_RULE",r.CSS_INSERT_CSS_RULE_TEXT="CSS_INSERT_CSS_RULE_TEXT"});n(yt);yt.CSS_STYLE_RULE_SET_SELECTOR_TEXT,yt.CSS_STYLE_RULE_SET_STYLE,yt.CSS_STYLE_RULE_SET_STYLE_PROPERTY,yt.CSS_PARENT_INSERT_RULE,yt.CSS_PARENT_DELETE_RULE,yt.CSS_PARENT_MOVE_RULE,yt.CSS_INSERT_CSS_RULE_TEXT;var vt=t(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.SET_ELEMENT_ATTRIBUTE_EDIT="setElementAttributeEdit",r.ATTACH_SHADOW_ROOT_EDIT="attachShadowRootEdit",r.SET_TEXT_CONTENT="setTextContent",r.INSERT_HTML_EDIT="INSERT_HTML_EDIT",r.INSERT_CHILD_NODE_EDIT="INSERT_CHILD_NODE_EDIT",r.REMOVE_CHILD_NODE_EDIT="REMOVE_CHILD_NODE_EDIT",r.MOVE_CHILD_NODE_EDIT="MOVE_CHILD_NODE_EDIT",r.UPDATE_VALUE_NODE="UPDATE_VALUE_NODE"});n(vt);vt.SET_ELEMENT_ATTRIBUTE_EDIT,vt.ATTACH_SHADOW_ROOT_EDIT,vt.SET_TEXT_CONTENT,vt.INSERT_HTML_EDIT,vt.INSERT_CHILD_NODE_EDIT,vt.REMOVE_CHILD_NODE_EDIT,vt.MOVE_CHILD_NODE_EDIT,vt.UPDATE_VALUE_NODE;var _t=t(function(e,r){function n(e){for(var n in e)r.hasOwnProperty(n)||(r[n]=e[n])}Object.defineProperty(r,"__esModule",{value:!0}),n(dt),n(yt),n(vt)});n(_t);var Rt=_t,Nt=Rt.UPDATE_VALUE_NODE,St=Rt.SET_ELEMENT_ATTRIBUTE_EDIT,ht=Rt.INSERT_CHILD_NODE_EDIT,Ct=Rt.REMOVE_CHILD_NODE_EDIT,Ot=Rt.INSERT_HTML_EDIT,At=(Rt.CSS_INSERT_CSS_RULE_TEXT,Rt.CSS_PARENT_DELETE_RULE,Rt.CSS_STYLE_RULE_SET_SELECTOR_TEXT,Rt.CSS_STYLE_RULE_SET_STYLE_PROPERTY,t(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.createInsertHTMLMutation=function(e,r,n){return{type:vt.INSERT_HTML_EDIT,html:n,childIndex:r,target:e}}}));n(At);At.createInsertHTMLMutation;var mt=t(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.insertCSSRuleText=function(e,r,n){return{type:yt.CSS_INSERT_CSS_RULE_TEXT,target:e,childIndex:r,cssText:n}}});n(mt);mt.insertCSSRuleText;var Lt=t(function(e,r){function n(e){for(var n in e)r.hasOwnProperty(n)||(r[n]=e[n])}Object.defineProperty(r,"__esModule",{value:!0}),n(At),n(mt)});n(Lt);var gt=t(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),function(e){for(var n in e)r.hasOwnProperty(n)||(r[n]=e[n])}(Lt)});n(gt);var xt=gt.createInsertHTMLMutation,It=function(e,r){return{type:"PC_REMOVE_CHILD_NODE",index:r,target:e}},Pt=function(e){return{type:"PC_REMOVE_NODE",target:e}},Mt=function(e,r){var n=k(e),t=Dt(n.root,r.target.location||r.target.source);if(r.target.source&&console.warn("Mutation target does not match expected type."),!t)return[ft(0,0,"")];switch(r.type){case Nt:return Gt(t,r);case St:return Vt(t,r);case Ct:return Bt(t,r.index);case ht:return Kt(t,r,e);case Ot:return wt(t,r,e);case"PC_REMOVE_CHILD_NODE":return Bt(t,r.index);case"PC_REMOVE_NODE":return bt(t)}return[ft(0,0,"")]},Ut=function(e,r){return e.location.start.line===r.start.line&&e.location.start.column===r.start.column&&e.location.end.line===r.end.line&&e.location.end.column===r.end.column},Dt=function(r,n){if(Ut(r,n))return r;if(r.type===e.PCExpressionType.FRAGMENT||r.type===e.PCExpressionType.ELEMENT)for(var t=0,a=r.childNodes;t<a.length;t++){var o=a[t],i=Dt(o,n);if(i)return i}},Bt=function(e,r){var n=e.childNodes[r];return bt(n)},bt=function(e){return[ft(e.location.start.pos,e.location.end.pos,"")]},Kt=function(e,r,n){var t=r.target,a=r.index,o=r.child;return wt(e,xt(t,a,o.nodeValue||o.outerHTML),n)},wt=function(r,n,t){var a=n.childIndex,o=n.html;if(r.type===e.PCExpressionType.SELF_CLOSING_ELEMENT)return[ft(Yt((u=r).location.end.pos-2,t),u.location.end.pos,">"+o+"</"+u.name+">")];var i=r.childNodes[a];if(!i){var u=r;return[ft(u.startTag.location.end.pos,u.startTag.location.end.pos,o)]}return[ft(i.location.start.pos,i.location.start.pos,o)]},Yt=function(e,r){var n=r.substr(0,e).split("").reverse().join("").match(/^([\s\r\n\t]+)/)||["",""];return e-n[1].length},Gt=function(e,r){var n=r.newValue;return[ft(e.location.start.pos,e.location.end.pos,n)]},Vt=function(r,n){var t;r.type===e.PCExpressionType.SELF_CLOSING_ELEMENT?t=r:r.type===e.PCExpressionType.ELEMENT&&(t=r.startTag);for(var a,o=n.name,i=n.newValue&&'"'+n.newValue+'"',u=0,s=t.attributes;u<s.length;u++){var c=s[u];if(c.name===o)return a=!0,i?[ft(c.value.location.start.pos,c.value.location.end.pos,i)]:[ft(c.location.start.pos-1,c.location.end.pos,"")]}if(!a){var p=t.location.start.pos+t.name.length+1;return[ft(p,p,!0===n.newValue?o:" "+o+"="+i)]}},Ft=t(function(e,r){Object.defineProperty(r,"__esModule",{value:!0});!function(e){e[e.ELEMENT=1]="ELEMENT",e[e.TEXT=3]="TEXT",e[e.DOCUMENT=9]="DOCUMENT",e[e.DOCUMENT_FRAGMENT=11]="DOCUMENT_FRAGMENT"}(r.NodeType||(r.NodeType={}));!function(e){e[e.STYLE_SHEET=99]="STYLE_SHEET",e[e.STYLE_RULE=1]="STYLE_RULE",e[e.MEDIA_RULE=4]="MEDIA_RULE",e[e.FONT_FACE_RULE=5]="FONT_FACE_RULE",e[e.KEYFRAME_RULE=7]="KEYFRAME_RULE",e[e.UNKNOWN_RULE=0]="UNKNOWN_RULE"}(r.CSSRuleType||(r.CSSRuleType={}))});n(Ft);Ft.NodeType,Ft.CSSRuleType;var kt=t(function(e,r){function n(e,r){void 0===r&&(r=function(e){return e});var n=1,t=Symbol(),u=Symbol();return function(){a&&Date.now()-o>a&&(a=Date.now(),i={});for(var s="",c=i,p=0,E=arguments.length;p<E;p++){var l=arguments[p],T=void 0;l&&"object"==typeof l?(c=l,T=l[u]&&l[u].self===l?l[u].value:(l[u]={self:l,value:":"+n++}).value):T=":"+l,s+=T}return c[t]&&c[t].self===c||(c[t]={self:c}),r(c[t].hasOwnProperty(s)?c[t][s]:c[t][s]=e.apply(this,arguments))}}var t=ct&&ct.__assign||Object.assign||function(e){for(var r,n=1,t=arguments.length;n<t;n++){r=arguments[n];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e};Object.defineProperty(r,"__esModule",{value:!0});var a=0,o=3e5,i={};r.weakMemo=n,r.pushChildNode=function(e,r){return t({},e,{childNodes:e.childNodes.concat([r])})},r.stringifyNode=n(function(e){switch(e.type){case Ft.NodeType.TEXT:return e.value;case Ft.NodeType.ELEMENT:for(var n="<"+(u=e).tagName+" ",t=0,a=u.attributes.length;t<a;t++){var o=u.attributes[t];n+=" "+o.name+"="+JSON.stringify(o.value)}n+=">";for(var t=0,i=u.childNodes.length;t<i;t++)n+=r.stringifyNode(u.childNodes[t]);return n+="</"+u.tagName+">";case Ft.NodeType.DOCUMENT_FRAGMENT:case Ft.NodeType.DOCUMENT:for(var u=e,n="",t=0,s=u.childNodes.length;t<s;t++)n+=r.stringifyNode(u.childNodes[t]);return n}}),r.getAttribute=function(e,r){return r.attributes.find(function(r){return r.name===e})},r.hasAttribute=function(e,n){return null!=r.getAttribute(e,n)},r.getAttributeValue=function(e,n){var t=r.getAttribute(e,n);return t&&t.value},r.getNodeAncestor=n(function(e,n){for(var t=r.flattenObjects(n),a=t[t[e.id].parentId],o=[];a;)o.push(a),a=t[a.parentId];return o}),r.getNestedObjectById=n(function(e,r){var n=s(r);return n[e]&&n[e].value}),r.flattenObjects=n(function(e,n){switch(e.type){case Ft.NodeType.TEXT:return i={},i[e.id]={parentId:n,value:e},i;case Ft.NodeType.ELEMENT:var t=e,a=(c={},c[t.id]={parentId:n,value:e},c),o=r.getAttributeValue("style",t);return o&&"object"==typeof o&&(a[o.id]={parentId:t.id,value:o}),"style"===t.tagName?Object.assign(a,u(t.sheet,t.id)):(t.shadow&&Object.assign(a,r.flattenObjects(t.shadow)),Object.assign(a,s(t))),a;case Ft.NodeType.DOCUMENT:case Ft.NodeType.DOCUMENT_FRAGMENT:return s(e)}var i,c});var u=n(function(e,r){switch(e.type){case Ft.CSSRuleType.MEDIA_RULE:case Ft.CSSRuleType.STYLE_SHEET:var n=e,t=(o={},o[n.id]={parentId:r,value:e},o);return Object.assign(t,c(n)),t;case Ft.CSSRuleType.STYLE_RULE:var a=e;return i={},i[a.id]={parentId:r,value:e},i[a.style.id]={parentId:a.id,value:a.style},i}var o,i}),s=n(function(e){for(var n={},t=0,a=e.childNodes.length;t<a;t++)Object.assign(n,r.flattenObjects(e.childNodes[t],e.id));return n}),c=n(function(e){for(var r={},n=0,t=e.rules.length;n<t;n++)Object.assign(r,u(e.rules[n],e.id));return r})});n(kt);kt.weakMemo,kt.pushChildNode,kt.stringifyNode,kt.getAttribute,kt.hasAttribute,kt.getAttributeValue,kt.getNodeAncestor,kt.getNestedObjectById,kt.flattenObjects;var Ht=t(function(e,r){var n=ct&&ct.__assign||Object.assign||function(e){for(var r,n=1,t=arguments.length;n<t;n++){r=arguments[n];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e};Object.defineProperty(r,"__esModule",{value:!0});var t=Symbol();r.compressDocument=function(e){if(e[t])return e[t];var r=[];return e[t]=[r,a(e,r)]};var a=function(e,r){switch(e.type){case Ft.NodeType.TEXT:return[e.type,e.id,u(e.source,r),e.value];case Ft.NodeType.ELEMENT:for(var n=e,t=n.type,i=n.id,s=n.source,c=n.tagName,p=n.attributes,E=n.shadow,l=n.childNodes,T=[],f=0,d=p;f<d.length;f++){var y=d[f];T.push([y.name,y.value])}var v=[t,i,u(e.source,r),c,T,E?a(E,r):null,l.map(function(e){return a(e,r)})];return"style"===c&&v.push(o(e.sheet,r)),v;case Ft.NodeType.DOCUMENT_FRAGMENT:case Ft.NodeType.DOCUMENT:var _=e,t=_.type,i=_.id,s=_.source,l=_.childNodes;return[t,i,u(s,r),l.map(function(e){return a(e,r)})]}},o=function(e,r){return[e.type,e.id,u(e.source,r),e.rules.map(function(e){return i(e,r)})]},i=function(e,r){switch(e.type){case Ft.CSSRuleType.STYLE_RULE:var n=e,t=n.type,a=n.id,o=n.selectorText,s=n.style,c=n.source,p=[];for(var E in s)p.push([E,s[E]]);return[t,a,u(c,r),o,s.id,p];case Ft.CSSRuleType.MEDIA_RULE:var l=e,t=l.type,a=l.id,c=(l.conditionText,l.source),T=l.rules;return[t,a,u(c,r),T.map(function(e){return i(e,r)})]}},u=function(e,r){return-1===r.indexOf(e.uri)&&r.push(e.uri),[e.type,r.indexOf(e.uri),e.range.start.line,e.range.start.column,e.range.start.pos,e.range.end.line,e.range.end.column,e.range.end.pos]};r.uncompressDocument=function(e){var r=e[0],n=e[1];return s(n,r)};var s=function(e,r){switch(e[0]){case Ft.NodeType.TEXT:var t=e[0],a=e[1],o=e[2],i=e[3];return{type:t,id:a,source:E(o,r),value:i};case Ft.NodeType.ELEMENT:for(var t=e[0],a=e[1],o=e[2],u=e[3],p=e[4],l=e[5],T=e[6],f=[],d=0,y=p;d<y.length;d++){var v=y[d],_=v[0],i=v[1];f.push({name:_,value:i})}var R={type:t,id:a,tagName:u,attributes:f,source:E(o,r),shadow:l&&s(l,r),childNodes:T.map(function(e){return s(e,r)})};return"style"===u&&(R=n({},R,{sheet:c(e[7],r)})),R;case Ft.NodeType.DOCUMENT_FRAGMENT:case Ft.NodeType.DOCUMENT:var t=e[0],a=e[1],o=e[2],T=e[3];return{type:t,id:a,source:E(o,r),childNodes:T.map(function(e){return s(e,r)})}}},c=function(e,r){var n=e[0],t=e[1],a=e[2],o=e[3];return{id:t,type:n,source:E(a,r),rules:o.map(function(e){return p(e,r)})}},p=function(e,r){switch(e[0]){case Ft.CSSRuleType.STYLE_RULE:for(var n=e[0],t=e[1],a=e[2],o=e[3],i=e[4],u=e[5],s={id:i},c=0,l=u.length;c<l;c++){var T=u[c],f=T[0],d=T[1];s[f]=d}return{type:n,id:t,source:E(a,r),selectorText:o,style:s};case Ft.CSSRuleType.MEDIA_RULE:var n=e[0],t=e[1],a=e[2],y=e[3],v=e[4];return{type:n,id:t,source:E(a,r),conditionText:y,rules:v.map(function(e){return p(e,r)})}}},E=function(e,r){var n=e[0],t=e[1],a=e[2],o=e[3],i=e[4],u=e[5],s=e[6],c=e[7];return{type:n,uri:r[t],range:{start:{line:a,column:o,pos:i},end:{line:u,column:s,pos:c}}}}});n(Ht);Ht.compressDocument,Ht.uncompressDocument;var jt=t(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.renderDOM=function(e,r){var t={};return r.appendChild(n(e,r.ownerDocument,t)),t};var n=function(e,r,a){switch(e.type){case Ft.NodeType.TEXT:return r.createTextNode(e.value);case Ft.NodeType.ELEMENT:var o=e,i=o.tagName,u=o.id,s=o.shadow,c=o.childNodes,p=o.attributes,E=a[u]=r.createElement(i);s&&E.attachShadow({mode:"open"}).appendChild(n(s,r,a)),"style"===i&&t(e.sheet,E);for(var l=0,T=p.length;l<T;l++){var f=p[l];"style"===f.name?"object"==typeof f.value&&Object.assign(E[f.name],f.value):f.value&&E.setAttribute(f.name,f.value)}for(var l=0,d=c.length;l<d;l++)E.appendChild(n(c[l],r,a));return E;case Ft.NodeType.DOCUMENT_FRAGMENT:for(var c=e.childNodes,y=r.createDocumentFragment(),l=0,v=c.length;l<v;l++)y.appendChild(n(c[l],r,a));return y;default:return console.warn("Unable to render node"),r.createTextNode("")}},t=function(e,r){for(var n="",t=0,o=e.rules.length;t<o;t++){e.rules[t];var i=a(e.rules[t]);i&&(n+=i+"\n")}r.textContent=n},a=function(e){switch(e.type){case Ft.CSSRuleType.STYLE_RULE:var r=e,n=r.selectorText,t=r.style,o=n+" {";for(var i in t)o+=i+": "+t[i]+";";return o+" }";case Ft.CSSRuleType.MEDIA_RULE:var u=e;return"@media "+u.conditionText+" { "+u.rules.map(a)+" }"}};r.computedDOMInfo=function(e){var r={};for(var n in e){var t=e[n];r[n]={bounds:t.getBoundingClientRect(),style:t.ownerDocument.defaultView.getComputedStyle(t)}}return r},r.patchDOM=function(e,r){}});n(jt);jt.renderDOM,jt.computedDOMInfo,jt.patchDOM;var $t=t(function(e,r){function n(e){for(var n in e)r.hasOwnProperty(n)||(r[n]=e[n])}Object.defineProperty(r,"__esModule",{value:!0}),n(Ft),n(kt),n(Ht),n(jt)});n($t);var Qt=$t,Xt=Qt.NodeType,Wt=Qt.pushChildNode,Jt=Qt.CSSRuleType,qt=function(r){var n=r.entry,t=n.filePath,a=n.componentId,o=n.previewName,i=r.graph,u="__memo$$"+t+a+o;if(i[u])return i[u];var s={idSeed:Math.floor(1e3+8999*Math.random())+"",refCount:0,currentProps:{},globalStyles:Ge(i),currentURI:Ve(i)[a],graph:i,components:Ye(i),diagnostics:[]},c=s.components[a];if(!c)return{document:null,diagnostics:[{type:e.DiagnosticType.ERROR,message:'Component "'+a+'" does not exist',filePath:null,location:null}]};var p=o?nr(o,c):c.previews[0];return p?i[u]={document:Zt(p,s),diagnostics:[]}:{document:null,diagnostics:[{type:e.DiagnosticType.ERROR,message:'Preview "'+o+'" does not exist for component "'+a+'"',filePath:null,location:null}]}},zt=function(e){return e.idSeed+ ++e.refCount},Zt=function(e,r){for(var n={id:zt(r),type:Xt.DOCUMENT_FRAGMENT,childNodes:[],source:Ea(e,r)},t=0,a=r.globalStyles.length;t<a;t++)n=aa(n,r.globalStyles[t],r);return n=oa(n,e.childNodes,r)},ea=function(r,n,t){for(var o,i=n.type===e.PCExpressionType.SELF_CLOSING_ELEMENT?n:n.startTag,u=0,s=i.modifiers.length;u<s;u++){var c=i.modifiers[u].value;if(c.type===e.BKExpressionType.REPEAT){o=c;break}}return o?be(pa(o.each,t),function(e,i){var u=t.currentProps;t.currentProps=a({},t.currentProps,(s={},s[o.asValue.name]=e,s[o.asKey?o.asKey.name:"__i"]=i,s)),r=ra(r,n,t),t.currentProps=u;var s}):r=ra(r,n,t),r},ra=function(r,n,t){var a,o;if(n.type===e.PCExpressionType.SELF_CLOSING_ELEMENT)o=[],a=n;else{var i=n;o=i.childNodes,a=i.startTag}var u=a.name;if("link"===u)return r;for(var s=[],c={},p=0,E=a.attributes.length;p<E;p++){var l=a.attributes[p],T=na(l.name,ta(l.value,t));c[l.name]=T,s.push({name:l.name,value:T})}for(var p=0,E=a.modifiers.length;p<E;p++){var f=a.modifiers[p].value;f.type===e.BKExpressionType.BIND&&Object.assign(c,pa(f,t)||{})}if("style"===u){var d={id:zt(t),type:Xt.ELEMENT,tagName:u,attributes:s,childNodes:[],source:Ea(n,t),sheet:sa(o[0],t)};return Wt(r,d)}var y,v=t.components[u];if(v){y={type:Xt.DOCUMENT_FRAGMENT,childNodes:[],source:Ea(v.source,t)},v.style&&(y=aa(y,v.style,t));var _=t.currentURI,R=t.currentProps;t.currentURI=Ve(t.graph)[v.id],t.currentProps=c,y=oa(y,v.template.childNodes,t),t.currentURI=_,t.currentProps=R}var N={id:zt(t),type:Xt.ELEMENT,tagName:u,attributes:s,childNodes:[],source:Ea(n,t),shadow:y};return N=oa(N,o,t),r=Wt(r,N)},na=function(e,r){return r},ta=function(r,n){return!r||(r.type===e.PCExpressionType.STRING_BLOCK?r.values.map(function(e){return ta(e,n)}).join(""):r.type===e.PCExpressionType.STRING?r.value:pa(r.value,n))},aa=function(r,n,t){switch(n.type){case e.PCExpressionType.TEXT_NODE:return ia(r,n,t);case e.PCExpressionType.BLOCK:return ua(r,n,t);case e.PCExpressionType.ELEMENT:case e.PCExpressionType.SELF_CLOSING_ELEMENT:return ea(r,n,t);default:return r}},oa=function(r,n,t){for(var a,o=0,i=n.length;o<i;o++){var u=void 0,s=n[o];if(u=s.type===e.PCExpressionType.ELEMENT?s.startTag:s.type===e.PCExpressionType.SELF_CLOSING_ELEMENT?s:null){for(var c=void 0,p=void 0,E=0,l=u.modifiers.length;E<l;E++){var T=u.modifiers[E].value;T.type===e.BKExpressionType.IF||T.type===e.BKExpressionType.ELSEIF?(c=T,p=!0):T.type===e.BKExpressionType.ELSE&&(p=!0)}if(p){if(c?!pa(c.condition,t):a)continue;a=!0}}r=aa(r,n[o],t)}return r},ia=function(e,r,n){return Wt(e,{id:zt(n),type:Xt.TEXT,value:String(r.value||"").trim()||" ",source:Ea(r,n)})},ua=function(e,r,n){return Wt(e,{id:zt(n),type:Xt.TEXT,value:pa(r.value,n),source:Ea(r,n)})},sa=function(e,r){for(var n=new Array(e.children.length),t=0,a=e.children.length;t<a;t++){var o=e.children[t];n[t]=ca(o,r)}return{rules:n,id:zt(r),type:Jt.STYLE_SHEET,source:Ea(e,r)}},ca=function(r,n){var t=Ea(r,n);switch(r.type){case e.CSSExpressionType.STYLE_RULE:for(var a=r,o=a.selectorText,i=a.children,u={id:zt(n)},s=0,c=i.length;s<c;s++)if((d=i[s]).type===e.CSSExpressionType.DECLARATION_PROPERTY){var p=d;u[p.name]=p.value}return{id:zt(n),type:Jt.STYLE_RULE,selectorText:o,style:u,source:t};case e.CSSExpressionType.AT_RULE:for(var E=r,l=E.name,T=E.params,i=E.children,f=new Array(i.length),s=0,c=i.length;s<c;s++){var d=i[s];f[s]=ca(d,n)}if("media"===l)return{id:zt(n),type:Jt.MEDIA_RULE,conditionText:T.join(" "),rules:f,source:t}}},pa=function(r,n){switch(r.type){case e.BKExpressionType.OPERATION:var t=r,a=t.left,o=t.operator,i=t.right,u=pa(a,n),s=pa(i,n);switch(o){case"+":return u+s;case"-":return u-s;case"*":return u*s;case"/":return u/s;case"%":return u%s;case"&&":return u&&s;case"||":return u||s;case"==":return u==s;case"===":return u===s;case"!=":return u!=s;case"!==":return u!==s;case">":return u>s;case">=":return u>=s;case"<":return u<s;case"<=":return u<=s}case e.BKExpressionType.NUMBER:return Number(r.value);case e.BKExpressionType.STRING:return String(r.value);case e.BKExpressionType.OBJECT:for(var c={},p=0,E=r.properties;p<E.length;p++){var l=E[p],T=l.key,f=l.value;c[T]=pa(f,n)}return c;case e.BKExpressionType.ARRAY:for(var c=[],d=0,y=r.values;d<y.length;d++){f=y[d];c.push(pa(f,n))}return c;case e.BKExpressionType.NOT:return!pa(r.value,n);case e.BKExpressionType.GROUP:case e.BKExpressionType.BIND:return pa(r.value,n);case e.BKExpressionType.IF:case e.BKExpressionType.ELSEIF:return pa(r.condition,n);case e.BKExpressionType.PROP_REFERENCE:case e.BKExpressionType.VAR_REFERENCE:for(var v=fr(r),_=n.currentProps,R=0,N=v.length;R<N&&(_=_[v[R]]);R++);return _;default:return null}},Ea=function(e,r){return{type:e.type,uri:r.currentURI,range:{start:e.location.start,end:e.location.end}}};e.getElementChildNodes=o,e.getElementTagName=i,e.getAttributeStringValue=u,e.getElementAttributes=s,e.getElementModifiers=c,e.isTag=p,e.filterPCElementsByStartTag=E,e.getElementStartTag=l,e.getPCStartTagAttribute=T,e.hasPCStartTagAttribute=f,e.getPCStyleElements=d,e.getPCLinkStyleElements=y,e.getPCCSSElements=v,e.getPCMetaTags=_,e.getPCMetaName=R,e.traversePCAST=N,e.getStartTag=S,e.getPCElementModifier=h,e.getExpressionPath=C,e.filterPCASTTree=O,e.getPCASTElementsByTagName=A,e.getPCParent=m,e.getAllChildElementNames=L,e.parseModuleSource=k,e.parseStyleSource=H,e.createString=re,e.eatWhitespace=xe,e.throwUnexpectedToken=Pe,e.addUnexpectedToken=Me,e.testCurrTokenExists=Ue,e.testCurrTokenType=De,e.bundleVanilla=sn,e.transpileBlockExpression=cn,e.transpileStyleElement=An,e.transpileCSSSheet=Vn,e.loadModuleAST=we,e.getAllComponents=Ye,e.getAllGlobalStyles=Ge,e.getComponentSourceUris=Ve,e.defaultResolveModulePath=Fe,e.getChildComponentInfo=ke,e.getDependencyGraphComponentsExpressions=He,e.getDependencyChildComponentInfo=je,e.getModuleComponent=$e,e.getUsedDependencies=Qe,e.getImportDependencies=Xe,e.getComponentDependency=We,e.loadModuleDependencyGraph=Je,e.parseMetaContent=ze,e.getComponentMetadataItems=Ze,e.getComponentMetadataItem=er,e.getComponentPreview=nr,e.loadComponentTypes=qn,e.parseDeclaration=Zn,e.stringifyDeclarationAST=st,e.editPaperclipSource=Mt,e.PC_REMOVE_CHILD_NODE="PC_REMOVE_CHILD_NODE",e.PC_REMOVE_NODE="PC_REMOVE_NODE",e.createPCRemoveChildNodeMutation=It,e.createPCRemoveNodeMutation=Pt,e.generatePrettyErrorMessage=x,e.diagnosticsContainsError=I,e.EACH_KEY="$$each",e.ANY_REFERENCE=or,e.inferNodeProps=ir,e.getReferenceKeyPath=fr,e.getNestedInference=Sr,e.getTypeLabels=Ar,e.getPrettyTypeLabelEnd=mr,e.isValidReturnType=Ur,e.lintDependencyGraph=Kr,e.runPCFile=qt,Object.defineProperty(e,"__esModule",{value:!0})});
