!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(e.paperclip={})}(this,function(e){"use strict";function n(e,n){function r(){this.constructor=e}for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t]);e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}function r(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function t(e,n){return n={exports:{}},e(n,n.exports),n.exports}const a=Object.assign||function(e){for(var n,r=1;r<arguments.length;r++){n=arguments[r];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e};!function(e){e[e.STRING=0]="STRING",e[e.BLOCK=1]="BLOCK",e[e.STRING_BLOCK=2]="STRING_BLOCK",e[e.ELEMENT=3]="ELEMENT",e[e.SELF_CLOSING_ELEMENT=4]="SELF_CLOSING_ELEMENT",e[e.TEXT_NODE=5]="TEXT_NODE",e[e.COMMENT=6]="COMMENT",e[e.ATTRIBUTE=7]="ATTRIBUTE",e[e.START_TAG=8]="START_TAG",e[e.BLOCK_STRING=9]="BLOCK_STRING",e[e.FRAGMENT=10]="FRAGMENT",e[e.END_TAG=11]="END_TAG"}(e.PCExpressionType||(e.PCExpressionType={})),function(e){e.TYPE="TYPE",e.BIND="BIND",e.IF="IF",e.STRING="STRING",e.OBJECT="OBJECT",e.ARRAY="ARRAY",e.KEY_VALUE_PAIR="KEY_VALUE_PAIR",e.NUMBER="NUMBER",e.PROPERTY="PROPERTY",e.RESERVED_KEYWORD="RESERVED_KEYWORD",e.ELSEIF="ELSEIF",e.NOT="NOT",e.OPERATION="OPERATION",e.GROUP="GROUP",e.VAR_REFERENCE="VAR_REFERENCE",e.PROP_REFERENCE="PROP_REFERENCE",e.ELSE="ELSE",e.REPEAT="REPEAT"}(e.BKExpressionType||(e.BKExpressionType={})),function(e){e[e.SHEET=0]="SHEET",e[e.DECLARATION_PROPERTY=1]="DECLARATION_PROPERTY",e[e.STYLE_RULE=2]="STYLE_RULE",e[e.AT_RULE=3]="AT_RULE",e[e.IMPORT=4]="IMPORT",e[e.CHARSET=5]="CHARSET"}(e.CSSExpressionType||(e.CSSExpressionType={})),function(e){e.COLOR="COLOR",e.CALL="CALL",e.MEASUREMENT="MEASUREMENT",e.SPACED_LIST="SPACED_LIST",e.COMMA_LIST="COMMA_LIST",e.KEYWORD="KEYWORD",e.LIST="LIST"}(e.DcExpressionType||(e.DcExpressionType={}));var i=function(n){return n.type==e.PCExpressionType.SELF_CLOSING_ELEMENT?[]:n.childNodes},o=function(n){return n.type==e.PCExpressionType.SELF_CLOSING_ELEMENT?n.name:n.startTag.name},u=function(e){return e.value.value},s=function(e){return N(e).attributes},c=function(e){return N(e).modifiers},E=function(n){return n.type===e.PCExpressionType.ELEMENT||n.type===e.PCExpressionType.ELEMENT||n.type===e.PCExpressionType.START_TAG||n.type===e.PCExpressionType.END_TAG||n.type===e.PCExpressionType.SELF_CLOSING_ELEMENT},p=function(n,r){return A(n,function(n){return n.type===e.PCExpressionType.SELF_CLOSING_ELEMENT?r(n):n.type===e.PCExpressionType.ELEMENT&&r(n.startTag)})},l=function(n){return n.type===e.PCExpressionType.SELF_CLOSING_ELEMENT||n.type==e.PCExpressionType.START_TAG?n:n.startTag},T=function(e,n){if(f(e,n)){var r=l(e).attributes.find(function(e){return e.name===n});return r&&r.value&&r.value.value}},f=function(n,r){return(n.type===e.PCExpressionType.ELEMENT||n.type===e.PCExpressionType.SELF_CLOSING_ELEMENT||n.type===e.PCExpressionType.START_TAG)&&Boolean(l(n).attributes.find(function(e){return e.name===r}))},_=function(n){return A(n,function(n){return n.type===e.PCExpressionType.ELEMENT&&"style"===n.startTag.name})},y=function(n){return A(n,function(n){return n.type===e.PCExpressionType.SELF_CLOSING_ELEMENT&&"link"===n.name&&"stylesheet"===T(n,"rel")})},v=function(e){return _(e).concat(y(e))},d=function(e){return O(e,"meta")},R=function(e){var n=d(e).find(function(e){return Boolean(T(e,"name"))});return n&&T(n,"content")},S=function(e,n,r){if(void 0===r&&(r=[]),!1===n(e,r))return!1;if(e.childNodes)for(var t=e,a=0,i=t.childNodes.length;a<i;a++){var o=t.childNodes[a];if(!1===S(o,n,r.concat(["childNodes",a])))return!1}},N=function(n){return n.type===e.PCExpressionType.ELEMENT?n.startTag:n},C=function(e,n){return N(e).modifiers.find(function(e){return e.value.type===n})},h=function(e,n){var r;return S(n,function(n,t){if(n===e)return r=t,!1}),r},A=function(e,n){var r=[];return S(e,function(e){n(e)&&r.push(e)}),r},O=function(e,n){return p(e,function(e){return e.name===n})},L=function(n,r){return A(n,function(n){return n.childNodes&&n.childNodes.find(function(n){return n===r||r.type===e.PCExpressionType.START_TAG&&n.type===e.PCExpressionType.ELEMENT&&n.startTag===r})})[0]},m=function(e){var n=[];return S(e,function(e){E(e)&&-1===n.indexOf(N(e).name)&&n.push(N(e).name)}),n};!function(e){e.WARNING="WARNING",e.ERROR="ERROR"}(e.DiagnosticType||(e.DiagnosticType={}));var g,x=function(e,n){for(var r=e.location,t=(e.filePath,e.message+"\n\n"),a=n.split("\n").slice(r.start.line-1,r.end.line).map(function(e){return e+"\n"}),i=0,o=a.length;i<o;i++)t+=r.start.line+i+"| "+a[i];return t},I=function(e,n,r){return{type:e,pos:n,value:r}},P={},M=function(e){if(P[e])return P[e];var n=1,r=0,t={};return(e+" ").split("").forEach(function(e,a){t[a]=[r,n],"\n"===e&&(r=0,n++),r++}),P[e]=t},U=function(e,n){var r="number"==typeof e?e:e.pos,t=M(n)[r];return{column:t[0],line:t[1],pos:r}},B=function(e,n,r){return{start:e.line?e:U(e,r),end:n&&n.line?n:U(n||r.length,r)}},D=function(e,n){return B(e,e.pos+e.value.length,n)},b=function(){function e(e){this._target=e,this.pos=0,this.length=e.length}return e.prototype.curr=function(){return this._target[this.pos]},e.prototype.shift=function(){var e=this._target[this.pos];return this.next(),e},e.prototype.hasNext=function(){return this.pos<this.length-1},e.prototype.next=function(){return this._target[Math.min(this.pos=this.pos+1,this.length)]},e.prototype.prev=function(){return this._target[Math.max(this.pos=this.pos-1,0)]},e.prototype.ended=function(){return this.pos>=this.length},e}(),K=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return n(r,e),r.prototype.scan=function(e){for(var n="";this.pos<this.length;){var r=this._target[this.pos];if(!r.match(e))break;n+=r,this.pos++}return n},r.prototype.match=function(e){var n=this._target.substr(this.pos),r=n.match(e);if(r){var t=r[0];return this.pos+=n.indexOf(t)+t.length,t}return null},r.prototype.peek=function(e){return this._target.substr(this.pos,e)},r.prototype.take=function(e){var n=this._target.substr(this.pos,e);return this.pos+=e,n},r}(b),w=function(e){function r(n,r){var t=e.call(this,r)||this;return t.source=n,t}return n(r,e),r.prototype.peek=function(e){return void 0===e&&(e=1),this._target[this.pos+e]},r.prototype.peekUntil=function(e){for(var n=this.pos;n<this.length-1;)if(e(this._target[++n]))return this._target[n]},r.prototype.curr=function(){return e.prototype.curr.call(this)},r.prototype.next=function(){return e.prototype.next.call(this)},r}(b);!function(e){e[e.LESS_THAN=0]="LESS_THAN",e[e.LESS_THAN_OR_EQUAL=1]="LESS_THAN_OR_EQUAL",e[e.CLOSE_TAG=2]="CLOSE_TAG",e[e.COMMA=3]="COMMA",e[e.GREATER_THAN=4]="GREATER_THAN",e[e.GREATER_THAN_OR_EQUAL=5]="GREATER_THAN_OR_EQUAL",e[e.COMMENT=6]="COMMENT",e[e.BACKSLASH=7]="BACKSLASH",e[e.PERIOD=8]="PERIOD",e[e.BANG=9]="BANG",e[e.AND=10]="AND",e[e.OR=11]="OR",e[e.PLUS=12]="PLUS",e[e.COLON=13]="COLON",e[e.SEMICOLON=14]="SEMICOLON",e[e.QUESTION_MARK=15]="QUESTION_MARK",e[e.MINUS=16]="MINUS",e[e.NUMBER=17]="NUMBER",e[e.AT=18]="AT",e[e.STAR=19]="STAR",e[e.PERCENT=20]="PERCENT",e[e.PAREN_OPEN=21]="PAREN_OPEN",e[e.PAREN_CLOSE=22]="PAREN_CLOSE",e[e.DOUBLE_EQUALS=23]="DOUBLE_EQUALS",e[e.TRIPPLE_EQUELS=24]="TRIPPLE_EQUELS",e[e.NOT_EQUALS=25]="NOT_EQUALS",e[e.NOT_DOUBLE_EQUALS=26]="NOT_DOUBLE_EQUALS",e[e.BRACKET_OPEN=27]="BRACKET_OPEN",e[e.BRACKET_CLOSE=28]="BRACKET_CLOSE",e[e.CURLY_BRACKET_OPEN=29]="CURLY_BRACKET_OPEN",e[e.CURLY_BRACKET_CLOSE=30]="CURLY_BRACKET_CLOSE",e[e.EQUALS=31]="EQUALS",e[e.SINGLE_QUOTE=32]="SINGLE_QUOTE",e[e.HASH=33]="HASH",e[e.DOUBLE_QUOTE=34]="DOUBLE_QUOTE",e[e.TEXT=35]="TEXT",e[e.RESERVED_KEYWORD=36]="RESERVED_KEYWORD",e[e.WHITESPACE=37]="WHITESPACE"}(g||(g={}));var Y=function(e){for(var n=new K(e),r=[];!n.ended();){var t=n.curr(),a=void 0;if("<"===t)if("</"===n.peek(2))a=I(g.CLOSE_TAG,n.pos,n.take(2));else if("\x3c!--"===n.peek(4)){for(var i=n.take(4);!n.ended();){var o=n.curr();if("-"===o&&"--\x3e"===n.peek(3)){i+=n.take(3);break}n.next(),i+=o}a=I(g.COMMENT,n.pos,i)}else a="<="===n.peek(2)?I(g.LESS_THAN_OR_EQUAL,n.pos,n.take(2)):I(g.LESS_THAN,n.pos,n.shift());else if("&"===t&&"&&"===n.peek(2))a=I(g.AND,n.pos,n.take(2));else if("|"===t&&"||"===n.peek(2))a=I(g.OR,n.pos,n.take(2));else if(">"===t)a=">="===n.peek(2)?I(g.GREATER_THAN_OR_EQUAL,n.pos,n.take(2)):I(g.GREATER_THAN,n.pos,n.shift());else if("="===t)a="==="===n.peek(3)?I(g.TRIPPLE_EQUELS,n.pos,n.take(3)):"=="===n.peek(2)?I(g.DOUBLE_EQUALS,n.pos,n.take(2)):I(g.EQUALS,n.pos,n.shift());else if(":"===t)a=I(g.COLON,n.pos,n.shift());else if("?"===t)a=I(g.QUESTION_MARK,n.pos,n.shift());else if(";"===t)a=I(g.SEMICOLON,n.pos,n.shift());else if("@"===t)a=I(g.AT,n.pos,n.shift());else if(","===t)a=I(g.COMMA,n.pos,n.shift());else if("'"===t)a=I(g.SINGLE_QUOTE,n.pos,n.shift());else if("#"===t)a=I(g.HASH,n.pos,n.shift());else if("!"===t)a="!=="===n.peek(3)?I(g.NOT_DOUBLE_EQUALS,n.pos,n.take(3)):"!="===n.peek(2)?I(g.NOT_EQUALS,n.pos,n.take(2)):I(g.BANG,n.pos,n.shift());else if("/"===t){if("/*"===n.peek(2)){n.match(/.*?\*\//);continue}a=I(g.BACKSLASH,n.pos,n.shift())}else if("."===t)a=/\.\d/.test(n.peek(2))?V(n):I(g.PERIOD,n.pos,n.shift());else if('"'===t)a=I(g.DOUBLE_QUOTE,n.pos,n.shift());else if("+"===t)a=I(g.PLUS,n.pos,n.shift());else if("-"===t)a=/\-\d/.test(n.peek(2))?V(n):I(g.MINUS,n.pos,n.shift());else if("*"===t)a=I(g.STAR,n.pos,n.shift());else if("%"===t)a=I(g.PERCENT,n.pos,n.shift());else if("["===t)a=I(g.BRACKET_OPEN,n.pos,n.shift());else if("]"===t)a=I(g.BRACKET_CLOSE,n.pos,n.shift());else if("("===t)a=I(g.PAREN_OPEN,n.pos,n.shift());else if(")"===t)a=I(g.PAREN_CLOSE,n.pos,n.shift());else if("{"===t)a=I(g.CURLY_BRACKET_OPEN,n.pos,n.shift());else if("}"===t)a=I(g.CURLY_BRACKET_CLOSE,n.pos,n.shift());else if(/\d/.test(t))a=V(n);else if(/[\s\r\n\t]/.test(t))a=I(g.WHITESPACE,n.pos,n.scan(/[\s\r\n\t]/));else{var u=n.pos,s=n.scan(/[^-<>,='":@;\.\/\?\\(){}\[\]\s\r\n\t]/)||n.shift();a=I("undefined"===s||"null"===s||"true"===s||"false"===s?g.RESERVED_KEYWORD:g.TEXT,u,s)}r.push(a)}return new w(e,r)},V=function(e){return I(g.NUMBER,e.pos,e.match(/^\-?(\d+(\.\d+)?|\.\d+)/))},G="undefined"!=typeof window&&window.cache?window.cache.parseModuleSource||(window.cache.parseModuleSource={}):{},k=function(e,n){if(G[e])return G[e];var r={source:e,filePath:n,scanner:Y(e),diagnostics:[]},t=F(r);return G[e]={root:a({},t,{input:e}),diagnostics:r.diagnostics}},H=function(e,n){if(G[e])return G[e];var r={source:e,scanner:Y(e),filePath:n,diagnostics:[]},t=ye(r);return G[e]={root:t,diagnostics:r.diagnostics}},F=function(n){for(var r=n.scanner,t=[];!r.ended();){var a=$(n);if(!a)return null;t.push(a)}return 1===t.length?t[0]:{type:e.PCExpressionType.FRAGMENT,location:B(0,r.source.length,r.source),childNodes:t}},$=function(e){if(!Me(e))return null;var n=e.scanner;switch(n.curr().type){case g.WHITESPACE:return me(e);case g.LESS_THAN:return Ne(e);case g.CLOSE_TAG:return Se(e);case g.COMMENT:return fe(e);default:return _e(n)?j(e,W):me(e)}},j=function(n,r){var t=n.scanner,a=t.curr();t.next(),t.next(),ge(n);var i=r(n);return i?(ge(n),Ue(n,[g.BRACKET_CLOSE],null,B(a,t.curr(),n.source))?(t.next(),Ue(n,[g.BRACKET_CLOSE],"Missing closing ] character.",D(a,n.source))?(t.next(),{type:e.PCExpressionType.BLOCK,location:B(a,t.curr(),t.source),value:i}):null):null):null},Q=function(n){var r=n.scanner;switch(r.curr().value){case"bind":return ue(n);case"repeat":return Ee(n);case"if":return ce(n,e.BKExpressionType.IF);case"elseif":return ce(n,e.BKExpressionType.ELSEIF);case"else":return ce(n,e.BKExpressionType.ELSE);case"property":return se(n,e.BKExpressionType.PROPERTY);default:return Pe(n,"Unexpected block type "+r.curr().value+"."),null}},W=function(e){var n=e.scanner;switch(n.curr().value){case"bind":return ue(e);case"elseif":case"else":case"if":return Pe(e,"Condition blocks can only be added to elements, for example: <div [[if condition]]></div>."),null;case"repeat":return Pe(e,"Repeat blocks can only be added to elements, for example: <div [[repeat items in item, i]]></div>."),null;default:return Pe(e,"Unexpected block type "+n.curr().value+"."),null}},X=function(e){var n=e.scanner;switch(n.curr().value){case"bind":return ue(e);case"elseif":case"else":case"if":return Pe(e,"Condition blocks cannot be assigned to attributes."),null;case"repeat":return Pe(e,"Repeat blocks cannot be assigned to attributes."),null;default:return Pe(e,"Unexpected block type "+n.curr().value+"."),null}},J=function(e){return z(e)},q=function(e){return"*"===e||"/"===e},z=function(n){if(!Me(n))return null;var r=n.scanner,t=Z(n);ge(n);var i=r.curr(),o=i?i.type:-1;if(!(o===g.AND||o===g.OR||o==g.PLUS||o===g.MINUS||o===g.STAR||o===g.BACKSLASH||o===g.DOUBLE_EQUALS||o===g.TRIPPLE_EQUELS||o===g.GREATER_THAN||o===g.LESS_THAN||o===g.LESS_THAN_OR_EQUAL||o===g.GREATER_THAN_OR_EQUAL||o===g.NOT_EQUALS||o===g.NOT_DOUBLE_EQUALS))return t;r.next(),ge(n);var u=z(n);if(!u)return null;var s={type:e.BKExpressionType.OPERATION,left:t,right:u,operator:i.value,location:B(t.location.start,u.location.end,r.source)};if(u.type===e.BKExpressionType.OPERATION&&q(i.value)){var c=u;s=a({},c,{left:a({},s,{right:c.left})})}return s},Z=function(e){var n=e.scanner;switch(ge(e),n.curr().type){case g.BANG:return Te(e);case g.SINGLE_QUOTE:case g.DOUBLE_QUOTE:return ee(e);case g.NUMBER:return ne(e);case g.CURLY_BRACKET_OPEN:return re(e);case g.BRACKET_OPEN:return te(e);case g.PAREN_OPEN:return ie(e);case g.TEXT:return pe(e);case g.RESERVED_KEYWORD:return oe(e);default:return Pe(e),null}},ee=function(n){var r=n.scanner,t=r.curr();r.next();for(var a="";!r.ended();){var i=r.curr();if(i.value===t.value)break;"\\"!==i.value?(a+=i.value,r.next()):(a+=r.next().value,r.next())}return Oe(n,t)?(r.next(),{type:e.BKExpressionType.STRING,location:B(t,r.curr(),r.source),value:a}):null},ne=function(n){var r=n.scanner,t=r.curr();return r.next(),{type:e.BKExpressionType.NUMBER,value:t.value,location:B(t,r.curr(),r.source)}},re=function(n){var r=n.scanner,t=r.curr();r.next();for(var a=[];!r.ended()&&(ge(n),r.curr().type!==g.CURLY_BRACKET_CLOSE);){var i=ae(n);if(!i)return null;a.push(i),ge(n);var o=r.curr();if(o.type!==g.CURLY_BRACKET_CLOSE){if(o.type!==g.COMMA&&o)return Pe(n),null;r.next()}}return r.next(),{type:e.BKExpressionType.OBJECT,location:B(t,r.curr(),r.source),properties:a}},te=function(n){var r=n.scanner,t=r.curr();r.next(),ge(n);var a=[];if(r.curr().type!==g.BRACKET_CLOSE)for(;;){if(a.push(Z(n)),ge(n),r.curr().type===g.BRACKET_CLOSE)break;if(!Ue(n,[g.COMMA],"Missing , delimiter in array.",B(t,r.curr(),n.source)))return null;r.next()}return r.next(),{type:e.BKExpressionType.ARRAY,location:B(t,r.curr(),r.source),values:a}},ae=function(n){var r,t=n.scanner;switch(t.curr().type){case g.SINGLE_QUOTE:case g.DOUBLE_QUOTE:r=ee(n);break;default:r=le(n)}if(ge(n),!Ue(n,[g.COLON],"Missing : for object."))return null;t.next(),ge(n);var a=J(n);return{type:e.BKExpressionType.KEY_VALUE_PAIR,location:B(r.location.start,a.location.end,t.source),key:r.name,value:a}},ie=function(n){var r=n.scanner,t=r.curr();r.next();var a=J(n);return r.next(),{type:e.BKExpressionType.GROUP,value:a,location:B(t,r.curr(),r.source)}},oe=function(n){var r=n.scanner,t=r.curr();return r.next(),{type:e.BKExpressionType.RESERVED_KEYWORD,value:t.value,location:B(t,r.curr(),r.source)}},ue=function(n){var r=n.scanner,t=r.curr();r.next(),r.next(),n.startToken=t;var a=J(n);return n.startToken=void 0,a?{type:e.BKExpressionType.BIND,value:a,location:B(t,r.curr(),r.source)}:null},se=function(e,n){var r=e.scanner,t=r.curr();return r.next(),r.next(),{type:n,name:le(e).name,location:B(t,r.curr(),r.source)}},ce=function(e,n){var r=e.scanner,t=r.curr();return r.next(),ge(e),{type:n,condition:r.curr().type!==g.BRACKET_CLOSE?J(e):null,location:B(t,r.curr(),r.source)}},Ee=function(n){var r=n.scanner,t=r.curr();if(r.next(),ge(n),!Ue(n,[g.TEXT],"Repeat block missing collection parameter.",D(t,n.source)))return null;var a=J(n);if(ge(n),!Ue(n,[g.TEXT],null,B(t,r.curr(),n.source)))return null;if("as"!==r.curr().value)return Pe(n,'Repeat block missing "as" keyword.',B(t,r.curr(),n.source)),null;if(r.next(),ge(n),!Ue(n,[g.TEXT],null,B(t,r.curr(),n.source)))return null;var i,o=le(n);if(ge(n),","===r.curr().value){if(r.next(),ge(n),!Ue(n,[g.TEXT],"Unexpected token. Repeat index parameter should only contain characters a-zA-Z.",B(t,r.curr(),n.source)))return null;i=le(n)}return{type:e.BKExpressionType.REPEAT,location:B(t,r.curr(),r.source),each:a,asKey:i,asValue:o}},pe=function(n){for(var r=n.scanner,t=le(n),a=[t];!r.ended()&&r.curr().type===g.PERIOD;){if(r.next(),!Ue(n,[g.TEXT]))return null;a.push(le(n))}return 1===a.length?a[0]:{type:e.BKExpressionType.PROP_REFERENCE,path:a,location:B(t.location.start,r.curr(),r.source)}},le=function(n){var r=n.scanner;ge(n);var t=r.curr();r.next();var a=!1;return r.curr()&&r.curr().type===g.QUESTION_MARK&&(a=!0,r.next()),{type:e.BKExpressionType.VAR_REFERENCE,name:t.value,optional:a,location:B(t,r.curr(),r.source)}},Te=function(n){var r=n.scanner,t=r.curr();return r.next(),{type:e.BKExpressionType.NOT,value:Z(n),location:B(t,r.curr(),r.source)}},fe=function(n){var r=n.scanner,t=r.curr();return r.next(),{type:e.PCExpressionType.COMMENT,value:t.value.substr(4,t.value.length-7),location:B(t,r.curr(),r.source)}},_e=function(e){return e.curr().type===g.BRACKET_OPEN&&e.peek(1).type===g.BRACKET_OPEN},ye=function(n){for(var r=n.scanner,t=r.curr(),a=[];;){if(ge(n),r.ended()||r.curr().type===g.CLOSE_TAG)break;var i=ve(n);if(!i)return null;a.push(i)}return{type:e.CSSExpressionType.SHEET,children:a,location:B(t,r.curr(),r.source)}},ve=function(e){switch(e.scanner.curr().type){case g.AT:return de(e);default:return Re(e)}},de=function(n){var r=n.scanner,t=r.curr();r.next();for(var a="";r.curr().type!==g.WHITESPACE&&r.curr().type!==g.CURLY_BRACKET_OPEN;)a+=r.curr().value,r.next();r.next();var i=[],o=[];for(ge(n);!r.ended()&&(ge(n),r.curr().type!==g.CURLY_BRACKET_OPEN&&r.curr().type!==g.SEMICOLON);)r.curr().type===g.SINGLE_QUOTE||r.curr().type===g.DOUBLE_QUOTE?i.push(ee(n).value):(i.push(r.curr().value),r.next());var u=r.curr();if(r.next(),u.type===g.CURLY_BRACKET_OPEN){for(;!r.ended()&&(ge(n),r.curr().type!==g.CURLY_BRACKET_CLOSE);){var s=ve(n);if(!s)return null;o.push(s)}if(!Ue(n,[g.CURLY_BRACKET_CLOSE],"Missing closing } character.",D(t,n.source)))return null;r.next()}return{type:e.CSSExpressionType.AT_RULE,name:a,params:i,children:o,location:B(t,r.curr(),r.source)}},Re=function(n){for(var r=n.scanner,t=r.curr(),a="";!r.ended();){var i=r.curr();if(i.type==g.CURLY_BRACKET_OPEN||i.type===g.SEMICOLON||i.type===g.CURLY_BRACKET_CLOSE||i.type===g.CLOSE_TAG)break;i.type===g.SINGLE_QUOTE||i.type===g.DOUBLE_QUOTE?a+=i.value+ee(n).value+i.value:(a+=i.value,r.next())}if(!Ue(n,[g.SEMICOLON,g.CURLY_BRACKET_OPEN,g.CURLY_BRACKET_CLOSE]))return null;if(r.curr().type===g.SEMICOLON||r.curr().type===g.CURLY_BRACKET_CLOSE){var o=a.match(/(.+?):(.+)/),u=(o[0],o[1]),s=o[2];return r.curr().type===g.SEMICOLON&&r.next(),{type:e.CSSExpressionType.DECLARATION_PROPERTY,location:B(t,r.curr(),r.source),name:u,value:s}}r.next();var c=[];for(ge(n);!r.ended()&&r.curr().type!==g.CURLY_BRACKET_CLOSE;){var E=Re(n);if(!E)return null;c.push(E),ge(n)}return Ue(n,[g.CURLY_BRACKET_CLOSE],"Missing closing } character.",D(t,n.source))?(r.next(),a=a.trim(),{type:e.CSSExpressionType.STYLE_RULE,children:c,selectorText:a,location:B(t,r.curr(),r.source)}):null},Se=function(n){var r=n.scanner,t=r.curr();r.next();var a=xe(n);return a?Ue(n,[g.GREATER_THAN],"Missing > character.",B(t,r.curr(),n.source))?(r.next(),{type:e.PCExpressionType.END_TAG,name:a,location:B(t,r.curr(),r.source)}):null:(Pe(n,"Missing close tag name.",D(t,n.source)),null)},Ne=function(n){var r=n.scanner,t=r.curr();r.next();var a=xe(n);if(!a)return Pe(n,"Missing open tag name.",D(t,n.source)),null;if(!r.ended()&&!Ue(n,[g.WHITESPACE,g.GREATER_THAN],'Tag name contains a character where " " or > is expected.',D(t,n.source)))return null;for(var i=[],o=[];!r.ended();){ge(n);var u=r.curr();if(u.type===g.BACKSLASH||u.type==g.GREATER_THAN)break;if(_e(r)){var s=j(n,Q);if(!s)return null;o.push(s)}else{if(u.type!==g.TEXT)return Pe(n),null;var c=he(n);if(!c)return null;i.push(c)}}if(!Me(n))return null;if(r.curr().type===g.BACKSLASH)return r.next(),r.next(),{type:e.PCExpressionType.SELF_CLOSING_ELEMENT,name:a,attributes:i,modifiers:o,location:B(t,r.curr(),r.source)};r.next();var E=r.curr(),p=Ce(a,n);if(!p)return null;var l=p[0],T=p[1];return T?{type:e.PCExpressionType.ELEMENT,startTag:{name:a,type:e.PCExpressionType.START_TAG,location:B(t,E,r.source),modifiers:o,attributes:i},childNodes:l,location:B(t,r.curr(),r.source),endTag:T}:(Pe(n,"Close tag is missing.",B(t,E,n.source)),null)},Ce=function(n,r){var t=r.scanner,a=[];if("style"===n){var i=ye(r);if(!i)return null;if(ge(r),!Ue(r,[g.CLOSE_TAG]))return null;var o=Se(r);return o?[[i],o]:null}if("style"===n||"script"===n){for(var u="",s=t.curr();!t.ended()&&t.curr().type!==g.CLOSE_TAG;)u+=t.curr().value,t.next();return[[{type:e.PCExpressionType.TEXT_NODE,value:u,location:B(s,t.curr(),t.source)}],$(r)]}for(var c;!t.ended();){var E=$(r);if(!E)return null;if(E.type===e.PCExpressionType.END_TAG){c=E;break}a.push(E)}return[a,c]},he=function(n){var r,t=n.scanner,a=t.curr(),i=xe(n);return t.curr().type!==g.EQUALS||(t.next(),r=Ae(n))?{type:e.PCExpressionType.ATTRIBUTE,name:i,value:r,location:B(a,t.curr(),t.source)}:null},Ae=function(e){if(!Me(e))return null;var n=e.scanner;switch(n.curr().type){case g.SINGLE_QUOTE:case g.DOUBLE_QUOTE:return Le(e);default:return _e(n)?j(e,X):(Pe(e),null)}},Oe=function(e,n){return Ue(e,[n.type],"Missing closing "+n.value+" character.",D(n,e.source))},Le=function(n){var r=n.scanner,t=r.curr(),a=[],i=!1;for(r.next();!r.ended();){var o=r.curr();if(o.type===t.type)break;if(_e(r)){i=!0;var u=j(n,X);if(!u)return null;a.push(u)}else r.next(),a.push({type:e.PCExpressionType.STRING,value:o.value,location:B(o.pos,r.curr(),r.source)})}if(!Oe(n,t))return null;r.next();var s=B(t,r.curr(),r.source);return i?{type:e.PCExpressionType.STRING_BLOCK,location:s,values:a}:{type:e.PCExpressionType.STRING,location:s,value:a.map(function(e){return e.value}).join("")}},me=function(n){var r=n.scanner,t=r.curr();r.next();for(var a=t.value;!r.ended();){var i=r.curr();if(i.type===g.COMMENT||i.type===g.LESS_THAN||i.type==g.CLOSE_TAG||_e(r))break;r.next(),a+=i.value}return{type:e.PCExpressionType.TEXT_NODE,value:a,location:B(t,r.curr(),r.source)}},ge=function(e){for(var n=e.scanner;!n.ended()&&n.curr().type===g.WHITESPACE;)n.next()},xe=function(e){for(var n=e.scanner,r="";!n.ended()&&/[a-zA-Z-][a-zA-Z0-9-]*/.test(n.curr().value);)r+=n.curr().value,n.next();return r||null},Ie=function(e,n){if(!n)throw new Error("Unexpected end of file (missing closing expression).");var r=U(n,e);throw new Error('Unexpected token "'+n.value+'" at '+r.line+":"+r.column)},Pe=function(n,r,t){var a=n.scanner.curr(),i=t||(n.startToken?B(n.startToken,n.scanner.curr(),n.source):{start:U(a||n.scanner.source.length-1,n.scanner.source),end:U(a?a.pos+a.value.length:n.scanner.source.length,n.scanner.source)});return n.diagnostics.push({type:e.DiagnosticType.ERROR,location:i,message:r||(a?"Unexpected token.":"Unexpected end of file."),filePath:n.filePath}),!0},Me=function(e,n,r){return!!e.scanner.curr()||(Pe(e,n,r),!1)},Ue=function(e,n,r,t){var a=e.scanner.curr();return!(!a||-1===n.indexOf(a.type))||(Pe(e,r,t),!1)};!function(e){e.TANDEM="TANDEM",e.WEB="WEB"}(e.PaperclipTargetType||(e.PaperclipTargetType={}));var Be=Symbol(),De=function(e,n){if(e[Be]&&e[Be][0]===e)return e[Be][1];var r=$e(e,n);return e[Be]=[e,r],r},be=function(e,n){var r=n.split("/");r.pop();var t=(e=e.replace("./","")).split("../"),a=t.pop();return r.splice(r.length-t.length,r.length),r.join("/")+"/"+a},Ke=function(e,n){var r={};return m(e).forEach(function(e){var t=He(e,n);t&&(r[e]=t)}),r},we=function(e){var n={};for(var r in e)for(var t=0,a=e[r].module.components;t<a.length;t++){var i=a[t];n[i.id]={filePath:r,expression:i.source}}return n},Ye=function(e,n){var r={};return e.module.components.forEach(function(e){Object.assign(r,Ke(e.template,n))}),r},Ve=function(e,n){return n.components.find(function(n){return n.id===e})},Ge=function(e,n){var r=[],t=(Ye(e,n),Ye(e,n));for(var a in t){var i=t[a];-1===r.indexOf(i)&&r.push(i)}return r},ke=function(e,n){var r=e.resolvedImportUris,t=[];for(var a in r)t.push(n[r[a]]);return t},He=function(e,n){for(var r in n)for(var t=n[r],a=0,i=t.module.components.length;a<i;a++)if(t.module.components[a].id===e)return t},Fe=function(e,n,r,t){var a=n.readFile,i=n.resolveFile,o=void 0===i?be:i;return void 0===r&&(r={}),void 0===t&&(t=[]),r[e]?Promise.resolve({diagnostics:t,graph:r}):Promise.resolve(a(e)).then(function(n){return k(n,e)}).then(function(n){return t.push.apply(t,n.diagnostics),n.root?De(n.root,e):null}).then(function(n){if(!n)return null;var i={};return r[e]={module:n,resolvedImportUris:i},n.imports.length?Promise.all(n.imports.map(function(n){return Promise.resolve(o(n.href,e)).then(function(e){return i[n.href]=e,Fe(e,{readFile:a,resolveFile:o},r,t)})})):Promise.resolve(r)}).then(function(){return{graph:r,diagnostics:t}})},$e=function(n,r){for(var t=n.type===e.PCExpressionType.FRAGMENT?n.childNodes:[n],a=[],u=[],E=[],p=[],l=0,T=t.length;l<T;l++){var f=t[l];if(f.type===e.PCExpressionType.SELF_CLOSING_ELEMENT||f.type===e.PCExpressionType.ELEMENT){var _=f,y=o(_),v=i(_),d=s(_),R=c(_);if("component"===y&&_.type===e.PCExpressionType.ELEMENT){u.push(Xe(_,R,d,v));continue}if("link"===y){a.push(Je(d));continue}if("style"===y){E.push(_);continue}}p.push(f)}return{source:n,uri:r,imports:a,components:u,globalStyles:E,unhandledExpressions:p}},je=function(e){for(var n={},r=0,t=e.split(/,\s+/g);r<t.length;r++){var a=t[r].split("="),i=a[0],o=a[1];n[i]=o}return n},Qe=function(e,n){return e.metadata.filter(function(e){return e.name===n})},We=function(e,n){return Qe(e,n).shift()},Xe=function(n,r,t,a){for(var c,E,p,l=[],f=[],_=0,y=t.length;_<y;_++){var v=t[_];"id"===v.name&&(c=u(v))}for(var _=0,y=a.length;_<y;_++){var d=a[_];if(d.type===e.PCExpressionType.SELF_CLOSING_ELEMENT||d.type===e.PCExpressionType.ELEMENT){var R=d,S=o(R);s(R),i(R);"style"===S?E=R:"template"===S?p=R:"preview"===S?d.type===e.PCExpressionType.ELEMENT&&d.childNodes.find(function(n){return n.type===e.PCExpressionType.ELEMENT||n.type===e.PCExpressionType.SELF_CLOSING_ELEMENT})&&Boolean(T(R,"name"))&&l.push(R):"meta"===S&&f.push({name:T(R,"name"),params:je(T(R,"content")||"")})}}return{source:n,id:c,style:E,metadata:f,template:p,previews:l}},Je=function(e){for(var n,r,t=0,a=e.length;t<a;t++){var i=e[t];"href"===i.name?n=u(i):"type"===i.name&&(r=u(i))}return{type:r,href:n}},qe=function(e){var n=Symbol();return function(r){for(var t=[],a=1;a<arguments.length;a++)t[a-1]=arguments[a];return r[n]?r[n]:r[n]=e.apply(void 0,[r].concat(t))}};!function(e){e[e.OBJECT=1]="OBJECT",e[e.ARRAY=2]="ARRAY",e[e.STRING=4]="STRING",e[e.NUMBER=8]="NUMBER",e[e.BOOLEAN=16]="BOOLEAN",e[e.PRIMITIVE=28]="PRIMITIVE",e[e.ANY=31]="ANY",e[e.OBJECT_OR_ARRAY=3]="OBJECT_OR_ARRAY"}(e.InferenceType||(e.InferenceType={}));var ze=function(){return{type:e.InferenceType.ANY,properties:{}}},Ze=ze(),en=qe(function(e,n,r){void 0===r&&(r={});var t=rn(e,nn(n,r));return{diagnostics:t.diagnostics,inference:t.inference}}),nn=function(n,r){return{filePath:n,options:r,inference:ze(),diagnostics:[],currentScopes:{},typeLimit:e.InferenceType.ANY}},rn=function(n,r){switch(n.type){case e.PCExpressionType.BLOCK:return ln(n,r);case e.PCExpressionType.FRAGMENT:return En(n,r);case e.PCExpressionType.SELF_CLOSING_ELEMENT:case e.PCExpressionType.ELEMENT:return un(n,r)}return r},tn=function(n,r){for(var t=n.attributes,a=(n.name,n.modifiers),i=0,o=a.length;i<o;i++){var u=a[i].value;u.type!==e.BKExpressionType.IF&&u.type!==e.BKExpressionType.ELSEIF&&u.type!==e.BKExpressionType.BIND||(r=Tn(u,dn(e.InferenceType.ANY,null,r)))}for(var i=0,o=t.length;i<o;i++)r=an(n,t[i],dn(e.InferenceType.ANY,null,r));return r},an=function(e,n,r){n.name;var t=n.value;return t&&(r=on(e,t,r)),r},on=function(n,r,t){switch(r.type){case e.PCExpressionType.STRING:return t;case e.PCExpressionType.STRING_BLOCK:for(var a=0,i=(o=r).values.length;a<i;a++)t=on(n,o.values[a],dn(e.InferenceType.STRING,null,t));return t;case e.PCExpressionType.BLOCK:var o=r;return Tn(o.value,t)}return t},un=function(n,r){var t,a=[];if(n.type===e.PCExpressionType.SELF_CLOSING_ELEMENT)a=[],t=n;else{var i=n;a=i.childNodes,t=i.startTag}if(r.options.ignoreTagNames&&-1!==r.options.ignoreTagNames.indexOf(t.name))return r;for(var o,u=t.modifiers,s=0,c=u.length;s<c;s++){var E=u[s].value;if(E.type===e.BKExpressionType.REPEAT&&sn(E.each)){o=E;break}}return o&&(r=Tn(o,r),r=An(o.asValue.name,cn(o.each).concat(["$$each"]),r)),r=tn(t,r),r=pn(a,r),o&&(r=Ln(o.asValue.name,r)),r},sn=function(n){return n.type===e.BKExpressionType.VAR_REFERENCE||n.type===e.BKExpressionType.PROP_REFERENCE},cn=function(n){return n.type===e.BKExpressionType.VAR_REFERENCE?[n.name]:n.path.map(function(e){return e.name})},En=function(e,n){return pn(e.childNodes,n)},pn=function(e,n){for(var r=0,t=e.length;r<t;r++)n=rn(e[r],n);return n},ln=function(n,r){return Tn(n.value,dn(e.InferenceType.ANY,null,r))},Tn=function(n,r){switch(n.type){case e.BKExpressionType.NUMBER:return gn(e.InferenceType.NUMBER,r)?dn(e.InferenceType.NUMBER,null,r):xn(n,e.InferenceType.NUMBER,r);case e.BKExpressionType.STRING:return gn(e.InferenceType.STRING,r)?dn(e.InferenceType.STRING,null,r):xn(n,e.InferenceType.STRING,r);case e.BKExpressionType.OPERATION:var t=n,a=t.left,i=t.operator,o=t.right,u=/^[\*\/\-%]$/.test(i)?e.InferenceType.NUMBER:r.typeLimit;if(!gn(u,r))return xn(n,u,r);r.typeLimit;var s=u;return r=Tn(a,dn(u,"The left-hand side of an arithmetic operation must be "+Nn(u),r)),r=Tn(o,"==="!==i?dn(s,"The right-hand side of an arithmetic operation must be "+Nn(r.typeLimit),r):r);case e.BKExpressionType.GROUP:f=n.value;return Tn(f,r);case e.BKExpressionType.VAR_REFERENCE:case e.BKExpressionType.PROP_REFERENCE:var c=cn(n);return r=fn(n,c,r);case e.BKExpressionType.BIND:f=n.value;return Tn(f,r);case e.BKExpressionType.OBJECT:for(var E=n.properties,p=0,l=E.length;p<l;p++){var T=E[p],f=(T.key,T.value);r=Tn(f,dn(e.InferenceType.ANY,null,r))}return dn(e.InferenceType.OBJECT,null,r);case e.BKExpressionType.NOT:f=n.value;return dn(e.InferenceType.BOOLEAN,null,Tn(f,dn(e.InferenceType.ANY,null,r)));case e.BKExpressionType.ELSEIF:case e.BKExpressionType.IF:var _=n.condition;return Tn(_,dn(e.InferenceType.ANY,null,r));case e.BKExpressionType.REPEAT:var y=n.each;return Tn(y,r);default:return r}},fn=function(e,n,r){var t=vn(n,r)&r.typeLimit;return gn(t,r)?dn(t,r.typeLimitErrorMessage,hn(e,n,t,r)):In(e,r,r.typeLimitErrorMessage)},_n=function(e,n){var r=On(e,n);return yn(r,n.inference)},yn=function(e,n){for(var r=n,t=0,a=e.length;t<a;t++)if(!(r=r.properties[e[t]]))return null;return r},vn=function(n,r,t){void 0===t&&(t=e.InferenceType.ANY);var a=_n(n,r);return a?a.type:t},dn=function(e,n,r){return a({},r,{typeLimit:e,typeLimitErrorMessage:n})},Rn=function(n,r,t,i){return void 0===i&&(i=-1),i++,i===n.length?a({},t,r):a({},t,{type:t.type&e.InferenceType.OBJECT_OR_ARRAY,properties:a({},t.properties,(o={},o[n[i]]=Rn(n,r,t.properties[n[i]]||ze(),i),o))});var o},Sn=function(n){var r=[];return n&e.InferenceType.ARRAY&&r.push("array"),n&e.InferenceType.OBJECT&&r.push("object"),n&e.InferenceType.STRING&&r.push("string"),n&e.InferenceType.NUMBER&&r.push("number"),n&e.InferenceType.BOOLEAN&&r.push("boolean"),r},Nn=function(e){var n=Sn(e);return 1===n.length?"a "+n[0]:"an "+n.slice(0,n.length-1).join(", ")+", or "+n[n.length-1]},Cn=function(n,r,t){for(var a=t.inference,i=0,o=n.length;i<o-1;i++){if(!(a=a.properties[n[i]]))return t;a.type&e.InferenceType.OBJECT_OR_ARRAY||(t=In(r,dn(t.typeLimit,null,t),'Cannot call property "'+n.slice(i+1).join(".")+'" on primitive "'+n.slice(0,i+1).join(".")+'"'))}return t},hn=function(e,n,r,t){return t=Cn(n,e,t),mn(Rn(On(n,t),{type:r},t.inference),t)},An=function(e,n,r){return a({},r,{currentScopes:a({},r.currentScopes,(t={},t[e]=n,t))});var t},On=function(e,n){var r=n.currentScopes[e[0]];return r?On(r,n).concat(e.slice(1)):e},Ln=function(e,n){return a({},n,{currentScopes:a({},n.currentScopes,(r={},r[e]=null,r))});var r},mn=function(e,n){return a({},n,{inference:e})},gn=function(e,n){var r=n.typeLimit;return Boolean(e&r)},xn=function(e,n,r){return In(e,r,r.typeLimitErrorMessage||"Type mismatch "+n+" to "+r.typeLimit)},In=function(n,r,t){return Pn(n,e.DiagnosticType.ERROR,r,t)},Pn=function(n,r,t,i){return a({},t,{diagnostics:t.diagnostics.concat([{type:e.DiagnosticType.ERROR,location:n.location,message:i,filePath:t.filePath}])})},Mn=qe(function(e,n){void 0===n&&(n={});var r={};for(var t in e)for(var i=0,o=e[t].module.components;i<o.length;i++)r[(E=o[i]).id]={filePath:t,component:E};var u={graph:e,currentComponentId:null,options:n,currentFilePath:null,ignoreTagNames:{},callstack:[],components:r,diagnostics:[]};for(var s in r){var c=r[s],t=c.filePath,E=c.component;u=Bn(E,a({},u,{currentComponentId:s,currentFilePath:t}))}return{diagnostics:Un(u.diagnostics)}}),Un=function(e){for(var n=e.map(function(e){return JSON.stringify(e)}),r={},t=[],a=0,i=n.length;a<i;a++){var o=n[a];r[o]||(r[o]=1,t.push(e[a]))}return t},Bn=function(e,n){n=Dn(e.template,n);for(var r=0,t=e.previews.length;r<t;r++){var a=e.previews[r];n=Dn(a,n)}return n},Dn=function(n,r){switch(n.type){case e.PCExpressionType.FRAGMENT:return wn(n,r);case e.PCExpressionType.SELF_CLOSING_ELEMENT:case e.PCExpressionType.ELEMENT:return Yn(n,r);case e.PCExpressionType.BLOCK:return bn(n,r)}return r},bn=function(e,n){return Wn(e.value,n)},Kn=function(e,n){for(var r=0,t=e.length;r<t;r++)n=Dn(e[r],n);return n},wn=function(e,n){return Kn(e.childNodes,n)},Yn=function(n,r){var t,i;if(n.type===e.PCExpressionType.ELEMENT)t=(o=n).childNodes,i=o.startTag;else{var o=n;i=o,t=[]}if(r.callstack.filter(function(e){return e.source===i}).length>10)return Hn(n,"Maximum callstack exceeded",r);if(r.ignoreTagNames[i.name.toLowerCase()])return r;for(var u,s,c=0,E=i.modifiers.length;c<E;c++){var p=i.modifiers[c].value;p.type===e.BKExpressionType.IF||p.type===e.BKExpressionType.ELSEIF?u=p:p.type===e.BKExpressionType.REPEAT&&(s=p)}if(u&&!(r=Wn(u,r)).currentExprEvalResult.value)return r;if(s){var l=s.each,T=s.asValue,f=s.asKey,_=T.name,y=f&&f.name||void 0,v=(r=Wn(l,r)).currentFilePath,d=r.currentExprEvalResult.source;er(r.currentExprEvalResult.value,function(e,n){r=Gn(i,Zn(d,v,a({},r.caller&&r.caller.props||{},(o={},o[_]=e,o[y]=f?{value:n,source:f}:void 0,o)),r)),r=Kn(t,r),r=Xn(r);var o})}else r=Gn(i,r),r=Kn(t,r);return r},Vn={},Gn=function(n,r){for(var t={},a=(r.currentFilePath,{}),i=0,o=n.attributes.length;i<o;i++)a[(s=n.attributes[i]).name]=s;for(var u in a){var s=a[u];r=$n(s,r),t[u]=r.currentExprEvalResult}for(var c=n,i=0,o=n.modifiers.length;i<o;i++){var E=n.modifiers[i].value;E.type===e.BKExpressionType.BIND&&(c=(r=Wn(E,r)).currentExprEvalResult.source,Object.assign(t,r.currentExprEvalResult.value))}var p=r.components[n.name.toLowerCase()]||Vn,l=p.filePath,T=p.component;if(!T)return r;var f=r.currentComponentId;return r=Dn(T.source,Jn("preview",Zn(c,l,t,qn(n.name,r)))),zn("preview",Xn(qn(f,r)))},kn=function(n){if(Array.isArray(n))return e.InferenceType.ARRAY;if(null===n)return e.InferenceType.ANY;switch(typeof n){case"object":return e.InferenceType.OBJECT;case"number":return e.InferenceType.NUMBER;case"boolean":return e.InferenceType.BOOLEAN;case"string":return e.InferenceType.STRING;default:return e.InferenceType.ANY}},Hn=function(n,r,t){return Fn(n,e.DiagnosticType.ERROR,r,t)},Fn=function(n,r,t,i){return a({},i,{diagnostics:i.diagnostics.concat([{type:e.DiagnosticType.ERROR,location:n.location,message:t,filePath:i.currentFilePath}])})},$n=function(n,r){if(!n.value)return rr(!0,n,r);if(n.value.type===e.PCExpressionType.STRING_BLOCK)for(var t=n.value,a=0,i=t.values.length;a<i;a++){var o=t.values[a];o.type===e.PCExpressionType.BLOCK&&(r=Wn(o,r))}else r=n.value.type===e.PCExpressionType.STRING?rr(n.value.value,n.value,r):Wn(n.value.value,r);return r},jn=function(e,n,r){return void 0===r&&(r=0),null==n?n:r===e.length?n.value:jn(e,n.value&&n.value[e[r]],r+1)},Qn=function(e,n){var r=n.props[e[0]];if(null==r)return n.source;for(var t=r,a=1,i=e.length;a<i;a++){var o=t.value&&t.value[a];if(!o)break;t=o}return t.source},Wn=function(n,r){switch(n.type){case e.BKExpressionType.OPERATION:var t=n,i=t.left,o=t.operator,u=t.right,s=r.optionalVars;"||"===o&&(r=nr(!0,r));var c=(r=Wn(i,r)).currentExprEvalResult.value,E=(r=Wn(u,nr(s,r))).currentExprEvalResult.value;switch(o){case"+":return rr(c+E,n,r);case"-":return rr(c-E,n,r);case"*":return rr(c*E,n,r);case"/":return rr(c/E,n,r);case"%":return rr(c%E,n,r);case"==":return rr(c==E,n,r);case"===":return rr(c===E,n,r);case"!=":case"!==":return rr(c!==E,n,r);case"||":return rr(c||E,n,r);case"&&":return rr(c&&E,n,r);case">=":return rr(c>=E,n,r);case"<=":return rr(c<=E,n,r)}return r;case e.BKExpressionType.PROP_REFERENCE:case e.BKExpressionType.VAR_REFERENCE:var p=cn(n);if(r.caller){var l=(r.components[r.currentComponentId]||{}).component,T=l&&en(l.source),f=Qn(p,r.caller),_=jn(p.slice(1),r.caller.props[p[0]]);if(r=rr(_,f,r),void 0===_&&(p.length>1||!r.optionalVars))r=Hn(f,'Property "'+p.join(".")+'" is undefined',r);else if(T){var y=yn(p,T.inference)||Ze,v=kn(_);y.type&v||(r=Hn(f,'Type mismatch: attribute "'+p.join(".")+'" expecting '+Nn(y.type)+", "+Sn(v)+" provided.",r))}}else r=rr(null,n,r);return r;case e.BKExpressionType.OBJECT:for(var d=n,R={},S=0,N=d.properties.length;S<N;S++){var C=d.properties[S],h=C.key,_=C.value;r=Wn(_,r),R[h]=r.currentExprEvalResult}return r=rr(R,n,r);case e.BKExpressionType.ARRAY:for(var A=n,O=[],S=0,N=A.values.length;S<N;S++)r=Wn(A.values[S],r),O.push(r.currentExprEvalResult);return r=rr(O,n,r);case e.BKExpressionType.GROUP:return Wn(n.value,r);case e.BKExpressionType.NUMBER:var L=n;return rr(Number(L.value),n,r);case e.BKExpressionType.STRING:var m=n;return rr(String(m.value),n,r);case e.BKExpressionType.RESERVED_KEYWORD:return"undefined"===(_=n.value)?rr(void 0,n,r):"null"===_?rr(null,n,r):"true"===_||"false"==_?rr("true"===_,n,r):r;case e.BKExpressionType.NOT:return r=Wn(n.value,r),rr(!r.currentExprEvalResult.value,n,r);case e.BKExpressionType.BIND:return Wn(n.value,a({},r,{currentExprEvalResult:void 0,optionalVars:!1}));case e.BKExpressionType.IF:case e.BKExpressionType.ELSEIF:return Wn(n.condition,a({},r,{currentExprEvalResult:void 0,optionalVars:!0}));default:return r}},Xn=function(e){return a({},e,{callstack:e.callstack.slice(0,e.callstack.length-1),caller:e.callstack[e.callstack.length-2]})},Jn=function(e,n){return a({},n,{ignoreTagNames:a({},Jn,(r={},r[e]=(n.ignoreTagNames[e]||0)+1,r))});var r},qn=function(e,n){return a({},n,{currentComponentId:e})},zn=function(e,n){return a({},n,{ignoreTagNames:a({},Jn,(r={},r[e]=(n.ignoreTagNames[e]||1)-1,r))});var r},Zn=function(e,n,r,t){var i={filePath:n,source:e,props:r};return a({},t,{callstack:t.callstack.concat([i]),caller:i})},er=function(e,n){if(Array.isArray(e))e.forEach(n);else for(var r in e)n(e[r],r)},nr=function(e,n){return a({},n,{optionalVars:e})},rr=function(e,n,r){return a({},r,{currentExprEvalResult:{value:e,source:n}})},tr=function(e,n){return Fe(e,n.io).then(function(n){var r=n.graph;return{code:or(e,r),graph:r,diagnostics:Mn(r).diagnostics,entryDependency:r[e]}})},ar=function(n){switch(n.type){case e.BKExpressionType.NOT:return"!"+ar(n.value);case e.BKExpressionType.PROP_REFERENCE:return(t=n).path.map(ar).join(".");case e.BKExpressionType.STRING:var r=n;return JSON.stringify(r.value);case e.BKExpressionType.NUMBER:return n.value;case e.BKExpressionType.VAR_REFERENCE:var t=n;return t.name;case e.BKExpressionType.ARRAY:return"["+n.values.map(ar)+"]";case e.BKExpressionType.OBJECT:for(var a=n,i="{",o=0,u=a.properties.length;o<u;o++){var s=a.properties[o];i+=s.key+":"+ar(s.value)+", "}return i+="}";case e.BKExpressionType.GROUP:return"("+ar(n.value)+")";case e.BKExpressionType.RESERVED_KEYWORD:return n.value;case e.BKExpressionType.OPERATION:var c=n,E=c.left,p=c.operator,l=c.right;return ar(E)+" "+p+" "+ar(l);default:throw new Error("Unable to transpile BK block "+n.type)}},ir=function(e){return e.replace(/[\d-]+/g,"_")},or=function(e,n){var r="((window) => {";r+='var document = window.document;const __each = (object, iterator) => {if (Array.isArray(object)) {object.forEach(iterator);} else {for (const key in object) {iterator(object[key], key);}}};const __count = (object) => {return Array.isArray(object) ? object.length : Object.keys(object).length;};const __defineModule = (run) => {let exports;return () => {if (exports) return exports;exports = {};return exports = run((dep) => {return $$modules[dep]()});}};const __setElementProperty = (element, property, value) => {if (property === "style" && typeof value !== "string") {\nelement.style = "";\nObject.assign(element.style, value);\n} else {\nelement[property] = value;}\n};let updating = false;let toUpdate = [];const __requestUpdate = (object) => {if (toUpdate.indexOf(object) === -1) {toUpdate.push(object);}if (updating) {return;}updating = true;requestAnimationFrame(function() {for(let __i = 0; i < toUpdate.length; __i++) {const target = toUpdate[__i];target.update();}toUpdate = [];updating = false;});};',r+="$$modules = {};";for(var t in n)r+='$$modules["'+t+'"] = '+ur(n[t].module,n[t].resolvedImportUris)+";";return r+='const entry = $$modules["'+e+'"]();',r+="return {entry,modules: $$modules};})(window)"},ur=function(e,n){var r=e.source,t=e.imports,a=e.globalStyles,i=e.components,o=(e.unhandledExpressions,{uri:e.uri,aliases:{},varCount:0,root:r}),u="__defineModule((require) => {";u+="var $$previews = {};";for(var s=wr(a,o),c=0,E=s.length;c<E;c++)u+=(l=s[c]).content,u+="document.body.appendChild("+l.varName+");";for(var c=0,E=t.length;c<E;c++){var p=t[c],l=Vr("import","require("+JSON.stringify(n[p.href])+")",o);u+=l.content}for(var c=0,E=i.length;c<E;c++)u+=cr(i[c],o).content;return u+="return {previews: $$previews};",u+="})"},sr=function(e){return"(() => { const binding = () => { "+e+" }; binding(); return binding; })()"},cr=function(n,r){var t=n.previews,i=n.source,o=n.id,u=n.style,s=n.template,c=Gr(ir(o),r),E=a({},r,{varCount:0,contextName:"this"}),p=Object.keys(en(i).inference.properties),l=u&&Sr(u,E),f="class "+c+" extends HTMLElement {constructor() {super();this.__bindings = [];}connectedCallback() {this.render();}"+p.map(function(e){return"get "+e+"() {return this.__"+e+";}set "+e+"(value) {if (this.__"+e+" === value || String(this.__"+e+") === String(value)) {return;}const oldValue = this.__"+e+";this.__"+e+' = value;if (typeof value !== "object") {this.setAttribute('+JSON.stringify(e)+", value);}if (this._rendered) {__requestUpdate(this);}}"}).join("\n")+'render() {if (this._rendered) {return;}this._rendered = true;const shadow = this.attachShadow({ mode: "open" });'+(l?l.content+"shadow.appendChild("+l.varName+");":"")+p.map(function(e){return"if (this.__"+e+" == null) {this.__"+e+' = this.getAttribute("'+e+'");}'}).join("\n")+"let __bindings = [];"+(s?s.childNodes.map(function(e){var n=Er(e,E);return e&&n?n.content+(n.bindings.length?"__bindings = __bindings.concat("+n.bindings.map(function(e){return"(() => {const __binding = () => {const { "+p.join(",")+" } = this;"+e+"};__binding();return __binding;})()"})+");":"")+"shadow.appendChild("+n.varName+");":""}).join(""):"")+"this.__bindings = __bindings;}cloneShallow() {const clone = super.cloneShallow();clone._rendered = true;return clone;}static get observedAttributes() {return "+JSON.stringify(p)+";}attributeChangedCallback(name, oldValue, newValue) {if (super.attributeChangedCallback) {super.attributeChangedCallback(name, oldValue, newValue);}this[name] = newValue;}update() {if (!this._rendered) {return;}let bindings = this.__bindings || [];"+dr("bindings")+'}}if (!customElements.get("'+o+'")) {customElements.define("'+o+'", '+c+');} else {console.error("Custom element \\"'+o+'\\" is already defined, ignoring");}';return f+='$$previews["'+o+'"] = {};',t.forEach(function(n){var t=T(n,"name"),i=n.childNodes.find(function(n){return n.type===e.PCExpressionType.SELF_CLOSING_ELEMENT||n.type===e.PCExpressionType.ELEMENT});if(i){var u=Er(i,a({},r,{aliases:a({},r.aliases,{preview:o})}));f+='$$previews["'+o+'"]["'+t+'"] = () => {'+u.content+"return "+u.varName+";};"}}),{varName:c,bindings:[],content:f}},Er=function(n,r){switch(n.type){case e.PCExpressionType.FRAGMENT:return pr(n,r);case e.PCExpressionType.TEXT_NODE:return lr(n,r);case e.PCExpressionType.BLOCK:return Tr(n,r);case e.PCExpressionType.ELEMENT:return Rr(n,r);case e.PCExpressionType.SELF_CLOSING_ELEMENT:return fr(n,r)}return null},pr=function(e,n){return kr('document.createDocumentFragment("")',n)},lr=function(e,n){return $r(kr("document.createTextNode("+JSON.stringify(e.value.replace(/[\s\r\n\t]+/g," "))+")",n),e,n)},Tr=function(e,n){var r=kr('document.createTextNode("")',n),t=(r=$r(r,e,n)).varName+"$$currentValue";return r.content+="let "+t+";",r.bindings.push(vr(t,ar(e.value.value),function(e){return r.varName+".nodeValue = "+e},n)),r},fr=function(e,n){return _r(e,$r(yr(e,n),e,n),n)},_r=function(n,r,t){if(!n.modifiers.length)return r;for(var a,i,o,u,s,c=n.modifiers,p=r,l=0,T=c.length;l<T;l++)(M=c[l].value).type===e.BKExpressionType.IF?a=M:M.type===e.BKExpressionType.ELSE?i=M:M.type===e.BKExpressionType.ELSEIF?o=M:M.type===e.BKExpressionType.REPEAT?u=M:M.type===e.BKExpressionType.BIND&&(s=M);if(s){var f=s.value,_=(p={varName:r.varName,content:r.content,bindings:r.bindings.slice()}).varName+"$$spreadValue",y=ar(f);p.content+="let "+_+";",p.bindings.push(vr(_,y,function(e){return"for (const __key in "+_+") {__setElementProperty("+r.varName+", __key, "+_+"[__key]);}"},t)),r=p}if(u){var v=u.each,d=u.asKey,R=u.asValue,S=ar(v),N=d?ar(d):"index",A=ar(R),O=Fr(t),m=O.fragment,g=O.start,x=O.end,I=(p=m).varName+"$$currentValue",P=p.varName+"$$childBindings";p.content+="let "+I+" = [];let "+P+" = [];",p.bindings.push("let $$newValue = ("+S+") || [];if ($$newValue === "+I+") {return;}const $$oldValue = "+I+";"+I+" = $$newValue;const $$parent = "+g.varName+".parentNode;const $$startIndex = Array.prototype.indexOf.call($$parent.childNodes, "+g.varName+"); const $$newValueCount = __count($$newValue);const $$oldValueCount = __count($$oldValue);if ($$newValueCount > $$oldValueCount) {for (let __i = $$newValueCount - $$oldValueCount; __i--;) {"+r.content+"$$parent.insertBefore("+r.varName+", "+x.varName+");const __bindings = ["+r.bindings.map(function(e){return"("+A+", "+N+") => { "+e+"}"}).join(",")+"];"+P+".push(($$newValue, $$newKey) => {"+dr("__bindings","$$newValue, $$newKey")+"});}} else if ($$oldValue.length < $$newValue.length) {}let __i = 0;__each($$newValue, (value, k) => {"+P+"[__i++](value, k);});"),r=p}if(a||o||i){for(var M=a||o||i,U=M.condition,B=t.root===n||t.root.startTag===n?[t.root]:L(t.root,n).childNodes,D=B.findIndex(function(r){return r===n||n.type===e.PCExpressionType.START_TAG&&r.type===e.PCExpressionType.ELEMENT&&r.startTag===n}),b=void 0,l=D+1;l--;){var K=B[l];if(E(K)&&C(K,e.BKExpressionType.IF)){b="condition_"+h(K,t.root).join("");break}}if(!b)throw new Error("Element condition "+e.BKExpressionType[M.type]+" defined without an IF block.");var w=Fr(t),m=w.fragment,g=w.start,x=w.end,Y=(p=m).varName+"__bindings",I=p.varName+"$$currentValue";m.content+="let "+Y+" = [];let "+I+" = false;",a&&(m.content+="let "+b+" = Infinity;"),p.bindings.push("const newValue = Boolean("+(U?ar(U):"true")+") && "+b+" >= "+D+";if (newValue) {"+b+" = "+D+";} else if ("+b+" === "+D+") {"+b+" = Infinity;}if (newValue && newValue === "+I+") {if ("+I+") {"+dr(Y)+"}return;}"+I+" = newValue;"+Y+" = [];if (newValue) {const elementFragment = document.createDocumentFragment();"+r.content+(r.bindings.length?Y+" = "+Y+".concat("+r.bindings.map(sr)+");":"")+"elementFragment.appendChild("+r.varName+");"+x.varName+".parentNode.insertBefore(elementFragment, "+x.varName+");} else {let curr = "+g.varName+".nextSibling;while(curr !== "+x.varName+") {curr.parentNode.removeChild(curr);curr = "+g.varName+".nextSibling;}}")}return p},yr=function(n,r){for(var t=kr('document.createElement("'+(r.aliases[n.name.toLowerCase()]||n.name)+'")',r),a=0,i=n.attributes.length;a<i;a++)!function(a,i){var o=n.attributes[a],u=o.name,s=o.value,c=ir(u);if(s){if(s.type===e.PCExpressionType.STRING){var E=s;t.content+=t.varName+'.setAttribute("'+u+'", '+JSON.stringify(E.value)+");\n"}else if(s.type===e.PCExpressionType.STRING_BLOCK||s.type===e.PCExpressionType.BLOCK){var p=t.varName+"$$"+c+"$$currentValue";t.content+="let "+p+";\n";var l=void 0;l=s.type===e.PCExpressionType.STRING_BLOCK?vr(p,s.values.map(function(n){return n.type===e.PCExpressionType.BLOCK?ar(n.value.value):JSON.stringify(n.value)}).join(" + "),function(e){return t.varName+'.setAttribute("'+u+'", '+e+")"},r):vr(p,ar(s.value.value),function(e){return"__setElementProperty("+t.varName+', "'+c+'", '+e+")"},r),t.bindings.push(l)}}else t.content+=t.varName+'.setAttribute("'+u+'", "true");'}(a);return t},vr=function(e,n,r,t){return"let $$newValue = "+n+";if ($$newValue !== "+e+") {"+e+" = $$newValue;"+r(e)+"}"},dr=function(e,n){return void 0===n&&(n=""),"for (let __i = 0, n = "+e+".length; __i < n; __i++) {"+e+"[__i]("+n+");}"},Rr=function(e,n){switch(e.startTag.name){case"style":return Sr(e,n);default:return _r(e.startTag,Yr(e,n),n)}},Sr=function(e,n){var r=kr('document.createElement("style")',n);(r=$r(r,e,n)).content+="if (window.$synthetic) {";var t=Nr(e.childNodes[0],n);return r.content+=t.content+(r.varName+".$$setSheet(")+t.varName+");",r.content+="} else {"+r.varName+".textContent = "+JSON.stringify(br(e.childNodes[0]))+";}",r},Nr=function(e,n){var r=Cr(e.children,n),t=Hr("new CSSStyleSheet(["+r.map(function(e){return e.varName}).join(",")+"])",n);return t=$r(t,e,n),t.content=r.map(function(e){return e.content}).join("\n")+t.content,t},Cr=function(e,n){return e.map(function(e){return hr(e,n)}).filter(Boolean)},hr=function(n,r){switch(n.type){case e.CSSExpressionType.AT_RULE:return Ar(n,r);case e.CSSExpressionType.STYLE_RULE:return Br(n,r)}throw new Error("Unexpected rule "+n.type)},Ar=function(e,n){switch(e.name){case"media":return Or(e,n);case"keyframes":return gr(e,n);case"font-face":return Lr(e,n);case"import":return Pr(e,n);case"charset":return Mr(e,n)}},Or=function(e,n){return xr(e,n,"CSSMediaRule",Br)},Lr=function(e,n){return $r(Hr("new CSSFontFaceRule("+Dr(mr(e),n)+")",n),e,n)},mr=function(n){return n.children.filter(function(n){return n.type===e.CSSExpressionType.DECLARATION_PROPERTY})},gr=function(e,n){return xr(e,n,"CSSKeyframesRule",Ir)},xr=function(e,n,r,t){var a=e.children.map(function(e){return t(e,n)}).filter(Boolean),i=Hr("new "+r+"("+JSON.stringify(e.params.join(" "))+", ["+a.map(function(e){return e.varName}).join(",")+"])",n);return i.content=a.map(function(e){return e.content}).join("\n")+i.content,i},Ir=function(e,n){return Ur(e,"CSSKeyframeRule",n)},Pr=function(e,n){return null},Mr=function(e,n){return null},Ur=function(e,n,r){return Hr("new "+n+"("+JSON.stringify(e.selectorText)+", "+Dr(mr(e),r)+")",r)},Br=function(e,n){return Ur(e,"CSSStyleRule",n)},Dr=function(e,n){for(var r="{",t=0,a=e;t<a.length;t++){var i=a[t];r+='"'+i.name+'": "'+i.value.replace(/"/g,'\\"').replace(/[\s\r\n\t]+/g," ")+'", '}return"CSSStyleDeclaration.fromObject("+(r+="}")+")"},br=function(e,n){return void 0===n&&(n=function(e){return e}),e.children.map(function(e){return Kr(e,n)}).filter(Boolean).join(" ")},Kr=function(n,r){switch(n.type){case e.CSSExpressionType.AT_RULE:var t=n;if("charset"===t.name||"import"===t.name)return null;o="@"+t.name+" "+t.params+" {";return o+=t.children.map(function(e){return Kr(e,r)}).filter(Boolean).join(" "),o+="}";case e.CSSExpressionType.DECLARATION_PROPERTY:var a=n;return a.name+": "+a.value+";";case e.CSSExpressionType.STYLE_RULE:var i=n,o=r(i.selectorText,i)+" {";return o+=i.children.map(function(e){return Kr(e,r)}).filter(Boolean).join(""),o+="}"}},wr=function(n,r){for(var t=[],a=0,i=n.length;a<i;a++){var o=n[a];if(o.type===e.PCExpressionType.TEXT_NODE&&/^[\s\r\n\t]+$/.test(o.value)){var u=n[a-1],s=n[a+1];if((!u||E(u))&&(!s||E(s)))continue}var c=Er(o,r);c&&t.push(c)}return t},Yr=function(e,n){var r=yr(e.startTag,n);r=$r(r,e,n);for(var t=wr(e.childNodes,n),a=0,i=t.length;a<i;a++){var o=t[a];r.content+=o.content,r.content+=r.varName+".appendChild("+o.varName+");\n",(u=r.bindings).push.apply(u,o.bindings)}return r;var u},Vr=function(e,n,r){var t=Gr(e,r);return{varName:t,bindings:[],content:n?"let "+t+" = "+n+";\n":"let "+t+";\n"}},Gr=function(e,n){return e+"_"+n.varCount++},kr=function(e,n){return Vr("node",e,n)},Hr=function(e,n){return Vr("rule",e,n)},Fr=function(e){var n=kr('document.createDocumentFragment("")',e),r=kr('document.createTextNode("")',e),t=kr('document.createTextNode("")',e);return n.content+=r.content+""+t.content+n.varName+".appendChild("+r.varName+");"+n.varName+".appendChild("+t.varName+");",{fragment:n,start:r,end:t}},$r=function(e,n,r){var t=a({uri:r.uri,type:n.type},n.location);return e.content+=e.varName+".source = "+JSON.stringify(t)+";",e},jr=function(e){},Qr={},Wr=function(e,n){if(Qr[e])return Qr[e];var r={filePath:n,source:e,diagnostics:[],scanner:Y(e)};return Qr[e]={root:Xr(r),diagnostics:r.diagnostics}},Xr=function(n){for(var r,t=n.scanner,a=t.curr(),i=[];!t.ended();)if(i.push(Jr(n)),!r){if((r=t.curr())&&r.type!==g.WHITESPACE&&r.type!==g.COMMA&&!Ue(n,[g.COMMA]))return null;t.next()}return 1===i.length?i[0]:{type:r.type===g.WHITESPACE?e.DcExpressionType.SPACED_LIST:e.DcExpressionType.COMMA_LIST,items:i,location:B(a,t.curr(),t.source)}},Jr=function(e){var n=e.scanner;switch(ge(e),n.curr().type){case g.SINGLE_QUOTE:case g.DOUBLE_QUOTE:return ee(e);case g.HASH:return qr(e);case g.NUMBER:return zr(e);case g.MINUS:return n.hasNext()&&n.peek(1).type===g.NUMBER?zr(e):et(e);case g.TEXT:return et(e);default:Ie(n.source,n.curr())}},qr=function(n){for(var r=n.scanner,t=r.curr(),a="";!r.ended()&&r.curr().type!==g.WHITESPACE;)a+=r.curr().value,r.next();return{type:e.DcExpressionType.COLOR,value:a,location:B(t,r.curr(),r.source)}},zr=function(n){var r=n.scanner,t=r.curr(),a=Zr(n),i="";return r.ended()||r.curr().type===g.WHITESPACE||r.curr().type===g.COMMA||r.curr().type===g.PAREN_CLOSE||(i=r.curr().value,r.next()),{type:e.DcExpressionType.MEASUREMENT,value:a,unit:i,location:B(t,r.curr(),r.source)}},Zr=function(e){var n=e.scanner,r=n.curr().value;return"-"===r&&(r+=n.next().value),n.next(),r},et=function(n){var r=n.scanner,t=r.curr(),a=rt(n);return r.ended()||r.curr().type!==g.PAREN_OPEN?{type:e.DcExpressionType.KEYWORD,name:a}:{type:e.DcExpressionType.CALL,name:a,params:nt(n),location:B(t,r.curr(),r.source)}},nt=function(e){for(var n=e.scanner,r=[];!n.ended()&&n.curr().type!==g.PAREN_CLOSE;)n.next(),ge(e),r.push(Jr(e));return Ue(e,[g.PAREN_CLOSE])?(n.next(),r):null},rt=function(e){for(var n=e.scanner,r="";!n.ended()&&n.curr().type!==g.WHITESPACE&&n.curr().type!==g.PAREN_OPEN&&n.curr().type!==g.PAREN_CLOSE;)r+=n.curr().value,n.next();return r},tt=function(n){switch(n.type){case e.DcExpressionType.SPACED_LIST:return(r=n).items.map(tt).join(" ");case e.DcExpressionType.COMMA_LIST:var r=n;return r.items.map(tt).join(", ");case e.DcExpressionType.KEYWORD:return n.name;case e.DcExpressionType.CALL:var t=n;return t.name+"("+t.params.map(tt).join(", ")+")";case e.DcExpressionType.COLOR:return n.value;case e.BKExpressionType.STRING:return JSON.stringify(n.value);case e.DcExpressionType.MEASUREMENT:var a=n;return""+a.value+a.unit;default:throw new Error("Unable to stringify CSS declaration value type "+n.type)}},at=t(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.MUTATED="MUTATED",n.SET_VALUE_MUTATION="SET_VALUE_MUTATION",n.INSERT_CHILD_MUTATION="INSERT_CHILD_MUTATION",n.REMOVE_CHILD_MUTATION="REMOVE_CHILD_MUTATION",n.SET_PROPERTY_MUTATION="SET_PROPERTY_MUTATION",n.REMOVE_MUTATION="REMOVE_MUTATION",n.createMutationEvent=function(e){return{type:n.MUTATED,mutation:e}},n.createSetValueMutation=function(e,n,r){return{type:e,target:n,newValue:r}},n.createInsertChildMutation=function(e,n,r,t,a){return void 0===t&&(t=Number.MAX_SAFE_INTEGER),{type:e,target:n,child:r,index:t,clone:a}},n.createRemoveChildMutation=function(e,n,r,t){return{type:e,target:n,child:r,index:t}},n.createMoveChildMutation=function(e,n,r,t,a){return{type:e,target:n,child:r,index:t,oldIndex:a}},n.createPropertyMutation=function(e,n,r,t,a,i,o){return{type:e,target:n,name:r,newValue:t,oldValue:a,oldName:i,index:o}},n.createRemoveMutation=function(e,n,r,t,a,i){return{type:e,target:n}}});r(at);at.MUTATED,at.SET_VALUE_MUTATION,at.INSERT_CHILD_MUTATION,at.REMOVE_CHILD_MUTATION,at.SET_PROPERTY_MUTATION,at.REMOVE_MUTATION,at.createMutationEvent,at.createSetValueMutation,at.createInsertChildMutation,at.createRemoveChildMutation,at.createMoveChildMutation,at.createPropertyMutation,at.createRemoveMutation;var it=t(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.STRING_REPLACE="STRING_REPLACE",n.createStringMutation=function(e,r,t){return void 0===t&&(t=""),{startIndex:e,endIndex:r,value:t,type:n.STRING_REPLACE}},n.editString=function(e,n,r){void 0===r&&(r=[]);for(var t=e,a=r.length,i=r.concat(n),o=0,u=n.length;o<u;o++){for(var s=n[o],c=s.startIndex,E=s.endIndex,p=s.value,l=c,T=E,f=!1,_=c===E,y=o+a,v=0;v<y;v++){var d=i[v],R=d.startIndex,S=d.endIndex,N=d.value,C=R===S,h=c===R,A=E===S,O=h&&_,L=A&&_,m=h&&C,g=A&&C,x=O||L||m||g;if(R<E&&R>c&&(T-=E-R),S>c&&S<E&&(l+=S-c),(c>=R&&E<=S||c<R&&E>=S)&&!x){f=!0;break}if(R<=c&&E>R){var I=N.length-(S-R);l=Math.max(0,l+I),T=Math.max(0,T+I)}}f||(t=t.substr(0,l)+p+t.substr(T))}return t}});r(it);it.STRING_REPLACE,it.createStringMutation,it.editString;var ot=t(function(e,n){function r(e,r,t){for(var a=[].concat(e),i=[].concat(e),o=[].concat(r),u=[],s=[],c=0,E=i.length;c<E;c++){for(var p=i[c],l=void 0,T=1/0,f=0,_=o.length;f<_;f++){var y=t(p,R=o[f]);if(~y&&y<T&&(l=R,T=y),0===T)break}null!=l&&(i.splice(c--,1),E--,o.splice(o.indexOf(l),1),s[r.indexOf(l)]=[p,l])}for(c=i.length;c--;){var p=i[c],v=e.indexOf(p);u.push(n.createArrayDeleteMutation(p,v)),a.splice(v,1)}for(var c=0,E=o.length;c<E;c++){R=o[c];s[v=r.indexOf(R)]=[void 0,R]}for(var c=0,E=s.length;c<E;c++)if(null!=s[c]){var d=s[c],p=d[0],R=d[1],S=c;if(null==p)u.push(n.createArrayInsertMutation(S,R)),a.splice(S,0,R);else{var N=a.indexOf(p);u.push(n.createArrayUpdateMutation(e.indexOf(p),N,R,S)),N!==S&&(a.splice(N,1),a.splice(S,0,p))}}return n.createArrayMutation(u)}function t(e,r,t,a){void 0===t&&(t=function(e,n){return n}),void 0===a&&(a=function(e){return e});var i=e.slice();return n.eachArrayValueMutation(r,{insert:function(e){var n=e.index,r=e.value;i.splice(n,0,a(r))},delete:function(e){var n=e.index;i.splice(n,1)},update:function(e){var n=e.patchedOldIndex,r=e.newValue,a=e.index,o=i[n],u=t(o,r);u===o&&n===a||(n!==a&&i.splice(n,1),i.splice(a,0,u))}}),i}Object.defineProperty(n,"__esModule",{value:!0}),n.ARRAY_DIFF="ARRAY_DIFF",n.ARRAY_INSERT="ARRAY_INSERT",n.ARRAY_UPDATE="ARRAY_UPDATE",n.ARRAY_DELETE="ARRAY_DELETE",n.createArrayInsertMutation=function(e,r){return{type:n.ARRAY_INSERT,index:e,value:r}},n.createArrayUpdateMutation=function(e,r,t,a){return{type:n.ARRAY_UPDATE,index:a,newValue:t,originalOldIndex:e,patchedOldIndex:r}},n.createArrayDeleteMutation=function(e,r){return{type:n.ARRAY_DELETE,value:e,index:r}},n.createArrayMutation=function(e){return{type:n.ARRAY_DIFF,mutations:e}},n.diffArray=r,n.eachArrayValueMutation=function(e,r){e.mutations.forEach(function(e){switch(e.type){case n.ARRAY_INSERT:return r.insert(e);case n.ARRAY_DELETE:return r.delete(e);case n.ARRAY_UPDATE:return r.update(e)}})},n.patchArray=t});r(ot);ot.ARRAY_DIFF,ot.ARRAY_INSERT,ot.ARRAY_UPDATE,ot.ARRAY_DELETE,ot.createArrayInsertMutation,ot.createArrayUpdateMutation,ot.createArrayDeleteMutation,ot.createArrayMutation,ot.diffArray,ot.eachArrayValueMutation,ot.patchArray;var ut=t(function(e,n){function r(e){for(var r in e)n.hasOwnProperty(r)||(n[r]=e[r])}Object.defineProperty(n,"__esModule",{value:!0}),r(at),r(it),r(ot)});r(ut);var st=ut.createStringMutation,ct=t(function(e,n){Object.defineProperty(n,"__esModule",{value:!0});!function(e){e.PX="PX",e.PERC="%",e.VW="vw",e.VH="vh",e.CM="cm",e.EM="em",e.EX="ex",e.IN="in",e.MM="mm",e.PC="pc",e.PT="pt",e.VMIN="vmin"}(n.CSSMeasurementTypes||(n.CSSMeasurementTypes={}));!function(e){e.HORIZONTAL="HORIZONTAL",e.VERTICAL="VERTICAL"}(n.Axis||(n.Axis={}));!function(e){e[e.azimuth=0]="azimuth",e[e.borderCollapse=1]="borderCollapse",e[e.borderSpacing=2]="borderSpacing",e[e.captionSide=3]="captionSide",e[e.color=4]="color",e[e.cursor=5]="cursor",e[e.direction=6]="direction",e[e.elevation=7]="elevation",e[e.emptyCells=8]="emptyCells",e[e.fontFamily=9]="fontFamily",e[e.fontSize=10]="fontSize",e[e.fontStyle=11]="fontStyle",e[e.fontVariant=12]="fontVariant",e[e.fontWeight=13]="fontWeight",e[e.font=14]="font",e[e.letterSpacing=15]="letterSpacing",e[e.lineHeight=16]="lineHeight",e[e.listStyleImage=17]="listStyleImage",e[e.listStylePosition=18]="listStylePosition",e[e.listStyleType=19]="listStyleType",e[e.listStyle=20]="listStyle",e[e.orphans=21]="orphans",e[e.pitchRange=22]="pitchRange",e[e.pitch=23]="pitch",e[e.quotes=24]="quotes",e[e.richness=25]="richness",e[e.speakHeader=26]="speakHeader",e[e.speakNumeral=27]="speakNumeral",e[e.speakPunctuation=28]="speakPunctuation",e[e.speak=29]="speak",e[e.speechRate=30]="speechRate",e[e.stress=31]="stress",e[e.textAlign=32]="textAlign",e[e.textIndent=33]="textIndent",e[e.textDecoration=34]="textDecoration",e[e.textTransform=35]="textTransform",e[e.visibility=36]="visibility",e[e.voiceFamily=37]="voiceFamily",e[e.volume=38]="volume",e[e.whiteSpace=39]="whiteSpace",e[e.widows=40]="widows",e[e.wordSpacing=41]="wordSpacing"}(n.INHERITED_CSS_STYLE_PROPERTIES||(n.INHERITED_CSS_STYLE_PROPERTIES={}))});r(ct);ct.CSSMeasurementTypes,ct.Axis,ct.INHERITED_CSS_STYLE_PROPERTIES;var Et=t(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.CSS_STYLE_RULE_SET_SELECTOR_TEXT="CSS_STYLE_RULE_SET_SELECTOR_TEXT",n.CSS_STYLE_RULE_SET_STYLE="CSS_STYLE_RULE_SET_STYLE",n.CSS_STYLE_RULE_SET_STYLE_PROPERTY="CSS_STYLE_RULE_SET_STYLE_PROPERTY",n.CSS_PARENT_INSERT_RULE="CSS_PARENT_INSERT_RULE",n.CSS_PARENT_DELETE_RULE="CSS_PARENT_DELETE_RULE",n.CSS_PARENT_MOVE_RULE="CSS_PARENT_MOVE_RULE",n.CSS_INSERT_CSS_RULE_TEXT="CSS_INSERT_CSS_RULE_TEXT"});r(Et);Et.CSS_STYLE_RULE_SET_SELECTOR_TEXT,Et.CSS_STYLE_RULE_SET_STYLE,Et.CSS_STYLE_RULE_SET_STYLE_PROPERTY,Et.CSS_PARENT_INSERT_RULE,Et.CSS_PARENT_DELETE_RULE,Et.CSS_PARENT_MOVE_RULE,Et.CSS_INSERT_CSS_RULE_TEXT;var pt=t(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SET_ELEMENT_ATTRIBUTE_EDIT="setElementAttributeEdit",n.ATTACH_SHADOW_ROOT_EDIT="attachShadowRootEdit",n.SET_TEXT_CONTENT="setTextContent",n.INSERT_HTML_EDIT="INSERT_HTML_EDIT",n.INSERT_CHILD_NODE_EDIT="INSERT_CHILD_NODE_EDIT",n.REMOVE_CHILD_NODE_EDIT="REMOVE_CHILD_NODE_EDIT",n.MOVE_CHILD_NODE_EDIT="MOVE_CHILD_NODE_EDIT",n.UPDATE_VALUE_NODE="UPDATE_VALUE_NODE"});r(pt);pt.SET_ELEMENT_ATTRIBUTE_EDIT,pt.ATTACH_SHADOW_ROOT_EDIT,pt.SET_TEXT_CONTENT,pt.INSERT_HTML_EDIT,pt.INSERT_CHILD_NODE_EDIT,pt.REMOVE_CHILD_NODE_EDIT,pt.MOVE_CHILD_NODE_EDIT,pt.UPDATE_VALUE_NODE;var lt=t(function(e,n){function r(e){for(var r in e)n.hasOwnProperty(r)||(n[r]=e[r])}Object.defineProperty(n,"__esModule",{value:!0}),r(ct),r(Et),r(pt)});r(lt);var Tt=lt,ft=Tt.UPDATE_VALUE_NODE,_t=Tt.SET_ELEMENT_ATTRIBUTE_EDIT,yt=Tt.INSERT_CHILD_NODE_EDIT,vt=Tt.REMOVE_CHILD_NODE_EDIT,dt=Tt.INSERT_HTML_EDIT,Rt=(Tt.CSS_INSERT_CSS_RULE_TEXT,Tt.CSS_PARENT_DELETE_RULE,Tt.CSS_STYLE_RULE_SET_SELECTOR_TEXT,Tt.CSS_STYLE_RULE_SET_STYLE_PROPERTY,t(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createInsertHTMLMutation=function(e,n,r){return{type:pt.INSERT_HTML_EDIT,html:r,childIndex:n,target:e}}}));r(Rt);Rt.createInsertHTMLMutation;var St=t(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.insertCSSRuleText=function(e,n,r){return{type:Et.CSS_INSERT_CSS_RULE_TEXT,target:e,childIndex:n,cssText:r}}});r(St);St.insertCSSRuleText;var Nt=t(function(e,n){function r(e){for(var r in e)n.hasOwnProperty(r)||(n[r]=e[r])}Object.defineProperty(n,"__esModule",{value:!0}),r(Rt),r(St)});r(Nt);var Ct=t(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),function(e){for(var r in e)n.hasOwnProperty(r)||(n[r]=e[r])}(Nt)});r(Ct);var ht=Ct.createInsertHTMLMutation,At=function(e,n){return{type:"PC_REMOVE_CHILD_NODE",index:n,target:e}},Ot=function(e){return{type:"PC_REMOVE_NODE",target:e}},Lt=function(e,n){var r=k(e),t=gt(r.root,n.target.location||n.target.source);if(n.target.source&&console.warn("Mutation target does not match expected type."),!t)return[st(0,0,"")];switch(n.type){case ft:return Bt(t,n);case _t:return Dt(t,n);case vt:return xt(t,n.index);case yt:return Pt(t,n,e);case dt:return Mt(t,n,e);case"PC_REMOVE_CHILD_NODE":return xt(t,n.index);case"PC_REMOVE_NODE":return It(t)}return[st(0,0,"")]},mt=function(e,n){return e.location.start.line===n.start.line&&e.location.start.column===n.start.column&&e.location.end.line===n.end.line&&e.location.end.column===n.end.column},gt=function(n,r){if(mt(n,r))return n;if(n.type===e.PCExpressionType.FRAGMENT||n.type===e.PCExpressionType.ELEMENT)for(var t=0,a=n.childNodes;t<a.length;t++){var i=a[t],o=gt(i,r);if(o)return o}},xt=function(e,n){var r=e.childNodes[n];return It(r)},It=function(e){return[st(e.location.start.pos,e.location.end.pos,"")]},Pt=function(e,n,r){var t=n.target,a=n.index,i=n.child;return Mt(e,ht(t,a,i.nodeValue||i.outerHTML),r)},Mt=function(n,r,t){var a=r.childIndex,i=r.html;if(n.type===e.PCExpressionType.SELF_CLOSING_ELEMENT)return[st(Ut((u=n).location.end.pos-2,t),u.location.end.pos,">"+i+"</"+u.name+">")];var o=n.childNodes[a];if(!o){var u=n;return[st(u.startTag.location.end.pos,u.startTag.location.end.pos,i)]}return[st(o.location.start.pos,o.location.start.pos,i)]},Ut=function(e,n){var r=n.substr(0,e).split("").reverse().join("").match(/^([\s\r\n\t]+)/)||["",""];return e-r[1].length},Bt=function(e,n){var r=n.newValue;return[st(e.location.start.pos,e.location.end.pos,r)]},Dt=function(n,r){var t;n.type===e.PCExpressionType.SELF_CLOSING_ELEMENT?t=n:n.type===e.PCExpressionType.ELEMENT&&(t=n.startTag);for(var a,i=r.name,o=r.newValue&&'"'+r.newValue+'"',u=0,s=t.attributes;u<s.length;u++){var c=s[u];if(c.name===i)return a=!0,o?[st(c.value.location.start.pos,c.value.location.end.pos,o)]:[st(c.location.start.pos-1,c.location.end.pos,"")]}if(!a){var E=t.location.start.pos+t.name.length+1;return[st(E,E,!0===r.newValue?i:" "+i+"="+o)]}};e.getElementChildNodes=i,e.getElementTagName=o,e.getAttributeStringValue=u,e.getElementAttributes=s,e.getElementModifiers=c,e.isTag=E,e.filterPCElementsByStartTag=p,e.getElementStartTag=l,e.getPCStartTagAttribute=T,e.hasPCStartTagAttribute=f,e.getPCStyleElements=_,e.getPCLinkStyleElements=y,e.getPCCSSElements=v,e.getPCMetaTags=d,e.getPCMetaName=R,e.traversePCAST=S,e.getStartTag=N,e.getPCElementModifier=C,e.getExpressionPath=h,e.filterPCASTTree=A,e.getPCASTElementsByTagName=O,e.getPCParent=L,e.getAllChildElementNames=m,e.parseModuleSource=k,e.parseStyleSource=H,e.createString=ee,e.eatWhitespace=ge,e.throwUnexpectedToken=Ie,e.addUnexpectedToken=Pe,e.testCurrTokenExists=Me,e.testCurrTokenType=Ue,e.bundleVanilla=tr,e.transpileBlockExpression=ar,e.transpileStyleElement=Sr,e.transpileCSSSheet=br,e.loadModuleAST=De,e.defaultResolveModulePath=be,e.getChildComponentInfo=Ke,e.getDependencyGraphComponentsExpressions=we,e.getDependencyChildComponentInfo=Ye,e.getModuleComponent=Ve,e.getUsedDependencies=Ge,e.getImportDependencies=ke,e.getComponentDependency=He,e.loadModuleDependencyGraph=Fe,e.parseMetaContent=je,e.getComponentMetadataItems=Qe,e.getComponentMetadataItem=We,e.loadComponentTypes=jr,e.parseDeclaration=Wr,e.stringifyDeclarationAST=tt,e.editPaperclipSource=Lt,e.PC_REMOVE_CHILD_NODE="PC_REMOVE_CHILD_NODE",e.PC_REMOVE_NODE="PC_REMOVE_NODE",e.createPCRemoveChildNodeMutation=At,e.createPCRemoveNodeMutation=Ot,e.generatePrettyErrorMessage=x,e.EACH_KEY="$$each",e.ANY_REFERENCE=Ze,e.inferNodeProps=en,e.getReferenceKeyPath=cn,e.getNestedInference=yn,e.getTypeLabels=Sn,e.getPrettyTypeLabelEnd=Nn,e.isValidReturnType=gn,e.lintDependencyGraph=Mn,Object.defineProperty(e,"__esModule",{value:!0})});
