window.paperclip=function(e){"use strict";function t(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}const r=Object.assign||function(e){for(var t,r=1;r<arguments.length;r++){t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e};!function(e){e[e.STRING=0]="STRING",e[e.BLOCK=1]="BLOCK",e[e.STRING_BLOCK=2]="STRING_BLOCK",e[e.ELEMENT=3]="ELEMENT",e[e.SELF_CLOSING_ELEMENT=4]="SELF_CLOSING_ELEMENT",e[e.TEXT_NODE=5]="TEXT_NODE",e[e.COMMENT=6]="COMMENT",e[e.ATTRIBUTE=7]="ATTRIBUTE",e[e.START_TAG=8]="START_TAG",e[e.BLOCK_STRING=9]="BLOCK_STRING",e[e.FRAGMENT=10]="FRAGMENT",e[e.END_TAG=11]="END_TAG"}(e.PCExpressionType||(e.PCExpressionType={})),function(e){e[e.TYPE=0]="TYPE",e[e.ECHO=1]="ECHO",e[e.IF=2]="IF",e[e.STRING=3]="STRING",e[e.OBJECT=4]="OBJECT",e[e.ARRAY=5]="ARRAY",e[e.KEY_VALUE_PAIR=6]="KEY_VALUE_PAIR",e[e.NUMBER=7]="NUMBER",e[e.PROPERTY=8]="PROPERTY",e[e.RESERVED_KEYWORD=9]="RESERVED_KEYWORD",e[e.ELSEIF=10]="ELSEIF",e[e.NOT=11]="NOT",e[e.OPERATION=12]="OPERATION",e[e.GROUP=13]="GROUP",e[e.VAR_REFERENCE=14]="VAR_REFERENCE",e[e.PROP_REFERENCE=15]="PROP_REFERENCE",e[e.ELSE=16]="ELSE",e[e.REPEAT=17]="REPEAT"}(e.BKExpressionType||(e.BKExpressionType={})),function(e){e[e.SHEET=0]="SHEET",e[e.DECLARATION_PROPERTY=1]="DECLARATION_PROPERTY",e[e.STYLE_RULE=2]="STYLE_RULE",e[e.AT_RULE=3]="AT_RULE",e[e.IMPORT=4]="IMPORT",e[e.CHARSET=5]="CHARSET"}(e.CSSExpressionType||(e.CSSExpressionType={}));var n,o=function(t){return t.type==e.PCExpressionType.SELF_CLOSING_ELEMENT?[]:t.childNodes},u=function(t){return t.type==e.PCExpressionType.SELF_CLOSING_ELEMENT?t.name:t.startTag.name},i=function(e){return e.value.value},s=function(e){return S(e).attributes},a=function(e){return S(e).modifiers},c=function(t){return t.type===e.PCExpressionType.ELEMENT||t.type===e.PCExpressionType.ELEMENT||t.type===e.PCExpressionType.START_TAG||t.type===e.PCExpressionType.END_TAG},E=function(t,r){return _(t,function(t){return t.type===e.PCExpressionType.SELF_CLOSING_ELEMENT?r(t):t.type===e.PCExpressionType.ELEMENT&&r(t.startTag)})},p=function(t){return t.type===e.PCExpressionType.SELF_CLOSING_ELEMENT||t.type==e.PCExpressionType.START_TAG?t:t.startTag},l=function(e,t){if(f(e,t)){var r=p(e).attributes.find(function(e){return e.name===t});return r&&r.value&&r.value.value}},f=function(t,r){return(t.type===e.PCExpressionType.ELEMENT||t.type===e.PCExpressionType.SELF_CLOSING_ELEMENT||t.type===e.PCExpressionType.START_TAG)&&Boolean(p(t).attributes.find(function(e){return e.name===r}))},T=function(t){return _(t,function(t){return t.type===e.PCExpressionType.ELEMENT&&"style"===t.startTag.name})},y=function(t){return _(t,function(t){return t.type===e.PCExpressionType.SELF_CLOSING_ELEMENT&&"link"===t.name&&"stylesheet"===l(t,"rel")})},d=function(e){return T(e).concat(y(e))},C=function(e){return A(e,"meta")},v=function(e){var t=C(e).find(function(e){return Boolean(l(e,"name"))});return t&&l(t,"content")},N=function(e,t,r){if(void 0===r&&(r=[]),!1===t(e,r))return!1;if(e.childNodes)for(var n=e,o=0,u=n.childNodes.length;o<u;o++){var i=n.childNodes[o];if(!1===N(i,t,r.concat(["childNodes",o])))return!1}},S=function(t){return t.type===e.PCExpressionType.ELEMENT?t.startTag:t},R=function(e,t){return S(e).modifiers.find(function(e){return e.type===t})},h=function(e,t){var r;return N(t,function(t,n){if(t===e)return r=n,!1}),r},_=function(e,t){var r=[];return N(e,function(e){t(e)&&r.push(e)}),r},A=function(e,t){return E(e,function(e){return e.name===t})},O=function(t,r){return _(t,function(t){return t.childNodes&&t.childNodes.find(function(t){return t===r||r.type===e.PCExpressionType.START_TAG&&t.type===e.PCExpressionType.ELEMENT&&t.startTag===r})})[0]},L=function(e,t,r){return{type:e,pos:t,value:r}},x={},m=function(e){if(x[e])return x[e];var t=1,r=0,n={};return(e+" ").split("").forEach(function(e,o){n[o]=[r,t],"\n"===e&&(r=0,t++),r++}),x[e]=n},g=function(e,t){var r="number"==typeof e?e:e.pos,n=m(t)[r];return{column:n[0],line:n[1],pos:r}},P=function(e,t,r){return{start:e.line?e:g(e,r),end:t&&t.line?t:g(r.length,r)}},$=function(){function e(e){this._target=e,this.pos=0,this.length=e.length}return e.prototype.curr=function(){return this._target[this.pos]},e.prototype.shift=function(){var e=this._target[this.pos];return this.next(),e},e.prototype.hasNext=function(){return this.pos<this.length-1},e.prototype.next=function(){return this._target[Math.min(this.pos=this.pos+1,this.length)]},e.prototype.prev=function(){return this._target[Math.max(this.pos=this.pos-1,0)]},e.prototype.ended=function(){return this.pos>=this.length},e}(),B=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return t(r,e),r.prototype.scan=function(e){for(var t="";this.pos<this.length;){var r=this._target[this.pos];if(!r.match(e))break;t+=r,this.pos++}return t},r.prototype.match=function(e){var t=this._target.substr(this.pos),r=t.match(e);if(r){var n=r[0];return this.pos+=t.indexOf(n)+n.length,n}return null},r.prototype.peek=function(e){return this._target.substr(this.pos,e)},r.prototype.take=function(e){var t=this._target.substr(this.pos,e);return this.pos+=e,t},r}($),U=function(e){function r(t,r){var n=e.call(this,r)||this;return n.source=t,n}return t(r,e),r.prototype.peek=function(e){return void 0===e&&(e=1),this._target[this.pos+e]},r.prototype.peekUntil=function(e){for(var t=this.pos;t<this.length-1;)if(e(this._target[++t]))return this._target[t]},r.prototype.curr=function(){return e.prototype.curr.call(this)},r.prototype.next=function(){return e.prototype.next.call(this)},r}($);!function(e){e[e.LESS_THAN=0]="LESS_THAN",e[e.LESS_THAN_OR_EQUAL=1]="LESS_THAN_OR_EQUAL",e[e.CLOSE_TAG=2]="CLOSE_TAG",e[e.COMMA=3]="COMMA",e[e.GREATER_THAN=4]="GREATER_THAN",e[e.GREATER_THAN_OR_EQUAL=5]="GREATER_THAN_OR_EQUAL",e[e.COMMENT=6]="COMMENT",e[e.BACKSLASH=7]="BACKSLASH",e[e.PERIOD=8]="PERIOD",e[e.BANG=9]="BANG",e[e.AND=10]="AND",e[e.OR=11]="OR",e[e.PLUS=12]="PLUS",e[e.COLON=13]="COLON",e[e.SEMICOLON=14]="SEMICOLON",e[e.MINUS=15]="MINUS",e[e.NUMBER=16]="NUMBER",e[e.AT=17]="AT",e[e.STAR=18]="STAR",e[e.PERCENT=19]="PERCENT",e[e.PAREN_OPEN=20]="PAREN_OPEN",e[e.PAREN_CLOSE=21]="PAREN_CLOSE",e[e.DOUBLE_EQUALS=22]="DOUBLE_EQUALS",e[e.TRIPPLE_EQUELS=23]="TRIPPLE_EQUELS",e[e.BRACKET_OPEN=24]="BRACKET_OPEN",e[e.BRACKET_CLOSE=25]="BRACKET_CLOSE",e[e.CURLY_BRACKET_OPEN=26]="CURLY_BRACKET_OPEN",e[e.CURLY_BRACKET_CLOSE=27]="CURLY_BRACKET_CLOSE",e[e.EQUALS=28]="EQUALS",e[e.SINGLE_QUOTE=29]="SINGLE_QUOTE",e[e.DOUBLE_QUOTE=30]="DOUBLE_QUOTE",e[e.TEXT=31]="TEXT",e[e.RESERVED_KEYWORD=32]="RESERVED_KEYWORD",e[e.WHITESPACE=33]="WHITESPACE"}(n||(n={}));var K=function(e){for(var t=new B(e),r=[];!t.ended();){var o=t.curr(),u=void 0;if("<"===o)if("</"===t.peek(2))u=L(n.CLOSE_TAG,t.pos,t.take(2));else if("\x3c!--"===t.peek(4)){for(var i=t.take(4);!t.ended();){var s=t.curr();if("-"===s&&"--\x3e"===t.peek(3)){i+=t.take(3);break}t.next(),i+=s}u=L(n.COMMENT,t.pos,i)}else u="<="===t.peek(2)?L(n.LESS_THAN_OR_EQUAL,t.pos,t.take(2)):L(n.LESS_THAN,t.pos,t.shift());else if("&"===o&&"&&"===t.peek(2))u=L(n.AND,t.pos,t.take(2));else if("|"===o&&"||"===t.peek(2))u=L(n.OR,t.pos,t.take(2));else if(">"===o)u=">="===t.peek(2)?L(n.GREATER_THAN_OR_EQUAL,t.pos,t.take(2)):L(n.GREATER_THAN,t.pos,t.shift());else if("="===o)u="==="===t.peek(3)?L(n.TRIPPLE_EQUELS,t.pos,t.take(3)):"=="===t.peek(2)?L(n.DOUBLE_EQUALS,t.pos,t.take(2)):L(n.EQUALS,t.pos,t.shift());else if(":"===o)u=L(n.COLON,t.pos,t.shift());else if(";"===o)u=L(n.SEMICOLON,t.pos,t.shift());else if("@"===o)u=L(n.AT,t.pos,t.shift());else if(","===o)u=L(n.COMMA,t.pos,t.shift());else if("'"===o)u=L(n.SINGLE_QUOTE,t.pos,t.shift());else if("!"===o)u=L(n.BANG,t.pos,t.shift());else if("/"===o)u=L(n.BACKSLASH,t.pos,t.shift());else if("."===o)u=/\.\d/.test(t.peek(2))?b(t):L(n.PERIOD,t.pos,t.shift());else if('"'===o)u=L(n.DOUBLE_QUOTE,t.pos,t.shift());else if("+"===o)u=L(n.PLUS,t.pos,t.shift());else if("-"===o)u=/\-\d/.test(t.peek(2))?b(t):L(n.MINUS,t.pos,t.shift());else if("*"===o)u=L(n.STAR,t.pos,t.shift());else if("%"===o)u=L(n.PERCENT,t.pos,t.shift());else if("["===o)u=L(n.BRACKET_OPEN,t.pos,t.shift());else if("]"===o)u=L(n.BRACKET_CLOSE,t.pos,t.shift());else if("("===o)u=L(n.PAREN_OPEN,t.pos,t.shift());else if(")"===o)u=L(n.PAREN_CLOSE,t.pos,t.shift());else if("{"===o)u=L(n.CURLY_BRACKET_OPEN,t.pos,t.shift());else if("}"===o)u=L(n.CURLY_BRACKET_CLOSE,t.pos,t.shift());else if(/\d/.test(o))u=b(t);else if(/[\s\r\n\t]/.test(o))u=L(n.WHITESPACE,t.pos,t.scan(/[\s\r\n\t]/));else{var a=t.scan(/[^-<>,='":@;\.\/\\(){}\[\]\s\r\n\t]/)||t.shift();u=L("undefined"===a?n.RESERVED_KEYWORD:n.TEXT,t.pos,a)}r.push(u)}return new U(e,r)},b=function(e){return L(n.NUMBER,e.pos,e.match(/^\-?(\d+(\.\d+)?|\.\d+)/))},M={},I=function(e){if(M[e])return M[e];var t=K(e);return M[e]=w(t)},G=function(e){if(M[e])return M[e];var t=K(e);return M[e]=ae(t)},w=function(t){for(var r=[];!t.ended();)r.push(D(t));return 1===r.length?r[0]:{type:e.PCExpressionType.FRAGMENT,location:P(0,t.source.length,t.source),childNodes:r}},D=function(e){switch(e.curr().type){case n.WHITESPACE:return Ce(e);case n.SINGLE_QUOTE:case n.DOUBLE_QUOTE:return de(e);case n.LESS_THAN:return fe(e);case n.CLOSE_TAG:return le(e);case n.COMMENT:return ie(e);default:return se(e)?k(e):Ce(e)}},k=function(t){var r=t.curr();t.next(),t.next(),ve(t);var n=V(t);return ve(t),t.next(),t.next(),{type:e.PCExpressionType.BLOCK,location:P(r,t.curr(),t.source),value:n}},V=function(t){switch(t.curr().value){case"bind":return Z(t);case"repeat":return re(t);case"if":return te(t,e.BKExpressionType.IF);case"elseif":return te(t,e.BKExpressionType.ELSEIF);case"else":return te(t,e.BKExpressionType.ELSE);case"property":return ee(t,e.BKExpressionType.PROPERTY);default:Se(t.source,t.curr())}},Y=function(e){return F(e)},F=function(t){var r=H(t);ve(t);var o=t.curr(),u=o.type;if(!(u===n.AND||u===n.OR||u==n.PLUS||u===n.MINUS||u===n.STAR||u===n.BACKSLASH||u===n.DOUBLE_EQUALS||u===n.TRIPPLE_EQUELS||u===n.GREATER_THAN||u===n.LESS_THAN||u===n.LESS_THAN_OR_EQUAL||u===n.GREATER_THAN_OR_EQUAL))return r;t.next(),ve(t);var i=F(t);return{type:e.BKExpressionType.OPERATION,left:r,right:i,operator:o.value,location:P(r.location.start,i.location.end,t.source)}},H=function(e){switch(ve(e),e.curr().type){case n.BANG:return ue(e);case n.SINGLE_QUOTE:case n.DOUBLE_QUOTE:return j(e);case n.NUMBER:return Q(e);case n.CURLY_BRACKET_OPEN:return W(e);case n.BRACKET_OPEN:return J(e);case n.PAREN_OPEN:return q(e);case n.TEXT:return ne(e);case n.RESERVED_KEYWORD:return z(e);default:Se(e.source,e.curr())}},j=function(t){var r=t.curr();t.next();for(var n="";!t.ended();){var o=t.curr();if(o.value===r.value)break;"\\"!==o.value?(n+=o.value,t.next()):(n+=t.next().value,t.next())}return t.next(),{type:e.BKExpressionType.STRING,location:P(r,t.curr(),t.source),value:n}},Q=function(t){var r=t.curr();return t.next(),{type:e.BKExpressionType.NUMBER,value:r.value,location:P(r,t.curr(),t.source)}},W=function(t){var r=t.curr();t.next();for(var o=[];!t.ended()&&(ve(t),t.curr().type!==n.CURLY_BRACKET_CLOSE);){o.push(X(t)),ve(t);var u=t.curr();u.type!==n.CURLY_BRACKET_CLOSE&&(u.type!==n.COMMA&&u&&Se(t.source,u),t.next())}return Re(t,n.CURLY_BRACKET_CLOSE),t.next(),{type:e.BKExpressionType.OBJECT,location:P(r,t.curr(),t.source),properties:o}},J=function(t){var r=t.curr();t.next(),ve(t);var o=[];if(t.curr().type!==n.BRACKET_CLOSE)for(;;){if(o.push(H(t)),ve(t),t.curr().type===n.BRACKET_CLOSE)break;Re(t,n.COMMA),t.next()}return Re(t,n.BRACKET_CLOSE),t.next(),{type:e.BKExpressionType.ARRAY,location:P(r,t.curr(),t.source),values:o}},X=function(t){var r;switch(t.curr().type){case n.SINGLE_QUOTE:case n.DOUBLE_QUOTE:r=j(t);break;default:r=oe(t)}ve(t),Re(t,n.COLON),t.next(),ve(t);var o=Y(t);return{type:e.BKExpressionType.KEY_VALUE_PAIR,location:P(r.location.start,o.location.end,t.source),key:r.name,value:o}},q=function(t){var r=t.curr();t.next();var n=Y(t);return t.next(),{type:e.BKExpressionType.GROUP,value:n,location:P(r,t.curr(),t.source)}},z=function(t){var r=t.curr();return t.next(),{type:e.BKExpressionType.RESERVED_KEYWORD,value:r.value,location:P(r,t.curr(),t.source)}},Z=function(t){var r=t.curr();return t.next(),t.next(),{type:e.BKExpressionType.ECHO,value:Y(t),location:P(r,t.curr(),t.source)}},ee=function(e,t){var r=e.curr();return e.next(),e.next(),{type:t,name:oe(e).name,location:P(r,e.curr(),e.source)}},te=function(e,t){var r=e.curr();return e.next(),e.next(),{type:t,condition:Y(e),location:P(r,e.curr(),e.source)}},re=function(t){var r=t.curr();t.next();var n=oe(t);ve(t),t.next();var o,u=oe(t);return","===t.curr().value&&(t.next(),o=oe(t)),{type:e.BKExpressionType.REPEAT,location:P(r,t.curr(),t.source),each:n,asKey:o,asValue:u}},ne=function(t){for(var r=oe(t),o=[r];!t.ended()&&t.curr().type===n.PERIOD;)t.next(),Re(t,n.TEXT),o.push(oe(t));return 1===o.length?o[0]:{type:e.BKExpressionType.PROP_REFERENCE,path:o,location:P(r.location.start,t.curr(),t.source)}},oe=function(t){ve(t);var r=t.curr();return t.next(),{type:e.BKExpressionType.VAR_REFERENCE,name:r.value,location:P(r,t.curr(),t.source)}},ue=function(t){var r=t.curr();return t.next(),{type:e.BKExpressionType.NOT,value:H(t),location:P(r,t.curr(),t.source)}},ie=function(t){var r=t.curr();return t.next(),{type:e.PCExpressionType.COMMENT,value:r.value.substr(4,r.value.length-7),location:P(r,t.curr(),t.source)}},se=function(e){return e.curr().type===n.BRACKET_OPEN&&e.peek(1).type===n.BRACKET_OPEN},ae=function(t){for(var r=t.curr(),o=[];!t.ended()&&t.curr().type!==n.CLOSE_TAG;)o.push(ce(t)),ve(t);return{type:e.CSSExpressionType.SHEET,children:o,location:P(r,t.curr(),t.source)}},ce=function(e){switch(ve(e),e.curr().type){case n.AT:return Ee(e);default:return pe(e)}},Ee=function(t){var r=t.curr();t.next();for(var o="";t.curr().type!==n.WHITESPACE&&t.curr().type!==n.CURLY_BRACKET_OPEN;)o+=t.curr().value,t.next();t.next();var u=[],i=[];for(ve(t);!t.ended()&&(ve(t),t.curr().type!==n.CURLY_BRACKET_OPEN&&t.curr().type!==n.SEMICOLON);)t.curr().type===n.SINGLE_QUOTE||t.curr().type===n.DOUBLE_QUOTE?u.push(j(t).value):(u.push(t.curr().value),t.next());var s=t.curr();if(t.next(),s.type===n.CURLY_BRACKET_OPEN){for(;!t.ended()&&(ve(t),t.curr().type!==n.CURLY_BRACKET_CLOSE);)i.push(ce(t));Re(t,n.CURLY_BRACKET_CLOSE),t.next()}return{type:e.CSSExpressionType.AT_RULE,name:o,params:u,children:i,location:P(r,t.curr(),t.source)}},pe=function(t){for(var r=t.curr(),o="";!t.ended()&&t.curr().type!==n.CURLY_BRACKET_OPEN&&t.curr().type!==n.SEMICOLON&&t.curr().type!==n.CURLY_BRACKET_CLOSE;)o+=t.curr().value,t.next();if(t.curr().type===n.SEMICOLON||t.curr().type===n.CURLY_BRACKET_CLOSE){var u=o.split(":"),i=u[0],s=u[1];return t.curr().type===n.SEMICOLON&&t.next(),{type:e.CSSExpressionType.DECLARATION_PROPERTY,location:P(r,t.curr(),t.source),name:i,value:s}}Re(t,n.CURLY_BRACKET_OPEN),t.next();var a=[];for(ve(t);!t.ended()&&t.curr().type!==n.CURLY_BRACKET_CLOSE;)a.push(pe(t)),ve(t);return Re(t,n.CURLY_BRACKET_CLOSE),t.next(),o=o.trim(),{type:e.CSSExpressionType.STYLE_RULE,children:a,selectorText:o,location:P(r,t.curr(),t.source)}},le=function(t){var r=t.curr();t.next();var o=Ne(t);return Re(t,n.GREATER_THAN),t.next(),{type:e.PCExpressionType.END_TAG,name:o,location:P(r,t.curr(),t.source)}},fe=function(t){var r=t.curr();Re(t,n.LESS_THAN),t.next();for(var o=Ne(t),u=[],i=[];!t.ended();){ve(t);var s=t.curr();if(s.type===n.BACKSLASH||s.type==n.GREATER_THAN)break;se(t)?i.push(k(t)):u.push(ye(t))}if(t.curr().type===n.BACKSLASH)return t.next(),t.next(),{type:e.PCExpressionType.SELF_CLOSING_ELEMENT,name:o,attributes:u,modifiers:i,location:P(r,t.curr(),t.source)};t.next();var a=t.curr(),c=Te(o,t),E=c[0],p=c[1];return{type:e.PCExpressionType.ELEMENT,startTag:{name:o,type:e.PCExpressionType.START_TAG,location:P(r,a,t.source),modifiers:i,attributes:u},childNodes:E,location:P(r,t.curr(),t.source),endTag:p}},Te=function(t,r){var o=[];if("style"===t){var u=ae(r);return ve(r),Re(r,n.CLOSE_TAG),[[u],le(r)]}if("style"===t||"script"===t){for(var i="",s=r.curr();!r.ended()&&r.curr().type!==n.CLOSE_TAG;)i+=r.curr().value,r.next();return[[{type:e.PCExpressionType.TEXT_NODE,value:i,location:P(s,r.curr(),r.source)}],D(r)]}for(var a;!r.ended();){var c=D(r);if(c.type===e.PCExpressionType.END_TAG){a=c;break}o.push(c)}return[o,a]},ye=function(t){var r,o=t.curr(),u=Ne(t);return t.curr().type===n.EQUALS&&(t.next(),r=D(t)),{type:e.PCExpressionType.ATTRIBUTE,name:u,value:r,location:P(o,t.curr(),t.source)}},de=function(t){var r=t.curr(),n=[],o=!1;for(t.next();!t.ended();){var u=t.curr();if(u.type===r.type)break;se(t)?(o=!0,n.push(k(t))):(t.next(),n.push({type:e.PCExpressionType.STRING,value:u.value,location:P(u.pos,t.curr(),t.source)}))}t.next();var i=P(r,t.curr(),t.source);return o?{type:e.PCExpressionType.STRING_BLOCK,location:i,values:n}:{type:e.PCExpressionType.STRING,location:i,value:n.map(function(e){return e.value}).join("")}},Ce=function(t){var r=t.curr();t.next();for(var o=r.value;!t.ended();){var u=t.curr();if(u.type===n.COMMENT||u.type===n.LESS_THAN||u.type==n.CLOSE_TAG||se(t))break;t.next(),o+=u.value}return{type:e.PCExpressionType.TEXT_NODE,value:o,location:P(r,t.curr(),t.source)}},ve=function(e){for(;e.curr().type===n.WHITESPACE;)e.next()},Ne=function(e){for(var t="";e.curr().type!==n.WHITESPACE&&e.curr().type!==n.GREATER_THAN&&e.curr().type!==n.EQUALS;)t+=e.curr().value,e.next();return t},Se=function(e,t){if(!t)throw new Error("Unexpected end of file (missing closing expression).");var r=g(t,e);throw new Error('Unexpected token "'+t.value+'" at '+r.line+":"+r.column)},Re=function(e,t){var r=e.curr();r&&r.type===t||Se(e.source,e.curr())},he=function(e){e.curr()||Se(e.source,e.curr())};!function(e){e.TANDEM="TANDEM",e.WEB="WEB"}(e.PaperclipTargetType||(e.PaperclipTargetType={}));var _e=Symbol(),Ae=function(e){if(e[_e]&&e[_e][0]===e)return e[_e][1];var t=Le(e);return e[_e]=[e,t],t},Oe=function(e,t,r){return void 0===r&&(r={}),r[e]?Promise.resolve(r):t.readFile(e).then(I).then(Ae).then(function(n){return r[e]=n,Promise.all(n.imports.map(function(n){return t.resolveFile(n.href,e).then(function(e){return Oe(e,t,r)})}))}).then(function(){return r}).catch(function(t){throw console.error("Error in "+e),t})},Le=function(t){for(var r=t.type===e.PCExpressionType.FRAGMENT?t.childNodes:[t],n=[],i=[],c=[],E=[],p=0,l=r.length;p<l;p++){var f=r[p];if(f.type===e.PCExpressionType.SELF_CLOSING_ELEMENT||f.type===e.PCExpressionType.ELEMENT){var T=f,y=u(T),d=o(T),C=s(T),v=a(T);if("component"===y){i.push(xe(v,C,d));continue}if("link"===y){n.push(ge(C));continue}if("style"===y){c.push(T);continue}}E.push(f)}return{source:t,imports:n,components:i,globalStyles:c,unhandledExpressions:E}},xe=function(t,r,n){for(var a,c,E,p=t.map(function(e){return e.value}).filter(function(t){return t.type===e.BKExpressionType.PROPERTY}),l=0,f=r.length;l<f;l++){var T=r[l];"id"===T.name&&(a=i(T))}for(var l=0,f=n.length;l<f;l++){var y=n[l];if(y.type===e.PCExpressionType.SELF_CLOSING_ELEMENT||y.type===e.PCExpressionType.ELEMENT){var d=y,C=u(d),v=s(d),N=o(d);"style"===C?c=d:"template"===C&&(E=me(v,N))}}return{id:a,style:c,properties:p,template:E}},me=function(e,t){return{content:t}},ge=function(e){for(var t,r,n=0,o=e.length;n<o;n++){var u=e[n];"href"===u.name?t=i(u):"type"===u.name&&(r=i(u))}return{type:r,href:t}},Pe=function(e,t){return Oe(e,t.io).then(function(t){return{code:Ue(e,t)}})},$e=function(t){switch(t.type){case e.BKExpressionType.NOT:return"!"+$e(t.value);case e.BKExpressionType.PROP_REFERENCE:return(n=t).path.map($e).join(".");case e.BKExpressionType.STRING:var r=t;return JSON.stringify(r.value);case e.BKExpressionType.NUMBER:return t.value;case e.BKExpressionType.VAR_REFERENCE:var n=t;return n.name;case e.BKExpressionType.ARRAY:return"["+t.values.map($e)+"]";case e.BKExpressionType.OBJECT:for(var o=t,u="{",i=0,s=o.properties.length;i<s;i++){var a=o.properties[i];u+=a.key+":"+$e(a.value)+", "}return u+="}";case e.BKExpressionType.GROUP:return"("+$e(t.value)+")";case e.BKExpressionType.RESERVED_KEYWORD:return t.value;case e.BKExpressionType.OPERATION:var c=t,E=c.left,p=c.operator,l=c.right;return $e(E)+" "+p+" "+$e(l);default:throw new Error("Unable to transpile BK block "+t.type)}},Be=function(e){return e.replace(/[\d-]+/g,"_")},Ue=function(e,t){var r="((window) => {";r+="var document = window.document;const $$each = (object, iterator) => {if (Array.isArray(object)) {object.forEach(iterator);} else {for (const key in object) {iterator(object[key], key);}}};const $$count = (object) => {return Array.isArray(object) ? object.length : Object.keys(object).length;};const $$defineModule = (deps, run) => {let exports;return () => {if (exports) return exports;exports = {};return exports = run((dep) => $$modules[deps[dep]]());}};let updating = false;let toUpdate = [];const $$requestUpdate = (object) => {if (toUpdate.indexOf(object) === -1) {toUpdate.push(object);}if (updating) {return;}updating = true;requestAnimationFrame(function() {for(let i = 0; i < toUpdate.length; i++) {const target = toUpdate[i];target.update();}toUpdate = [];updating = false;});};",r+="$$modules = {};";for(var n in t)r+='$$modules["'+n+'"] = '+Ke(t[n])+";";return r+='const entry = $$modules["'+e+'"]();',r+="return {entry,modules: $$modules};})(window)"},Ke=function(e){var t=e.source,r=(e.imports,e.globalStyles),n=e.components,o=e.unhandledExpressions,u={varCount:0,root:t},i="$$defineModule({}, (require) => {";i+="$$strays = [];",i+="$$globalStyles = [];";for(var s=lt(r,u),a=0,c=s.length;a<c;a++)i+=(p=s[a]).content,i+="$$globalStyles.push("+p.varName+");";for(var E=lt(o,u),a=0,c=E.length;a<c;a++){var p=E[a];i+=p.content,i+=p.bindings.map(be).join("\n"),i+="if ("+p.varName+".nodeType != null) {\n",i+="  $$strays.push("+p.varName+");\n",i+="}\n;"}for(var a=0,c=n.length;a<c;a++)i+=Ie(n[a],u).content;return i+="return {strays: $$strays,globalStyles: $$globalStyles};",i+="})"},be=function(e){return"(() => {"+e+"} )();\n"},Me=function(e){return"(() => { const binding = () => { "+e+" }; binding(); return binding; })()"},Ie=function(e,t){var n=e.id,o=e.style,u=e.template,i=e.properties,s=yt(Be(n),t),a=o&&We(o,t),c=r({},t,{varCount:0,contextName:"this"});return{varName:s,bindings:[],content:"class "+s+" extends HTMLElement {constructor() {super();this.$$bindings = [];}connectedCallback() {this.render();}"+i.map(function(e){var t=e.name;return"get "+t+"() {return this.$$"+t+";}set "+t+"(value) {if (this.$$"+t+" === value) {return;}const oldValue = this.$"+t+";this.$$"+t+" = value;if (this._rendered) {$$requestUpdate(this);}}"}).join("\n")+'render() {if (this._rendered) {return;}this._rendered = true;const shadow = this.attachShadow({ mode: "open" });'+(a?a.content+"shadow.appendChild("+a.varName+");":"")+i.map(function(e){var t=e.name,r=e.defaultValue;return"if (this.$$"+t+" == null) {this.$$"+t+" = "+(r||'this.getAttribute("'+t+'");')+"}"}).join("\n")+"let $$bindings = [];"+(u?u.content.map(function(e){var t=Ge(e,c);return e?t.content+(t.bindings.length?"$$bindings = $$bindings.concat("+t.bindings.map(function(e){return"(() => {const $$binding = () => {const { "+i.map(function(e){return e.name}).join(",")+" } = this;"+e+"};$$binding();return $$binding;})()"})+");":"")+"shadow.appendChild("+t.varName+");":""}).join(""):"")+"this.$$bindings = $$bindings;}cloneShallow() {const clone = super.cloneShallow();clone._rendered = true;return clone;}static get observedAttributes() {return "+JSON.stringify(i.map(function(e){return e.name}))+";}attributeChangedCallback(name, oldValue, newValue) {if (super.attributeChangedCallback) {super.attributeChangedCallback(name, oldValue, newValue);}this[name] = newValue;}update() {if (!this._rendered) {return;}let bindings = this.$$bindings || [];"+je("bindings")+'}}customElements.define("'+n+'", '+s+");"}},Ge=function(t,r){switch(t.type){case e.PCExpressionType.FRAGMENT:return we(t,r);case e.PCExpressionType.TEXT_NODE:return De(t,r);case e.PCExpressionType.BLOCK:return ke(t,r);case e.PCExpressionType.ELEMENT:return Qe(t,r);case e.PCExpressionType.SELF_CLOSING_ELEMENT:return Ve(t,r)}return null},we=function(e,t){return dt('document.createDocumentFragment("")',t)},De=function(e,t){return dt("document.createTextNode("+JSON.stringify(e.value.replace(/[\s\r\n\t]+/g," "))+")",t)},ke=function(e,t){var r=dt('document.createTextNode("")',t),n=r.varName+"$$currentValue";return r.content+="let "+n+";",r.bindings.push(He(n,$e(e.value.value),function(e){return r.varName+".nodeValue = "+e},t)),r},Ve=function(e,t){return Ye(e,Fe(e,t),t)},Ye=function(t,r,n){if(!t.modifiers.length)return r;for(var o,u,i,s,a=t.modifiers,c=r,E=0,p=a.length;E<p;E++){var l=a[E].value;l.type===e.BKExpressionType.IF?o=l:l.type===e.BKExpressionType.ELSE?u=l:l.type===e.BKExpressionType.ELSEIF?i=l:l.type===e.BKExpressionType.REPEAT&&(s=l)}if(s){var f=s.each,T=s.asKey,y=s.asValue,d=$e(f),C=T?$e(T):"index",v=$e(y),N=vt(n),S=N.fragment,_=N.start,A=N.end,L=(c=S).varName+"$$currentValue",x=c.varName+"$$childBindings";c.content+="let "+L+" = [];let "+x+" = [];",c.bindings.push("let $$newValue = ("+d+") || [];if ($$newValue === "+L+") {return;}const $$oldValue = "+L+";"+L+" = $$newValue;const $$parent = "+_.varName+".parentNode;const $$startIndex = Array.prototype.indexOf.call($$parent.childNodes, "+_.varName+"); const $$newValueCount = $$count($$newValue);const $$oldValueCount = $$count($$oldValue);if ($$newValueCount > $$oldValueCount) {for (let $$i = $$newValueCount - $$oldValueCount; $$i--;) {"+r.content+"$$parent.insertBefore("+r.varName+", "+A.varName+");const $$bindings = ["+r.bindings.map(function(e){return"("+v+", "+C+") => { "+e+"}"}).join(",")+"];"+x+".push(($$newValue, $$newKey) => {"+je("$$bindings","$$newValue, $$newKey")+"});}} else if ($$oldValue.length < $$newValue.length) {}let i = 0;$$each($$newValue, (value, k) => {"+x+"[i++](value, k);});"),r=c}if(o||i||u){for(var m=(o||i||u).condition,g=n.root===t||n.root.startTag===t?[n.root]:O(n.root,t).childNodes,P=g.findIndex(function(r){return r===t||t.type===e.PCExpressionType.START_TAG&&r.type===e.PCExpressionType.ELEMENT&&r.startTag===t}),$=void 0,E=P+1;E--;){var B=g[E];if(R(B,e.BKExpressionType.IF)){$="condition_"+h(B,n.root).join("");break}}var U=vt(n),S=U.fragment,_=U.start,A=U.end,K=(c=S).varName+"$$bindings",L=c.varName+"$$currentValue";S.content+="let "+K+" = [];let "+L+" = false;",o&&(S.content+="let "+$+" = Infinity;"),c.bindings.push("const newValue = Boolean("+(m?$e(m):"true")+") && "+$+" >= "+P+";if (newValue) {"+$+" = "+P+";} else if ("+$+" === "+P+") {"+$+" = Infinity;}if (newValue && newValue === "+L+") {if ("+L+") {"+je(K)+"}return;}"+L+" = newValue;"+K+" = [];if (newValue) {const elementFragment = document.createDocumentFragment();"+r.content+(r.bindings.length?K+" = "+K+".concat("+r.bindings.map(Me)+")":"")+"elementFragment.appendChild("+r.varName+");"+A.varName+".parentNode.insertBefore(elementFragment, "+A.varName+");} else {let curr = "+_.varName+".nextSibling;while(curr !== "+A.varName+") {curr.parentNode.removeChild(curr);curr = "+_.varName+".nextSibling;}}")}return c},Fe=function(t,r){for(var n=dt('document.createElement("'+t.name+'")',r),o=0,u=t.attributes.length;o<u;o++)!function(o,u){var i=t.attributes[o],s=i.name,a=i.value,c=Be(s);if(a){if(a.type===e.PCExpressionType.STRING){var E=a;n.content+=n.varName+'.setAttribute("'+s+'", '+JSON.stringify(E.value)+");\n"}else if(a.type===e.PCExpressionType.STRING_BLOCK||a.type===e.PCExpressionType.BLOCK){var p=n.varName+"$$"+c+"$$currentValue";n.content+="let "+p+";\n";var l=void 0;l=a.type===e.PCExpressionType.STRING_BLOCK?He(p,a.values.map(function(t){return t.type===e.PCExpressionType.BLOCK?$e(t.value.value):JSON.stringify(t.value)}).join(" + "),function(e){return n.varName+'.setAttribute("'+s+'", '+e+")"},r):He(p,$e(a.value.value),function(e){return n.varName+"."+c+" = "+e},r),n.bindings.push(l)}}else n.content+=n.varName+'.setAttribute("'+s+'", "true");'}(o);return n},He=function(e,t,r,n){return"let $$newValue = "+t+";if ($$newValue !== "+e+") {"+r(e+" = $$newValue")+"}"},je=function(e,t){return void 0===t&&(t=""),"for (let i = 0, n = "+e+".length; i < n; i++) {"+e+"[i]("+t+");}"},Qe=function(e,t){switch(e.startTag.name){case"style":return We(e,t);default:return Ye(e.startTag,ft(e,t),t)}},We=function(e,t){var r=dt('document.createElement("style")',t);r.content+="if (window.$synthetic) {";var n=Je(e.childNodes[0],t);return r.content+=n.content+(r.varName+".$$setSheet(")+n.varName+");",r.content+="} else {"+r.varName+".textContent = "+JSON.stringify(Et(e.childNodes[0]))+";}",r},Je=function(e,t){var r=Xe(e.children,t),n=Ct("new CSSStyleSheet(["+r.map(function(e){return e.varName}).join(",")+"])",t);return n.content=r.map(function(e){return e.content}).join("\n")+n.content,n},Xe=function(e,t){return e.map(function(e){return qe(e,t)}).filter(Boolean)},qe=function(t,r){switch(t.type){case e.CSSExpressionType.AT_RULE:return ze(t,r);case e.CSSExpressionType.STYLE_RULE:return at(t,r)}throw new Error("Unexpected rule "+t.type)},ze=function(e,t){switch(e.name){case"media":return Ze(e,t);case"keyframes":return rt(e,t);case"font-face":return et(e,t);case"import":return ut(e,t);case"charset":return it(e,t)}},Ze=function(e,t){return nt(e,t,"CSSMediaRule",at)},et=function(e,t){return Ct("new CSSFontFaceRule("+ct(tt(e),t)+")",t)},tt=function(t){return t.children.filter(function(t){return t.type===e.CSSExpressionType.DECLARATION_PROPERTY})},rt=function(e,t){return nt(e,t,"CSSKeyframesRule",ot)},nt=function(e,t,r,n){var o=e.children.map(function(e){return n(e,t)}).filter(Boolean),u=Ct("new "+r+"("+JSON.stringify(e.params.join(" "))+", ["+o.map(function(e){return e.varName}).join(",")+"])",t);return u.content=o.map(function(e){return e.content}).join("\n")+u.content,u},ot=function(e,t){return st(e,"CSSKeyframeRule",t)},ut=function(e,t){return null},it=function(e,t){return null},st=function(e,t,r){return Ct("new "+t+"("+JSON.stringify(e.selectorText)+", "+ct(tt(e),r)+")",r)},at=function(e,t){return st(e,"CSSStyleRule",t)},ct=function(e,t){for(var r="{",n=0,o=e;n<o.length;n++){var u=o[n];r+='"'+u.name+'": "'+u.value.replace(/"/g,'\\"').replace(/[\s\r\n\t]+/g," ")+'", '}return"CSSStyleDeclaration.fromObject("+(r+="}")+")"},Et=function(e){return e.children.map(function(e){return pt(e)}).filter(Boolean).join(" ")},pt=function(t){switch(t.type){case e.CSSExpressionType.AT_RULE:var r=t;if("charset"===r.name||"import"===r.name)return null;u="@"+r.name+" "+r.params+" {";return u+=r.children.map(pt).filter(Boolean).join(" "),u+="}";case e.CSSExpressionType.DECLARATION_PROPERTY:var n=t;return n.name+": "+n.value+";";case e.CSSExpressionType.STYLE_RULE:var o=t,u=o.selectorText+" {";return u+=o.children.map(pt).filter(Boolean).join(""),u+="}"}},lt=function(t,r){for(var n=[],o=0,u=t.length;o<u;o++){var i=t[o];if(i.type===e.PCExpressionType.TEXT_NODE&&/^[[\s\r\n\t]$/.test(i.value)&&o>0&&o<u-1){var s=t[o-1],a=t[o+1];if(c(s)&&c(a))continue}var E=Ge(i,r);E&&n.push(E)}return n},ft=function(e,t){for(var r=Fe(e.startTag,t),n=lt(e.childNodes,t),o=0,u=n.length;o<u;o++){var i=n[o];r.content+=i.content,r.content+=r.varName+".appendChild("+i.varName+");\n",(s=r.bindings).push.apply(s,i.bindings)}return r;var s},Tt=function(e,t,r){var n=yt(e,r);return{varName:n,bindings:[],content:t?"let "+n+" = "+t+";\n":"let "+n+";\n"}},yt=function(e,t){return e+"_"+t.varCount++},dt=function(e,t){return Tt("node",e,t)},Ct=function(e,t){return Tt("rule",e,t)},vt=function(e){var t=dt('document.createDocumentFragment("")',e),r=dt('document.createTextNode("")',e),n=dt('document.createTextNode("")',e);return t.content+=r.content+""+n.content+t.varName+".appendChild("+r.varName+");"+t.varName+".appendChild("+n.varName+");",{fragment:t,start:r,end:n}};return e.getElementChildNodes=o,e.getElementTagName=u,e.getAttributeStringValue=i,e.getElementAttributes=s,e.getElementModifiers=a,e.isTag=c,e.filterPCElementsByStartTag=E,e.getElementStartTag=p,e.getPCStartTagAttribute=l,e.hasPCStartTagAttribute=f,e.getPCStyleElements=T,e.getPCLinkStyleElements=y,e.getPCCSSElements=d,e.getPCMetaTags=C,e.getPCMetaName=v,e.traversePCAST=N,e.getStartTag=S,e.getPCElementModifier=R,e.getExpressionPath=h,e.filterPCASTTree=_,e.getPCASTElementsByTagName=A,e.getPCParent=O,e.parseModuleSource=I,e.parseStyleSource=G,e.throwUnexpectedToken=Se,e.assertCurrTokenType=Re,e.assertCurrTokenExists=he,e.bundleVanilla=Pe,e.transpileBlockExpression=$e,e.transpileStyleElement=We,e.loadModuleAST=Ae,e.loadModuleDependencyGraph=Oe,e}({});
