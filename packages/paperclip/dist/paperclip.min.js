window.paperclip=function(e){"use strict";function r(e,r){function n(){this.constructor=e}for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t]);e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}const n=Object.assign||function(e){for(var r,n=1;n<arguments.length;n++){r=arguments[n];for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=r[t])}return e};!function(e){e[e.STRING=0]="STRING",e[e.BLOCK=1]="BLOCK",e[e.STRING_BLOCK=2]="STRING_BLOCK",e[e.ELEMENT=3]="ELEMENT",e[e.SELF_CLOSING_ELEMENT=4]="SELF_CLOSING_ELEMENT",e[e.TEXT_NODE=5]="TEXT_NODE",e[e.COMMENT=6]="COMMENT",e[e.ATTRIBUTE=7]="ATTRIBUTE",e[e.START_TAG=8]="START_TAG",e[e.BLOCK_STRING=9]="BLOCK_STRING",e[e.FRAGMENT=10]="FRAGMENT",e[e.END_TAG=11]="END_TAG"}(e.PCExpressionType||(e.PCExpressionType={})),function(e){e.TYPE="TYPE",e.BIND="BIND",e.IF="IF",e.STRING="STRING",e.OBJECT="OBJECT",e.ARRAY="ARRAY",e.KEY_VALUE_PAIR="KEY_VALUE_PAIR",e.NUMBER="NUMBER",e.PROPERTY="PROPERTY",e.RESERVED_KEYWORD="RESERVED_KEYWORD",e.ELSEIF="ELSEIF",e.NOT="NOT",e.OPERATION="OPERATION",e.GROUP="GROUP",e.VAR_REFERENCE="VAR_REFERENCE",e.PROP_REFERENCE="PROP_REFERENCE",e.ELSE="ELSE",e.REPEAT="REPEAT"}(e.BKExpressionType||(e.BKExpressionType={})),function(e){e[e.SHEET=0]="SHEET",e[e.DECLARATION_PROPERTY=1]="DECLARATION_PROPERTY",e[e.STYLE_RULE=2]="STYLE_RULE",e[e.AT_RULE=3]="AT_RULE",e[e.IMPORT=4]="IMPORT",e[e.CHARSET=5]="CHARSET"}(e.CSSExpressionType||(e.CSSExpressionType={})),function(e){e.COLOR="COLOR",e.CALL="CALL",e.MEASUREMENT="MEASUREMENT",e.SPACED_LIST="SPACED_LIST",e.COMMA_LIST="COMMA_LIST",e.KEYWORD="KEYWORD",e.LIST="LIST"}(e.DcExpressionType||(e.DcExpressionType={}));var t,o=function(r){return r.type==e.PCExpressionType.SELF_CLOSING_ELEMENT?[]:r.childNodes},u=function(r){return r.type==e.PCExpressionType.SELF_CLOSING_ELEMENT?r.name:r.startTag.name},i=function(e){return e.value.value},a=function(e){return S(e).attributes},s=function(e){return S(e).modifiers},c=function(r){return r.type===e.PCExpressionType.ELEMENT||r.type===e.PCExpressionType.ELEMENT||r.type===e.PCExpressionType.START_TAG||r.type===e.PCExpressionType.END_TAG||r.type===e.PCExpressionType.SELF_CLOSING_ELEMENT},p=function(r,n){return A(r,function(r){return r.type===e.PCExpressionType.SELF_CLOSING_ELEMENT?n(r):r.type===e.PCExpressionType.ELEMENT&&n(r.startTag)})},E=function(r){return r.type===e.PCExpressionType.SELF_CLOSING_ELEMENT||r.type==e.PCExpressionType.START_TAG?r:r.startTag},l=function(e,r){if(f(e,r)){var n=E(e).attributes.find(function(e){return e.name===r});return n&&n.value&&n.value.value}},f=function(r,n){return(r.type===e.PCExpressionType.ELEMENT||r.type===e.PCExpressionType.SELF_CLOSING_ELEMENT||r.type===e.PCExpressionType.START_TAG)&&Boolean(E(r).attributes.find(function(e){return e.name===n}))},T=function(r){return A(r,function(r){return r.type===e.PCExpressionType.ELEMENT&&"style"===r.startTag.name})},y=function(r){return A(r,function(r){return r.type===e.PCExpressionType.SELF_CLOSING_ELEMENT&&"link"===r.name&&"stylesheet"===l(r,"rel")})},v=function(e){return T(e).concat(y(e))},d=function(e){return O(e,"meta")},C=function(e){var r=d(e).find(function(e){return Boolean(l(e,"name"))});return r&&l(r,"content")},N=function(e,r,n){if(void 0===n&&(n=[]),!1===r(e,n))return!1;if(e.childNodes)for(var t=e,o=0,u=t.childNodes.length;o<u;o++){var i=t.childNodes[o];if(!1===N(i,r,n.concat(["childNodes",o])))return!1}},S=function(r){return r.type===e.PCExpressionType.ELEMENT?r.startTag:r},R=function(e,r){return S(e).modifiers.find(function(e){return e.value.type===r})},h=function(e,r){var n;return N(r,function(r,t){if(r===e)return n=t,!1}),n},A=function(e,r){var n=[];return N(e,function(e){r(e)&&n.push(e)}),n},O=function(e,r){return p(e,function(e){return e.name===r})},_=function(r,n){return A(r,function(r){return r.childNodes&&r.childNodes.find(function(r){return r===n||n.type===e.PCExpressionType.START_TAG&&r.type===e.PCExpressionType.ELEMENT&&r.startTag===n})})[0]},L=function(e){var r=[];return N(e,function(e){c(e)&&-1===r.indexOf(S(e).name)&&r.push(S(e).name)}),r},m=function(e,r,n){return{type:e,pos:r,value:n}},x={},g=function(e){if(x[e])return x[e];var r=1,n=0,t={};return(e+" ").split("").forEach(function(e,o){t[o]=[n,r],"\n"===e&&(n=0,r++),n++}),x[e]=t},P=function(e,r){var n="number"==typeof e?e:e.pos,t=g(r)[n];return{column:t[0],line:t[1],pos:n}},B=function(e,r,n){return{start:e.line?e:P(e,n),end:r&&r.line?r:P(n.length,n)}},I=function(){function e(e){this._target=e,this.pos=0,this.length=e.length}return e.prototype.curr=function(){return this._target[this.pos]},e.prototype.shift=function(){var e=this._target[this.pos];return this.next(),e},e.prototype.hasNext=function(){return this.pos<this.length-1},e.prototype.next=function(){return this._target[Math.min(this.pos=this.pos+1,this.length)]},e.prototype.prev=function(){return this._target[Math.max(this.pos=this.pos-1,0)]},e.prototype.ended=function(){return this.pos>=this.length},e}(),U=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return r(n,e),n.prototype.scan=function(e){for(var r="";this.pos<this.length;){var n=this._target[this.pos];if(!n.match(e))break;r+=n,this.pos++}return r},n.prototype.match=function(e){var r=this._target.substr(this.pos),n=r.match(e);if(n){var t=n[0];return this.pos+=r.indexOf(t)+t.length,t}return null},n.prototype.peek=function(e){return this._target.substr(this.pos,e)},n.prototype.take=function(e){var r=this._target.substr(this.pos,e);return this.pos+=e,r},n}(I),K=function(e){function n(r,n){var t=e.call(this,n)||this;return t.source=r,t}return r(n,e),n.prototype.peek=function(e){return void 0===e&&(e=1),this._target[this.pos+e]},n.prototype.peekUntil=function(e){for(var r=this.pos;r<this.length-1;)if(e(this._target[++r]))return this._target[r]},n.prototype.curr=function(){return e.prototype.curr.call(this)},n.prototype.next=function(){return e.prototype.next.call(this)},n}(I);!function(e){e[e.LESS_THAN=0]="LESS_THAN",e[e.LESS_THAN_OR_EQUAL=1]="LESS_THAN_OR_EQUAL",e[e.CLOSE_TAG=2]="CLOSE_TAG",e[e.COMMA=3]="COMMA",e[e.GREATER_THAN=4]="GREATER_THAN",e[e.GREATER_THAN_OR_EQUAL=5]="GREATER_THAN_OR_EQUAL",e[e.COMMENT=6]="COMMENT",e[e.BACKSLASH=7]="BACKSLASH",e[e.PERIOD=8]="PERIOD",e[e.BANG=9]="BANG",e[e.AND=10]="AND",e[e.OR=11]="OR",e[e.PLUS=12]="PLUS",e[e.COLON=13]="COLON",e[e.SEMICOLON=14]="SEMICOLON",e[e.MINUS=15]="MINUS",e[e.NUMBER=16]="NUMBER",e[e.AT=17]="AT",e[e.STAR=18]="STAR",e[e.PERCENT=19]="PERCENT",e[e.PAREN_OPEN=20]="PAREN_OPEN",e[e.PAREN_CLOSE=21]="PAREN_CLOSE",e[e.DOUBLE_EQUALS=22]="DOUBLE_EQUALS",e[e.TRIPPLE_EQUELS=23]="TRIPPLE_EQUELS",e[e.NOT_EQUALS=24]="NOT_EQUALS",e[e.NOT_DOUBLE_EQUALS=25]="NOT_DOUBLE_EQUALS",e[e.BRACKET_OPEN=26]="BRACKET_OPEN",e[e.BRACKET_CLOSE=27]="BRACKET_CLOSE",e[e.CURLY_BRACKET_OPEN=28]="CURLY_BRACKET_OPEN",e[e.CURLY_BRACKET_CLOSE=29]="CURLY_BRACKET_CLOSE",e[e.EQUALS=30]="EQUALS",e[e.SINGLE_QUOTE=31]="SINGLE_QUOTE",e[e.HASH=32]="HASH",e[e.DOUBLE_QUOTE=33]="DOUBLE_QUOTE",e[e.TEXT=34]="TEXT",e[e.RESERVED_KEYWORD=35]="RESERVED_KEYWORD",e[e.WHITESPACE=36]="WHITESPACE"}(t||(t={}));var $=function(e){for(var r=new U(e),n=[];!r.ended();){var o=r.curr(),u=void 0;if("<"===o)if("</"===r.peek(2))u=m(t.CLOSE_TAG,r.pos,r.take(2));else if("\x3c!--"===r.peek(4)){for(var i=r.take(4);!r.ended();){var a=r.curr();if("-"===a&&"--\x3e"===r.peek(3)){i+=r.take(3);break}r.next(),i+=a}u=m(t.COMMENT,r.pos,i)}else u="<="===r.peek(2)?m(t.LESS_THAN_OR_EQUAL,r.pos,r.take(2)):m(t.LESS_THAN,r.pos,r.shift());else if("&"===o&&"&&"===r.peek(2))u=m(t.AND,r.pos,r.take(2));else if("|"===o&&"||"===r.peek(2))u=m(t.OR,r.pos,r.take(2));else if(">"===o)u=">="===r.peek(2)?m(t.GREATER_THAN_OR_EQUAL,r.pos,r.take(2)):m(t.GREATER_THAN,r.pos,r.shift());else if("="===o)u="==="===r.peek(3)?m(t.TRIPPLE_EQUELS,r.pos,r.take(3)):"=="===r.peek(2)?m(t.DOUBLE_EQUALS,r.pos,r.take(2)):m(t.EQUALS,r.pos,r.shift());else if(":"===o)u=m(t.COLON,r.pos,r.shift());else if(";"===o)u=m(t.SEMICOLON,r.pos,r.shift());else if("@"===o)u=m(t.AT,r.pos,r.shift());else if(","===o)u=m(t.COMMA,r.pos,r.shift());else if("'"===o)u=m(t.SINGLE_QUOTE,r.pos,r.shift());else if("#"===o)u=m(t.HASH,r.pos,r.shift());else if("!"===o)u="!=="===r.peek(3)?m(t.NOT_DOUBLE_EQUALS,r.pos,r.take(3)):"!="===r.peek(2)?m(t.NOT_EQUALS,r.pos,r.take(2)):m(t.BANG,r.pos,r.shift());else if("/"===o){if("/*"===r.peek(2)){r.match(/.*?\*\//);continue}u=m(t.BACKSLASH,r.pos,r.shift())}else if("."===o)u=/\.\d/.test(r.peek(2))?M(r):m(t.PERIOD,r.pos,r.shift());else if('"'===o)u=m(t.DOUBLE_QUOTE,r.pos,r.shift());else if("+"===o)u=m(t.PLUS,r.pos,r.shift());else if("-"===o)u=/\-\d/.test(r.peek(2))?M(r):m(t.MINUS,r.pos,r.shift());else if("*"===o)u=m(t.STAR,r.pos,r.shift());else if("%"===o)u=m(t.PERCENT,r.pos,r.shift());else if("["===o)u=m(t.BRACKET_OPEN,r.pos,r.shift());else if("]"===o)u=m(t.BRACKET_CLOSE,r.pos,r.shift());else if("("===o)u=m(t.PAREN_OPEN,r.pos,r.shift());else if(")"===o)u=m(t.PAREN_CLOSE,r.pos,r.shift());else if("{"===o)u=m(t.CURLY_BRACKET_OPEN,r.pos,r.shift());else if("}"===o)u=m(t.CURLY_BRACKET_CLOSE,r.pos,r.shift());else if(/\d/.test(o))u=M(r);else if(/[\s\r\n\t]/.test(o))u=m(t.WHITESPACE,r.pos,r.scan(/[\s\r\n\t]/));else{var s=r.scan(/[^-<>,='":@;\.\/\\(){}\[\]\s\r\n\t]/)||r.shift();u=m("undefined"===s?t.RESERVED_KEYWORD:t.TEXT,r.pos,s)}n.push(u)}return new K(e,n)},M=function(e){return m(t.NUMBER,e.pos,e.match(/^\-?(\d+(\.\d+)?|\.\d+)/))},b={},D=function(e){if(b[e])return b[e];var r=$(e);return b[e]=w(r)},G=function(e){if(b[e])return b[e];var r=$(e);return b[e]=ce(r)},w=function(r){for(var n=[];!r.ended();)n.push(Y(r));return 1===n.length?n[0]:{type:e.PCExpressionType.FRAGMENT,location:B(0,r.source.length,r.source),childNodes:n}},Y=function(e){switch(e.curr().type){case t.WHITESPACE:return Ce(e);case t.SINGLE_QUOTE:case t.DOUBLE_QUOTE:return de(e);case t.LESS_THAN:return Te(e);case t.CLOSE_TAG:return fe(e);case t.COMMENT:return ae(e);default:return se(e)?k(e):Ce(e)}},k=function(r){var n=r.curr();r.next(),r.next(),Ne(r);var o=V(r);return Ne(r),he(r,t.BRACKET_CLOSE),r.next(),he(r,t.BRACKET_CLOSE),r.next(),{type:e.PCExpressionType.BLOCK,location:B(n,r.curr(),r.source),value:o}},V=function(r){switch(r.curr().value){case"bind":return ee(r);case"repeat":return te(r);case"if":return ne(r,e.BKExpressionType.IF);case"elseif":return ne(r,e.BKExpressionType.ELSEIF);case"else":return ne(r,e.BKExpressionType.ELSE);case"property":return re(r,e.BKExpressionType.PROPERTY);default:Re(r.source,r.curr())}},F=function(e){return H(e)},H=function(r){var n=Q(r);Ne(r);var o=r.curr(),u=o.type;if(!(u===t.AND||u===t.OR||u==t.PLUS||u===t.MINUS||u===t.STAR||u===t.BACKSLASH||u===t.DOUBLE_EQUALS||u===t.TRIPPLE_EQUELS||u===t.GREATER_THAN||u===t.LESS_THAN||u===t.LESS_THAN_OR_EQUAL||u===t.GREATER_THAN_OR_EQUAL||u===t.NOT_EQUALS||u===t.NOT_DOUBLE_EQUALS))return n;r.next(),Ne(r);var i=H(r);return{type:e.BKExpressionType.OPERATION,left:n,right:i,operator:o.value,location:B(n.location.start,i.location.end,r.source)}},Q=function(e){switch(Ne(e),e.curr().type){case t.BANG:return ie(e);case t.SINGLE_QUOTE:case t.DOUBLE_QUOTE:return j(e);case t.NUMBER:return J(e);case t.CURLY_BRACKET_OPEN:return W(e);case t.BRACKET_OPEN:return X(e);case t.PAREN_OPEN:return z(e);case t.TEXT:return oe(e);case t.RESERVED_KEYWORD:return Z(e);default:Re(e.source,e.curr())}},j=function(r){var n=r.curr();r.next();for(var t="";!r.ended();){var o=r.curr();if(o.value===n.value)break;"\\"!==o.value?(t+=o.value,r.next()):(t+=r.next().value,r.next())}return he(r,n.type),r.next(),{type:e.BKExpressionType.STRING,location:B(n,r.curr(),r.source),value:t}},J=function(r){var n=r.curr();return r.next(),{type:e.BKExpressionType.NUMBER,value:n.value,location:B(n,r.curr(),r.source)}},W=function(r){var n=r.curr();r.next();for(var o=[];!r.ended()&&(Ne(r),r.curr().type!==t.CURLY_BRACKET_CLOSE);){o.push(q(r)),Ne(r);var u=r.curr();u.type!==t.CURLY_BRACKET_CLOSE&&(u.type!==t.COMMA&&u&&Re(r.source,u),r.next())}return he(r,t.CURLY_BRACKET_CLOSE),r.next(),{type:e.BKExpressionType.OBJECT,location:B(n,r.curr(),r.source),properties:o}},X=function(r){var n=r.curr();r.next(),Ne(r);var o=[];if(r.curr().type!==t.BRACKET_CLOSE)for(;;){if(o.push(Q(r)),Ne(r),r.curr().type===t.BRACKET_CLOSE)break;he(r,t.COMMA),r.next()}return he(r,t.BRACKET_CLOSE),r.next(),{type:e.BKExpressionType.ARRAY,location:B(n,r.curr(),r.source),values:o}},q=function(r){var n;switch(r.curr().type){case t.SINGLE_QUOTE:case t.DOUBLE_QUOTE:n=j(r);break;default:n=ue(r)}Ne(r),he(r,t.COLON),r.next(),Ne(r);var o=F(r);return{type:e.BKExpressionType.KEY_VALUE_PAIR,location:B(n.location.start,o.location.end,r.source),key:n.name,value:o}},z=function(r){var n=r.curr();r.next();var t=F(r);return r.next(),{type:e.BKExpressionType.GROUP,value:t,location:B(n,r.curr(),r.source)}},Z=function(r){var n=r.curr();return r.next(),{type:e.BKExpressionType.RESERVED_KEYWORD,value:n.value,location:B(n,r.curr(),r.source)}},ee=function(r){var n=r.curr();return r.next(),r.next(),{type:e.BKExpressionType.BIND,value:F(r),location:B(n,r.curr(),r.source)}},re=function(e,r){var n=e.curr();return e.next(),e.next(),{type:r,name:ue(e).name,location:B(n,e.curr(),e.source)}},ne=function(e,r){var n=e.curr();return e.next(),Ne(e),{type:r,condition:e.curr().type!==t.BRACKET_CLOSE?F(e):null,location:B(n,e.curr(),e.source)}},te=function(r){var n=r.curr();r.next();var t=F(r);Ne(r),r.next();var o,u=ue(r);return","===r.curr().value&&(r.next(),o=ue(r)),{type:e.BKExpressionType.REPEAT,location:B(n,r.curr(),r.source),each:t,asKey:o,asValue:u}},oe=function(r){for(var n=ue(r),o=[n];!r.ended()&&r.curr().type===t.PERIOD;)r.next(),he(r,t.TEXT),o.push(ue(r));return 1===o.length?o[0]:{type:e.BKExpressionType.PROP_REFERENCE,path:o,location:B(n.location.start,r.curr(),r.source)}},ue=function(r){Ne(r);var n=r.curr();return r.next(),{type:e.BKExpressionType.VAR_REFERENCE,name:n.value,location:B(n,r.curr(),r.source)}},ie=function(r){var n=r.curr();return r.next(),{type:e.BKExpressionType.NOT,value:Q(r),location:B(n,r.curr(),r.source)}},ae=function(r){var n=r.curr();return r.next(),{type:e.PCExpressionType.COMMENT,value:n.value.substr(4,n.value.length-7),location:B(n,r.curr(),r.source)}},se=function(e){return e.curr().type===t.BRACKET_OPEN&&e.peek(1).type===t.BRACKET_OPEN},ce=function(r){for(var n=r.curr(),o=[];;){if(Ne(r),r.ended()||r.curr().type===t.CLOSE_TAG)break;o.push(pe(r))}return{type:e.CSSExpressionType.SHEET,children:o,location:B(n,r.curr(),r.source)}},pe=function(e){switch(e.curr().type){case t.AT:return Ee(e);default:return le(e)}},Ee=function(r){var n=r.curr();r.next();for(var o="";r.curr().type!==t.WHITESPACE&&r.curr().type!==t.CURLY_BRACKET_OPEN;)o+=r.curr().value,r.next();r.next();var u=[],i=[];for(Ne(r);!r.ended()&&(Ne(r),r.curr().type!==t.CURLY_BRACKET_OPEN&&r.curr().type!==t.SEMICOLON);)r.curr().type===t.SINGLE_QUOTE||r.curr().type===t.DOUBLE_QUOTE?u.push(j(r).value):(u.push(r.curr().value),r.next());var a=r.curr();if(r.next(),a.type===t.CURLY_BRACKET_OPEN){for(;!r.ended()&&(Ne(r),r.curr().type!==t.CURLY_BRACKET_CLOSE);)i.push(pe(r));he(r,t.CURLY_BRACKET_CLOSE),r.next()}return{type:e.CSSExpressionType.AT_RULE,name:o,params:u,children:i,location:B(n,r.curr(),r.source)}},le=function(r){for(var n=r.curr(),o="";!r.ended();){var u=r.curr();if(u.type==t.CURLY_BRACKET_OPEN||u.type===t.SEMICOLON||u.type===t.CURLY_BRACKET_CLOSE)break;u.type===t.SINGLE_QUOTE||u.type===t.DOUBLE_QUOTE?o+=u.value+j(r).value+u.value:(o+=u.value,r.next())}if(r.curr().type===t.SEMICOLON||r.curr().type===t.CURLY_BRACKET_CLOSE){var i=o.match(/(.+?):(.+)/),a=(i[0],i[1]),s=i[2];return r.curr().type===t.SEMICOLON&&r.next(),{type:e.CSSExpressionType.DECLARATION_PROPERTY,location:B(n,r.curr(),r.source),name:a,value:s}}he(r,t.CURLY_BRACKET_OPEN),r.next();var c=[];for(Ne(r);!r.ended()&&r.curr().type!==t.CURLY_BRACKET_CLOSE;)c.push(le(r)),Ne(r);return he(r,t.CURLY_BRACKET_CLOSE),r.next(),o=o.trim(),{type:e.CSSExpressionType.STYLE_RULE,children:c,selectorText:o,location:B(n,r.curr(),r.source)}},fe=function(r){var n=r.curr();r.next();var o=Se(r);return he(r,t.GREATER_THAN),r.next(),{type:e.PCExpressionType.END_TAG,name:o,location:B(n,r.curr(),r.source)}},Te=function(r){var n=r.curr();he(r,t.LESS_THAN),r.next();for(var o=Se(r),u=[],i=[];!r.ended();){Ne(r);var a=r.curr();if(a.type===t.BACKSLASH||a.type==t.GREATER_THAN)break;se(r)?i.push(k(r)):u.push(ve(r))}if(r.curr().type===t.BACKSLASH)return r.next(),r.next(),{type:e.PCExpressionType.SELF_CLOSING_ELEMENT,name:o,attributes:u,modifiers:i,location:B(n,r.curr(),r.source)};r.next();var s=r.curr(),c=ye(o,r),p=c[0],E=c[1];return{type:e.PCExpressionType.ELEMENT,startTag:{name:o,type:e.PCExpressionType.START_TAG,location:B(n,s,r.source),modifiers:i,attributes:u},childNodes:p,location:B(n,r.curr(),r.source),endTag:E}},ye=function(r,n){var o=[];if("style"===r){var u=ce(n);return Ne(n),he(n,t.CLOSE_TAG),[[u],fe(n)]}if("style"===r||"script"===r){for(var i="",a=n.curr();!n.ended()&&n.curr().type!==t.CLOSE_TAG;)i+=n.curr().value,n.next();return[[{type:e.PCExpressionType.TEXT_NODE,value:i,location:B(a,n.curr(),n.source)}],Y(n)]}for(var s;!n.ended();){var c=Y(n);if(c.type===e.PCExpressionType.END_TAG){s=c;break}o.push(c)}return[o,s]},ve=function(r){var n,o=r.curr(),u=Se(r);return r.curr().type===t.EQUALS&&(r.next(),n=Y(r)),{type:e.PCExpressionType.ATTRIBUTE,name:u,value:n,location:B(o,r.curr(),r.source)}},de=function(r){var n=r.curr(),t=[],o=!1;for(r.next();!r.ended();){var u=r.curr();if(u.type===n.type)break;se(r)?(o=!0,t.push(k(r))):(r.next(),t.push({type:e.PCExpressionType.STRING,value:u.value,location:B(u.pos,r.curr(),r.source)}))}r.next();var i=B(n,r.curr(),r.source);return o?{type:e.PCExpressionType.STRING_BLOCK,location:i,values:t}:{type:e.PCExpressionType.STRING,location:i,value:t.map(function(e){return e.value}).join("")}},Ce=function(r){var n=r.curr();r.next();for(var o=n.value;!r.ended();){var u=r.curr();if(u.type===t.COMMENT||u.type===t.LESS_THAN||u.type==t.CLOSE_TAG||se(r))break;r.next(),o+=u.value}return{type:e.PCExpressionType.TEXT_NODE,value:o,location:B(n,r.curr(),r.source)}},Ne=function(e){for(;e.curr().type===t.WHITESPACE;)e.next()},Se=function(e){for(var r="";e.curr().type!==t.WHITESPACE&&e.curr().type!==t.GREATER_THAN&&e.curr().type!==t.EQUALS;)r+=e.curr().value,e.next();return r},Re=function(e,r){if(!r)throw new Error("Unexpected end of file (missing closing expression).");var n=P(r,e);throw new Error('Unexpected token "'+r.value+'" at '+n.line+":"+n.column)},he=function(e,r){var n=e.curr();n&&n.type===r||Re(e.source,e.curr())},Ae=function(e){e.curr()||Re(e.source,e.curr())};!function(e){e.TANDEM="TANDEM",e.WEB="WEB"}(e.PaperclipTargetType||(e.PaperclipTargetType={}));var Oe=Symbol(),_e=function(e,r){if(e[Oe]&&e[Oe][0]===e)return e[Oe][1];var n=Ke(e,r);return e[Oe]=[e,n],n},Le=function(e,r){var n=r.split("/");n.pop();var t=(e=e.replace("./","")).split("../"),o=t.pop();return n.splice(n.length-t.length,n.length),n.join("/")+"/"+o},me=function(e,r){var n={};return L(e).forEach(function(e){var t=Ie(e,r);t&&(n[e]=t)}),n},xe=function(e,r){var n={};return e.module.components.forEach(function(e){Object.assign(n,me(e.template,r))}),n},ge=function(e,r){return r.components.find(function(r){return r.id===e})},Pe=function(e,r){var n=[],t=(xe(e,r),xe(e,r));for(var o in t){var u=t[o];-1===n.indexOf(u)&&n.push(u)}return n},Be=function(e,r){var n=e.resolvedImportUris,t=[];for(var o in n)t.push(r[n[o]]);return t},Ie=function(e,r){for(var n in r)for(var t=r[n],o=0,u=t.module.components.length;o<u;o++)if(t.module.components[o].id===e)return t},Ue=function(e,r,n){var t=r.readFile,o=r.resolveFile,u=void 0===o?Le:o;return void 0===n&&(n={}),n[e]?Promise.resolve(n):Promise.resolve(t(e)).then(D).then(function(r){return _e(r,e)}).then(function(r){var o={};return n[e]={module:r,resolvedImportUris:o},r.imports.length?Promise.all(r.imports.map(function(r){return Promise.resolve(u(r.href,e)).then(function(e){return o[r.href]=e,Ue(e,{readFile:t,resolveFile:u},n)})})).then(function(){return n}):Promise.resolve(n)}).catch(function(r){throw console.error("Error in "+e),r})},Ke=function(r,n){for(var t=r.type===e.PCExpressionType.FRAGMENT?r.childNodes:[r],i=[],c=[],p=[],E=[],l=0,f=t.length;l<f;l++){var T=t[l];if(T.type===e.PCExpressionType.SELF_CLOSING_ELEMENT||T.type===e.PCExpressionType.ELEMENT){var y=T,v=u(y),d=o(y),C=a(y),N=s(y);if("component"===v){c.push(De(N,C,d));continue}if("link"===v){i.push(Ge(C));continue}if("style"===v){p.push(y);continue}}E.push(T)}return{source:r,uri:n,imports:i,components:c,globalStyles:p,unhandledExpressions:E}},$e=function(e){for(var r={},n=0,t=e.split(/,\s+/g);n<t.length;n++){var o=t[n].split("="),u=o[0],i=o[1];r[u]=i}return r},Me=function(e,r){return e.metadata.filter(function(e){return e.name===r})},be=function(e,r){return Me(e,r).shift()},De=function(r,n,t){for(var s,c,p,E=[],f=r.map(function(e){return e.value}).filter(function(r){return r.type===e.BKExpressionType.PROPERTY}),T=0,y=n.length;T<y;T++){var v=n[T];"id"===v.name&&(s=i(v))}for(var T=0,y=t.length;T<y;T++){var d=t[T];if(d.type===e.PCExpressionType.SELF_CLOSING_ELEMENT||d.type===e.PCExpressionType.ELEMENT){var C=d,N=u(C);a(C),o(C);"style"===N?c=C:"template"===N?p=C:"meta"===N&&E.push({name:l(C,"name"),params:$e(l(C,"content")||"")})}}return{id:s,style:c,metadata:E,properties:f,template:p}},Ge=function(e){for(var r,n,t=0,o=e.length;t<o;t++){var u=e[t];"href"===u.name?r=i(u):"type"===u.name&&(n=i(u))}return{type:n,href:r}},we=function(e,r){return Ue(e,r.io).then(function(r){return{code:Ve(e,r),graph:r,entryDependency:r[e]}})},Ye=function(r){switch(r.type){case e.BKExpressionType.NOT:return"!"+Ye(r.value);case e.BKExpressionType.PROP_REFERENCE:return(t=r).path.map(Ye).join(".");case e.BKExpressionType.STRING:var n=r;return JSON.stringify(n.value);case e.BKExpressionType.NUMBER:return r.value;case e.BKExpressionType.VAR_REFERENCE:var t=r;return t.name;case e.BKExpressionType.ARRAY:return"["+r.values.map(Ye)+"]";case e.BKExpressionType.OBJECT:for(var o=r,u="{",i=0,a=o.properties.length;i<a;i++){var s=o.properties[i];u+=s.key+":"+Ye(s.value)+", "}return u+="}";case e.BKExpressionType.GROUP:return"("+Ye(r.value)+")";case e.BKExpressionType.RESERVED_KEYWORD:return r.value;case e.BKExpressionType.OPERATION:var c=r,p=c.left,E=c.operator,l=c.right;return Ye(p)+" "+E+" "+Ye(l);default:throw new Error("Unable to transpile BK block "+r.type)}},ke=function(e){return e.replace(/[\d-]+/g,"_")},Ve=function(e,r){var n="((window) => {";n+='var document = window.document;const $$each = (object, iterator) => {if (Array.isArray(object)) {object.forEach(iterator);} else {for (const key in object) {iterator(object[key], key);}}};const $$count = (object) => {return Array.isArray(object) ? object.length : Object.keys(object).length;};const $$defineModule = (run) => {let exports;return () => {if (exports) return exports;exports = {};return exports = run((dep) => {return $$modules[dep]()});}};const $$setElementProperty = (element, property, value) => {if (property === "style" && typeof value !== "string") {\nelement.style = "";\nObject.assign(element.style, value);\n} else {\nelement[property] = value;}\n};let updating = false;let toUpdate = [];const $$requestUpdate = (object) => {if (toUpdate.indexOf(object) === -1) {toUpdate.push(object);}if (updating) {return;}updating = true;requestAnimationFrame(function() {for(let i = 0; i < toUpdate.length; i++) {const target = toUpdate[i];target.update();}toUpdate = [];updating = false;});};',n+="$$modules = {};";for(var t in r)n+='$$modules["'+t+'"] = '+Fe(r[t].module,r[t].resolvedImportUris)+";";return n+='const entry = $$modules["'+e+'"]();',n+="return {entry,modules: $$modules};})(window)"},Fe=function(e,r){for(var n=e.source,t=e.imports,o=e.globalStyles,u=e.components,i=(e.unhandledExpressions,{varCount:0,root:n}),a="$$defineModule((require) => {",s=Rr(o,i),c=0,p=s.length;c<p;c++)a+=(l=s[c]).content,a+="document.body.appendChild("+l.varName+");";for(var c=0,p=t.length;c<p;c++){var E=t[c],l=Ar("import","require("+JSON.stringify(r[E.href])+")",i);a+=l.content}for(var c=0,p=u.length;c<p;c++)a+=Qe(u[c],i).content;return a+="return {};",a+="})"},He=function(e){return"(() => { const binding = () => { "+e+" }; binding(); return binding; })()"},Qe=function(e,r){var t=e.id,o=e.style,u=e.template,i=e.properties,a=Or(ke(t),r),s=n({},r,{varCount:0,contextName:"this"}),c=o&&tr(o,s);return{varName:a,bindings:[],content:"class "+a+" extends HTMLElement {constructor() {super();this.$$bindings = [];}connectedCallback() {this.render();}"+i.map(function(e){var r=e.name;return"get "+r+"() {return this.$$"+r+";}set "+r+"(value) {if (this.$$"+r+" === value || String(this.$$"+r+") === String(value)) {return;}const oldValue = this.$"+r+";this.$$"+r+' = value;if (typeof value !== "object") {this.setAttribute('+JSON.stringify(r)+", value);}if (this._rendered) {$$requestUpdate(this);}}"}).join("\n")+'render() {if (this._rendered) {return;}this._rendered = true;const shadow = this.attachShadow({ mode: "open" });'+(c?c.content+"shadow.appendChild("+c.varName+");":"")+i.map(function(e){var r=e.name,n=e.defaultValue;return"if (this.$$"+r+" == null) {this.$$"+r+" = "+(n||'this.getAttribute("'+r+'");')+"}"}).join("\n")+"let $$bindings = [];"+(u?u.childNodes.map(function(e){var r=je(e,s);return e&&r?r.content+(r.bindings.length?"$$bindings = $$bindings.concat("+r.bindings.map(function(e){return"(() => {const $$binding = () => {const { "+i.map(function(e){return e.name}).join(",")+" } = this;"+e+"};$$binding();return $$binding;})()"})+");":"")+"shadow.appendChild("+r.varName+");":""}).join(""):"")+"this.$$bindings = $$bindings;}cloneShallow() {const clone = super.cloneShallow();clone._rendered = true;return clone;}static get observedAttributes() {return "+JSON.stringify(i.map(function(e){return e.name}))+";}attributeChangedCallback(name, oldValue, newValue) {if (super.attributeChangedCallback) {super.attributeChangedCallback(name, oldValue, newValue);}this[name] = newValue;}update() {if (!this._rendered) {return;}let bindings = this.$$bindings || [];"+rr("bindings")+'}}if (!customElements.get("'+t+'")) {customElements.define("'+t+'", '+a+');} else {console.error("Custom element \\"'+t+'\\" is already defined, ignoring");}'}},je=function(r,n){switch(r.type){case e.PCExpressionType.FRAGMENT:return Je(r,n);case e.PCExpressionType.TEXT_NODE:return We(r,n);case e.PCExpressionType.BLOCK:return Xe(r,n);case e.PCExpressionType.ELEMENT:return nr(r,n);case e.PCExpressionType.SELF_CLOSING_ELEMENT:return qe(r,n)}return null},Je=function(e,r){return _r('document.createDocumentFragment("")',r)},We=function(e,r){return _r("document.createTextNode("+JSON.stringify(e.value.replace(/[\s\r\n\t]+/g," "))+")",r)},Xe=function(e,r){var n=_r('document.createTextNode("")',r),t=n.varName+"$$currentValue";return n.content+="let "+t+";",n.bindings.push(er(t,Ye(e.value.value),function(e){return n.varName+".nodeValue = "+e},r)),n},qe=function(e,r){return ze(e,Ze(e,r),r)},ze=function(r,n,t){if(!r.modifiers.length)return n;for(var o,u,i,a,s,p=r.modifiers,E=n,l=0,f=p.length;l<f;l++)(I=p[l].value).type===e.BKExpressionType.IF?o=I:I.type===e.BKExpressionType.ELSE?u=I:I.type===e.BKExpressionType.ELSEIF?i=I:I.type===e.BKExpressionType.REPEAT?a=I:I.type===e.BKExpressionType.BIND&&(s=I);if(s){var T=s.value,y=(E={varName:n.varName,content:n.content,bindings:n.bindings.slice()}).varName+"$$spreadValue",v=Ye(T);E.content+="let "+y+";",E.bindings.push(er(y,v,function(e){return"for (const $$key in "+y+") {$$setElementProperty("+n.varName+", $$key, "+y+"[$$key]);}"},t)),n=E}if(a){var d=a.each,C=a.asKey,N=a.asValue,S=Ye(d),A=C?Ye(C):"index",O=Ye(N),L=mr(t),m=L.fragment,x=L.start,g=L.end,P=(E=m).varName+"$$currentValue",B=E.varName+"$$childBindings";E.content+="let "+P+" = [];let "+B+" = [];",E.bindings.push("let $$newValue = ("+S+") || [];if ($$newValue === "+P+") {return;}const $$oldValue = "+P+";"+P+" = $$newValue;const $$parent = "+x.varName+".parentNode;const $$startIndex = Array.prototype.indexOf.call($$parent.childNodes, "+x.varName+"); const $$newValueCount = $$count($$newValue);const $$oldValueCount = $$count($$oldValue);if ($$newValueCount > $$oldValueCount) {for (let $$i = $$newValueCount - $$oldValueCount; $$i--;) {"+n.content+"$$parent.insertBefore("+n.varName+", "+g.varName+");const $$bindings = ["+n.bindings.map(function(e){return"("+O+", "+A+") => { "+e+"}"}).join(",")+"];"+B+".push(($$newValue, $$newKey) => {"+rr("$$bindings","$$newValue, $$newKey")+"});}} else if ($$oldValue.length < $$newValue.length) {}let i = 0;$$each($$newValue, (value, k) => {"+B+"[i++](value, k);});"),n=E}if(o||i||u){for(var I=o||i||u,U=I.condition,K=t.root===r||t.root.startTag===r?[t.root]:_(t.root,r).childNodes,$=K.findIndex(function(n){return n===r||r.type===e.PCExpressionType.START_TAG&&n.type===e.PCExpressionType.ELEMENT&&n.startTag===r}),M=void 0,l=$+1;l--;){var b=K[l];if(c(b)&&R(b,e.BKExpressionType.IF)){M="condition_"+h(b,t.root).join("");break}}if(!M)throw new Error("Element condition "+e.BKExpressionType[I.type]+" defined without an IF block.");var D=mr(t),m=D.fragment,x=D.start,g=D.end,G=(E=m).varName+"$$bindings",P=E.varName+"$$currentValue";m.content+="let "+G+" = [];let "+P+" = false;",o&&(m.content+="let "+M+" = Infinity;"),E.bindings.push("const newValue = Boolean("+(U?Ye(U):"true")+") && "+M+" >= "+$+";if (newValue) {"+M+" = "+$+";} else if ("+M+" === "+$+") {"+M+" = Infinity;}if (newValue && newValue === "+P+") {if ("+P+") {"+rr(G)+"}return;}"+P+" = newValue;"+G+" = [];if (newValue) {const elementFragment = document.createDocumentFragment();"+n.content+(n.bindings.length?G+" = "+G+".concat("+n.bindings.map(He)+");":"")+"elementFragment.appendChild("+n.varName+");"+g.varName+".parentNode.insertBefore(elementFragment, "+g.varName+");} else {let curr = "+x.varName+".nextSibling;while(curr !== "+g.varName+") {curr.parentNode.removeChild(curr);curr = "+x.varName+".nextSibling;}}")}return E},Ze=function(r,n){for(var t=_r('document.createElement("'+r.name+'")',n),o=0,u=r.attributes.length;o<u;o++)!function(o,u){var i=r.attributes[o],a=i.name,s=i.value,c=ke(a);if(s){if(s.type===e.PCExpressionType.STRING){var p=s;t.content+=t.varName+'.setAttribute("'+a+'", '+JSON.stringify(p.value)+");\n"}else if(s.type===e.PCExpressionType.STRING_BLOCK||s.type===e.PCExpressionType.BLOCK){var E=t.varName+"$$"+c+"$$currentValue";t.content+="let "+E+";\n";var l=void 0;l=s.type===e.PCExpressionType.STRING_BLOCK?er(E,s.values.map(function(r){return r.type===e.PCExpressionType.BLOCK?Ye(r.value.value):JSON.stringify(r.value)}).join(" + "),function(e){return t.varName+'.setAttribute("'+a+'", '+e+")"},n):er(E,Ye(s.value.value),function(e){return"$$setElementProperty("+t.varName+', "'+c+'", '+e+")"},n),t.bindings.push(l)}}else t.content+=t.varName+'.setAttribute("'+a+'", "true");'}(o);return t},er=function(e,r,n,t){return"let $$newValue = "+r+";if ($$newValue !== "+e+") {"+e+" = $$newValue;"+n(e)+"}"},rr=function(e,r){return void 0===r&&(r=""),"for (let i = 0, n = "+e+".length; i < n; i++) {"+e+"[i]("+r+");}"},nr=function(e,r){switch(e.startTag.name){case"style":return tr(e,r);default:return ze(e.startTag,hr(e,r),r)}},tr=function(e,r){var n=_r('document.createElement("style")',r);n.content+="if (window.$synthetic) {";var t=or(e.childNodes[0],r);return n.content+=t.content+(n.varName+".$$setSheet(")+t.varName+");",n.content+="} else {"+n.varName+".textContent = "+JSON.stringify(Nr(e.childNodes[0]))+";}",n},or=function(e,r){var n=ur(e.children,r),t=Lr("new CSSStyleSheet(["+n.map(function(e){return e.varName}).join(",")+"])",r);return t.content=n.map(function(e){return e.content}).join("\n")+t.content,t},ur=function(e,r){return e.map(function(e){return ir(e,r)}).filter(Boolean)},ir=function(r,n){switch(r.type){case e.CSSExpressionType.AT_RULE:return ar(r,n);case e.CSSExpressionType.STYLE_RULE:return dr(r,n)}throw new Error("Unexpected rule "+r.type)},ar=function(e,r){switch(e.name){case"media":return sr(e,r);case"keyframes":return Er(e,r);case"font-face":return cr(e,r);case"import":return Tr(e,r);case"charset":return yr(e,r)}},sr=function(e,r){return lr(e,r,"CSSMediaRule",dr)},cr=function(e,r){return Lr("new CSSFontFaceRule("+Cr(pr(e),r)+")",r)},pr=function(r){return r.children.filter(function(r){return r.type===e.CSSExpressionType.DECLARATION_PROPERTY})},Er=function(e,r){return lr(e,r,"CSSKeyframesRule",fr)},lr=function(e,r,n,t){var o=e.children.map(function(e){return t(e,r)}).filter(Boolean),u=Lr("new "+n+"("+JSON.stringify(e.params.join(" "))+", ["+o.map(function(e){return e.varName}).join(",")+"])",r);return u.content=o.map(function(e){return e.content}).join("\n")+u.content,u},fr=function(e,r){return vr(e,"CSSKeyframeRule",r)},Tr=function(e,r){return null},yr=function(e,r){return null},vr=function(e,r,n){return Lr("new "+r+"("+JSON.stringify(e.selectorText)+", "+Cr(pr(e),n)+")",n)},dr=function(e,r){return vr(e,"CSSStyleRule",r)},Cr=function(e,r){for(var n="{",t=0,o=e;t<o.length;t++){var u=o[t];n+='"'+u.name+'": "'+u.value.replace(/"/g,'\\"').replace(/[\s\r\n\t]+/g," ")+'", '}return"CSSStyleDeclaration.fromObject("+(n+="}")+")"},Nr=function(e,r){return void 0===r&&(r=function(e){return e}),e.children.map(function(e){return Sr(e,r)}).filter(Boolean).join(" ")},Sr=function(r,n){switch(r.type){case e.CSSExpressionType.AT_RULE:var t=r;if("charset"===t.name||"import"===t.name)return null;i="@"+t.name+" "+t.params+" {";return i+=t.children.map(function(e){return Sr(e,n)}).filter(Boolean).join(" "),i+="}";case e.CSSExpressionType.DECLARATION_PROPERTY:var o=r;return o.name+": "+o.value+";";case e.CSSExpressionType.STYLE_RULE:var u=r,i=n(u.selectorText,u)+" {";return i+=u.children.map(function(e){return Sr(e,n)}).filter(Boolean).join(""),i+="}"}},Rr=function(r,n){for(var t=[],o=0,u=r.length;o<u;o++){var i=r[o];if(i.type===e.PCExpressionType.TEXT_NODE&&/^[\s\r\n\t]+$/.test(i.value)){var a=r[o-1],s=r[o+1];if((!a||c(a))&&(!s||c(s)))continue}var p=je(i,n);p&&t.push(p)}return t},hr=function(e,r){for(var n=Ze(e.startTag,r),t=Rr(e.childNodes,r),o=0,u=t.length;o<u;o++){var i=t[o];n.content+=i.content,n.content+=n.varName+".appendChild("+i.varName+");\n",(a=n.bindings).push.apply(a,i.bindings)}return n;var a},Ar=function(e,r,n){var t=Or(e,n);return{varName:t,bindings:[],content:r?"let "+t+" = "+r+";\n":"let "+t+";\n"}},Or=function(e,r){return e+"_"+r.varCount++},_r=function(e,r){return Ar("node",e,r)},Lr=function(e,r){return Ar("rule",e,r)},mr=function(e){var r=_r('document.createDocumentFragment("")',e),n=_r('document.createTextNode("")',e),t=_r('document.createTextNode("")',e);return r.content+=n.content+""+t.content+r.varName+".appendChild("+n.varName+");"+r.varName+".appendChild("+t.varName+");",{fragment:r,start:n,end:t}};!function(e){e[e.OBJECT=1]="OBJECT",e[e.ARRAY=2]="ARRAY",e[e.STRING=4]="STRING",e[e.BOOLEAN=8]="BOOLEAN",e[e.NUMBER=16]="NUMBER",e[e.OPTIONAL=32]="OPTIONAL",e[e.EXTENDABLE=64]="EXTENDABLE",e[e.OBJECT_OR_ARRAY=3]="OBJECT_OR_ARRAY",e[e.ANY_PRIMITIVE=28]="ANY_PRIMITIVE",e[e.EXTENDABLE_OBJECT=65]="EXTENDABLE_OBJECT",e[e.ANY=95]="ANY",e[e.STRING_OR_NUMBER=20]="STRING_OR_NUMBER"}(e.InferredTypeKind||(e.InferredTypeKind={}));var xr={a:{href:e.InferredTypeKind.STRING}},gr={},Pr=function(e,r){var n=r.currentScope[e[0]];return n&&(e=n.concat(e)),e},Br=function(e,r){Pr(e,r);for(var n=r.context,t=0,o=e.length;t<o;t++){var u=e[t];if(!n[1]||!n[1][u])return;n=n[1][u]}return n},Ir=function(e,r,t){return n({},t,{currentScope:n({},t.currentScope,(o={},o[e]=r,o))});var o},Ur=function(e,r){return n({},r,{currentScope:n({},r.currentScope,(t={},t[e]=void 0,t))});var t},Kr=function(e,r,n){if(!e)return n;var t=Mr(n.context,e,r);return $r(t,n)},$r=function(e,r){return n({},r,{context:e})},Mr=function(r,t,o,u){void 0===u&&(u=0);var i=t[u];if(u===t.length)return o.slice();var a=r.slice();r[0]===e.InferredTypeKind.ANY?a=[e.InferredTypeKind.OBJECT,{}]:r[0]&e.InferredTypeKind.ARRAY||(r[0],e.InferredTypeKind.OBJECT);var s=a[1]||{};return a=[a[0],n({},s,(c={},c[i]=Mr(s[i]||[e.InferredTypeKind.OBJECT,s],t,o,u+1),c))];var c},br=function(e,r){for(var n=0,t=e;n<t.length;n++){var o=t[n];r=Kr(o[0],o[1],r)}return r},Dr=function(e,r){return[e,r]},Gr=function(e,r){return void 0===r&&(r=null),[e,r]},wr=function(r){return void 0===r&&(r=Gr(e.InferredTypeKind.OBJECT,{})),{context:r,currentScope:{}}},Yr=function(e){return e[0]},kr=function(e){return e[1]},Vr=function(e){return Fr(e,wr()).context},Fr=function(r,n){switch(void 0===n&&(n=wr()),r.type){case e.PCExpressionType.TEXT_NODE:return n;case e.PCExpressionType.BLOCK:return Qr(r,n);case e.PCExpressionType.FRAGMENT:return en(r.childNodes,n);case e.PCExpressionType.ELEMENT:case e.PCExpressionType.SELF_CLOSING_ELEMENT:return Hr(r,n)}return n},Hr=function(r,n){return n=qr(r,n),R(r,e.BKExpressionType.REPEAT)||(n=en(o(r),n)),n},Qr=function(e,r){return n=Xr(e.value,r),n[0],r=n[1];var n},jr=function(e,r,n){return Jr(e.map(function(e){var n=e[0],t=e[1],o=t[0],u=t[1];return n&&Dr(n,Gr(o&r,u))}),n)},Jr=function(e,r){for(var n=[],t=0,o=e.length;t<o;t++){var u=e[t];r=Kr(u[0],u[1],r),n.push(u)}return[n,r]},Wr=function(e,r,n){return Jr(e.map(function(e){var n=e[0],t=e[1];t[0],t[1];return Dr(n,r)}),n)},Xr=function(r,n){switch(r.type){case e.BKExpressionType.OPERATION:var t=r,o=t.left,u=t.operator,i=t.right,a=void 0,s=void 0;a=(g=Xr(o,n))[0],n=g[1],s=(P=Xr(i,n))[0],n=P[1];var c=a.concat(s);if(/^[\*\/\-%]$/.test(u))for(var p=0,E=c.length;p<E;p++){var l=c[p],f=l[0],T=l[1][0];n=Kr(f,[T&e.InferredTypeKind.NUMBER,null],n)}else{if("+"===u)return Wr(c,Gr(e.InferredTypeKind.ANY),n);if("==="===u||"!=="===u){var y=c.reduce(function(e,r){return e&kr(r)[0]},e.InferredTypeKind.ANY);return Wr(c,Gr(y),n)}}return[c,n];case e.BKExpressionType.STRING:return[[Dr(null,Gr(e.InferredTypeKind.STRING))],n];case e.BKExpressionType.NUMBER:return[[Dr(null,Gr(e.InferredTypeKind.NUMBER))],n];case e.BKExpressionType.VAR_REFERENCE:case e.BKExpressionType.PROP_REFERENCE:var f=r.type===e.BKExpressionType.VAR_REFERENCE?[r.name]:r.path.map(function(e){return e.name}),v=Pr(f,n),d=Br(v,n);return d||(n=Kr(v,d=[e.InferredTypeKind.ANY,null],n)),[[Dr(v,d)],n];case e.BKExpressionType.BIND:return Xr((x=r).value,n);case e.BKExpressionType.OBJECT:for(var C,N=[],S=0,R=(x=r).properties;S<R.length;S++){var h=R[S];C=(B=Xr(h.value,n))[0],n=B[1],N.push.apply(N,C)}return[N,n];case e.BKExpressionType.ARRAY:for(var A,N=[],O=0,_=(x=r).values;O<_.length;O++){var L=_[O];A=(I=Xr(L,n))[0],n=I[1],N.push.apply(N,A)}return[N,n];case e.BKExpressionType.NOT:var m;return U=Xr(r.value,n),m=U[0],n=U[1],[m,n];case e.BKExpressionType.IF:case e.BKExpressionType.ELSEIF:return Xr((x=r).condition,n);case e.BKExpressionType.GROUP:var x=r;return Xr(x.value,n);default:throw new Error("Unexpected expression "+r.type)}var g,P,B,I,U},qr=function(r,n){for(var t,u,i,a=0,s=S(r).modifiers;a<s.length;a++){var c=s[a];c.value.type===e.BKExpressionType.IF?t=c.value:c.value.type===e.BKExpressionType.ELSEIF?u=c.value:c.value.type===e.BKExpressionType.ELSE?c.value:c.value.type===e.BKExpressionType.REPEAT&&(i=c.value)}if(t||u){var p=(t||u).condition;(d=Xr(p,n))[0],n=d[1]}if(i){var E=i.each,l=(i.asKey,i.asValue),f=void 0,T=void 0;T=(C=Xr(E,n))[0],n=C[1],T=(N=jr(T,e.InferredTypeKind.OBJECT_OR_ARRAY,n))[0],n=N[1],f=Xr(l,n)[0];var y=Yr(T[0]),v=Yr(f[0])[0];n=Ir(v,y,n),n=zr(r,n)[1],n=Zr(r,n)[1],n=en(o(r),n),n=Ur(v,n)}else n=zr(r,n)[1],n=Zr(r,n)[1];return n;var d,C,N},zr=function(r,n){void 0===n&&(n=wr());for(var t=S(r),o=a(r),u=[],i=xr[t.name]||gr,s=0,c=o.length;s<c;s++){var p=[],E=o[s],l=E.value,f=E.name;if(l){if(l.type===e.PCExpressionType.BLOCK){p=(y=Xr(l.value.value,n))[0],n=y[1];var T=i[f];T&&(p=(v=jr(p,T,n))[0],n=v[1])}u.push.apply(u,p)}}return[u,n];var y,v},Zr=function(r,n){void 0===n&&(n=wr());S(r);for(var t=s(r),o=[],u=0,i=t.length;u<i;u++){var a=t[u],c=[];if(a.value.type===e.BKExpressionType.BIND){c=(C=Xr(a.value.value,n))[0],n=C[1];for(var p=[],E=0,l=c;E<l.length;E++){var f=l[E],T=f[0],y=f[1],v=(y[0],y[1]),d=[T,[e.InferredTypeKind.EXTENDABLE_OBJECT,v]];p.push(d),n=Kr(d[0],d[1],n)}c=p}o.push.apply(o,c)}return[o,n];var C},en=function(e,r){for(var n=0,t=e;n<t.length;n++){var o=t[n];r=Fr(o,r)}return r},rn=function(e){},nn={},tn=function(e){return nn[e]?nn[e]:nn[e]=on($(e))},on=function(r){for(var n,o=r.curr(),u=[];!r.ended();)u.push(un(r)),n||((n=r.curr())&&n.type!==t.WHITESPACE&&n.type!==t.COMMA&&he(r,t.COMMA),r.next());return 1===u.length?u[0]:{type:n.type===t.WHITESPACE?e.DcExpressionType.SPACED_LIST:e.DcExpressionType.COMMA_LIST,items:u,location:B(o,r.curr(),r.source)}},un=function(e){switch(Ne(e),e.curr().type){case t.SINGLE_QUOTE:case t.DOUBLE_QUOTE:return j(e);case t.HASH:return an(e);case t.NUMBER:return sn(e);case t.MINUS:return e.hasNext()&&e.peek(1).type===t.NUMBER?sn(e):pn(e);case t.TEXT:return pn(e);default:Re(e.source,e.curr())}},an=function(r){for(var n=r.curr(),o="";!r.ended()&&r.curr().type!==t.WHITESPACE;)o+=r.curr().value,r.next();return{type:e.DcExpressionType.COLOR,value:o,location:B(n,r.curr(),r.source)}},sn=function(r){var n=r.curr(),o=cn(r),u="";return r.ended()||r.curr().type===t.WHITESPACE||r.curr().type===t.COMMA||r.curr().type===t.PAREN_CLOSE||(u=r.curr().value,r.next()),{type:e.DcExpressionType.MEASUREMENT,value:o,unit:u,location:B(n,r.curr(),r.source)}},cn=function(e){var r=e.curr().value;return"-"===r&&(r+=e.next().value),e.next(),r},pn=function(r){var n=r.curr(),o=ln(r);return r.ended()||r.curr().type!==t.PAREN_OPEN?{type:e.DcExpressionType.KEYWORD,name:o}:{type:e.DcExpressionType.CALL,name:o,params:En(r),location:B(n,r.curr(),r.source)}},En=function(e){for(var r=[];!e.ended()&&e.curr().type!==t.PAREN_CLOSE;)e.next(),Ne(e),r.push(un(e));return he(e,t.PAREN_CLOSE),e.next(),r},ln=function(e){for(var r="";!e.ended()&&e.curr().type!==t.WHITESPACE&&e.curr().type!==t.PAREN_OPEN&&e.curr().type!==t.PAREN_CLOSE;)r+=e.curr().value,e.next();return r},fn=function(r){switch(r.type){case e.DcExpressionType.SPACED_LIST:return(n=r).items.map(fn).join(" ");case e.DcExpressionType.COMMA_LIST:var n=r;return n.items.map(fn).join(", ");case e.DcExpressionType.KEYWORD:return r.name;case e.DcExpressionType.CALL:var t=r;return t.name+"("+t.params.map(fn).join(", ")+")";case e.DcExpressionType.COLOR:return r.value;case e.BKExpressionType.STRING:return JSON.stringify(r.value);case e.DcExpressionType.MEASUREMENT:var o=r;return""+o.value+o.unit;default:throw new Error("Unable to stringify CSS declaration value type "+r.type)}};return e.getElementChildNodes=o,e.getElementTagName=u,e.getAttributeStringValue=i,e.getElementAttributes=a,e.getElementModifiers=s,e.isTag=c,e.filterPCElementsByStartTag=p,e.getElementStartTag=E,e.getPCStartTagAttribute=l,e.hasPCStartTagAttribute=f,e.getPCStyleElements=T,e.getPCLinkStyleElements=y,e.getPCCSSElements=v,e.getPCMetaTags=d,e.getPCMetaName=C,e.traversePCAST=N,e.getStartTag=S,e.getPCElementModifier=R,e.getExpressionPath=h,e.filterPCASTTree=A,e.getPCASTElementsByTagName=O,e.getPCParent=_,e.getAllChildElementNames=L,e.parseModuleSource=D,e.parseStyleSource=G,e.createString=j,e.eatWhitespace=Ne,e.throwUnexpectedToken=Re,e.assertCurrTokenType=he,e.assertCurrTokenExists=Ae,e.bundleVanilla=we,e.transpileBlockExpression=Ye,e.transpileStyleElement=tr,e.transpileCSSSheet=Nr,e.loadModuleAST=_e,e.defaultResolveModulePath=Le,e.getChildComponentInfo=me,e.getDependencyChildComponentInfo=xe,e.getModuleComponent=ge,e.getUsedDependencies=Pe,e.getImportDependencies=Be,e.getComponentDependency=Ie,e.loadModuleDependencyGraph=Ue,e.parseMetaContent=$e,e.getComponentMetadataItems=Me,e.getComponentMetadataItem=be,e.setSymbolTableEntries=br,e.inferredType=Gr,e.symbolTable=wr,e.inferRootNodeTypes=Vr,e.inferNodeTypes=Fr,e.inferElementAttributeTypes=zr,e.inferElementSpreadTypes=Zr,e.loadComponentTypes=rn,e.parseDeclaration=tn,e.stringifyDeclarationAST=fn,e}({});
