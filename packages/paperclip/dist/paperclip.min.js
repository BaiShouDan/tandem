window.paperclip=function(e){"use strict";function t(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}const n=Object.assign||function(e){for(var t,n=1;n<arguments.length;n++){t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e};!function(e){e[e.STRING=0]="STRING",e[e.BLOCK=1]="BLOCK",e[e.STRING_BLOCK=2]="STRING_BLOCK",e[e.ELEMENT=3]="ELEMENT",e[e.SELF_CLOSING_ELEMENT=4]="SELF_CLOSING_ELEMENT",e[e.TEXT_NODE=5]="TEXT_NODE",e[e.COMMENT=6]="COMMENT",e[e.ATTRIBUTE=7]="ATTRIBUTE",e[e.START_TAG=8]="START_TAG",e[e.BLOCK_STRING=9]="BLOCK_STRING",e[e.FRAGMENT=10]="FRAGMENT",e[e.END_TAG=11]="END_TAG"}(e.PCExpressionType||(e.PCExpressionType={})),function(e){e[e.TYPE=0]="TYPE",e[e.BIND=1]="BIND",e[e.IF=2]="IF",e[e.STRING=3]="STRING",e[e.OBJECT=4]="OBJECT",e[e.ARRAY=5]="ARRAY",e[e.KEY_VALUE_PAIR=6]="KEY_VALUE_PAIR",e[e.NUMBER=7]="NUMBER",e[e.PROPERTY=8]="PROPERTY",e[e.RESERVED_KEYWORD=9]="RESERVED_KEYWORD",e[e.ELSEIF=10]="ELSEIF",e[e.NOT=11]="NOT",e[e.OPERATION=12]="OPERATION",e[e.GROUP=13]="GROUP",e[e.VAR_REFERENCE=14]="VAR_REFERENCE",e[e.PROP_REFERENCE=15]="PROP_REFERENCE",e[e.ELSE=16]="ELSE",e[e.REPEAT=17]="REPEAT"}(e.BKExpressionType||(e.BKExpressionType={})),function(e){e[e.SHEET=0]="SHEET",e[e.DECLARATION_PROPERTY=1]="DECLARATION_PROPERTY",e[e.STYLE_RULE=2]="STYLE_RULE",e[e.AT_RULE=3]="AT_RULE",e[e.IMPORT=4]="IMPORT",e[e.CHARSET=5]="CHARSET"}(e.CSSExpressionType||(e.CSSExpressionType={}));var r,o=function(t){return t.type==e.PCExpressionType.SELF_CLOSING_ELEMENT?[]:t.childNodes},u=function(t){return t.type==e.PCExpressionType.SELF_CLOSING_ELEMENT?t.name:t.startTag.name},i=function(e){return e.value.value},a=function(e){return N(e).attributes},s=function(e){return N(e).modifiers},c=function(t){return t.type===e.PCExpressionType.ELEMENT||t.type===e.PCExpressionType.ELEMENT||t.type===e.PCExpressionType.START_TAG||t.type===e.PCExpressionType.END_TAG||t.type===e.PCExpressionType.SELF_CLOSING_ELEMENT},p=function(t,n){return m(t,function(t){return t.type===e.PCExpressionType.SELF_CLOSING_ELEMENT?n(t):t.type===e.PCExpressionType.ELEMENT&&n(t.startTag)})},E=function(t){return t.type===e.PCExpressionType.SELF_CLOSING_ELEMENT||t.type==e.PCExpressionType.START_TAG?t:t.startTag},l=function(e,t){if(f(e,t)){var n=E(e).attributes.find(function(e){return e.name===t});return n&&n.value&&n.value.value}},f=function(t,n){return(t.type===e.PCExpressionType.ELEMENT||t.type===e.PCExpressionType.SELF_CLOSING_ELEMENT||t.type===e.PCExpressionType.START_TAG)&&Boolean(E(t).attributes.find(function(e){return e.name===n}))},T=function(t){return m(t,function(t){return t.type===e.PCExpressionType.ELEMENT&&"style"===t.startTag.name})},y=function(t){return m(t,function(t){return t.type===e.PCExpressionType.SELF_CLOSING_ELEMENT&&"link"===t.name&&"stylesheet"===l(t,"rel")})},d=function(e){return T(e).concat(y(e))},v=function(e){return _(e,"meta")},C=function(e){var t=v(e).find(function(e){return Boolean(l(e,"name"))});return t&&l(t,"content")},h=function(e,t,n){if(void 0===n&&(n=[]),!1===t(e,n))return!1;if(e.childNodes)for(var r=e,o=0,u=r.childNodes.length;o<u;o++){var i=r.childNodes[o];if(!1===h(i,t,n.concat(["childNodes",o])))return!1}},N=function(t){return t.type===e.PCExpressionType.ELEMENT?t.startTag:t},S=function(e,t){return N(e).modifiers.find(function(e){return e.value.type===t})},R=function(e,t){var n;return h(t,function(t,r){if(t===e)return n=r,!1}),n},m=function(e,t){var n=[];return h(e,function(e){t(e)&&n.push(e)}),n},_=function(e,t){return p(e,function(e){return e.name===t})},A=function(t,n){return m(t,function(t){return t.childNodes&&t.childNodes.find(function(t){return t===n||n.type===e.PCExpressionType.START_TAG&&t.type===e.PCExpressionType.ELEMENT&&t.startTag===n})})[0]},O=function(e){var t=[];return h(e,function(e){c(e)&&-1===t.indexOf(N(e).name)&&t.push(N(e).name)}),t},L=function(e,t,n){return{type:e,pos:t,value:n}},x={},g=function(e){if(x[e])return x[e];var t=1,n=0,r={};return(e+" ").split("").forEach(function(e,o){r[o]=[n,t],"\n"===e&&(n=0,t++),n++}),x[e]=r},P=function(e,t){var n="number"==typeof e?e:e.pos,r=g(t)[n];return{column:r[0],line:r[1],pos:n}},$=function(e,t,n){return{start:e.line?e:P(e,n),end:t&&t.line?t:P(n.length,n)}},B=function(){function e(e){this._target=e,this.pos=0,this.length=e.length}return e.prototype.curr=function(){return this._target[this.pos]},e.prototype.shift=function(){var e=this._target[this.pos];return this.next(),e},e.prototype.hasNext=function(){return this.pos<this.length-1},e.prototype.next=function(){return this._target[Math.min(this.pos=this.pos+1,this.length)]},e.prototype.prev=function(){return this._target[Math.max(this.pos=this.pos-1,0)]},e.prototype.ended=function(){return this.pos>=this.length},e}(),U=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n.prototype.scan=function(e){for(var t="";this.pos<this.length;){var n=this._target[this.pos];if(!n.match(e))break;t+=n,this.pos++}return t},n.prototype.match=function(e){var t=this._target.substr(this.pos),n=t.match(e);if(n){var r=n[0];return this.pos+=t.indexOf(r)+r.length,r}return null},n.prototype.peek=function(e){return this._target.substr(this.pos,e)},n.prototype.take=function(e){var t=this._target.substr(this.pos,e);return this.pos+=e,t},n}(B),b=function(e){function n(t,n){var r=e.call(this,n)||this;return r.source=t,r}return t(n,e),n.prototype.peek=function(e){return void 0===e&&(e=1),this._target[this.pos+e]},n.prototype.peekUntil=function(e){for(var t=this.pos;t<this.length-1;)if(e(this._target[++t]))return this._target[t]},n.prototype.curr=function(){return e.prototype.curr.call(this)},n.prototype.next=function(){return e.prototype.next.call(this)},n}(B);!function(e){e[e.LESS_THAN=0]="LESS_THAN",e[e.LESS_THAN_OR_EQUAL=1]="LESS_THAN_OR_EQUAL",e[e.CLOSE_TAG=2]="CLOSE_TAG",e[e.COMMA=3]="COMMA",e[e.GREATER_THAN=4]="GREATER_THAN",e[e.GREATER_THAN_OR_EQUAL=5]="GREATER_THAN_OR_EQUAL",e[e.COMMENT=6]="COMMENT",e[e.BACKSLASH=7]="BACKSLASH",e[e.PERIOD=8]="PERIOD",e[e.BANG=9]="BANG",e[e.AND=10]="AND",e[e.OR=11]="OR",e[e.PLUS=12]="PLUS",e[e.COLON=13]="COLON",e[e.SEMICOLON=14]="SEMICOLON",e[e.MINUS=15]="MINUS",e[e.NUMBER=16]="NUMBER",e[e.AT=17]="AT",e[e.STAR=18]="STAR",e[e.PERCENT=19]="PERCENT",e[e.PAREN_OPEN=20]="PAREN_OPEN",e[e.PAREN_CLOSE=21]="PAREN_CLOSE",e[e.DOUBLE_EQUALS=22]="DOUBLE_EQUALS",e[e.TRIPPLE_EQUELS=23]="TRIPPLE_EQUELS",e[e.BRACKET_OPEN=24]="BRACKET_OPEN",e[e.BRACKET_CLOSE=25]="BRACKET_CLOSE",e[e.CURLY_BRACKET_OPEN=26]="CURLY_BRACKET_OPEN",e[e.CURLY_BRACKET_CLOSE=27]="CURLY_BRACKET_CLOSE",e[e.EQUALS=28]="EQUALS",e[e.SINGLE_QUOTE=29]="SINGLE_QUOTE",e[e.DOUBLE_QUOTE=30]="DOUBLE_QUOTE",e[e.TEXT=31]="TEXT",e[e.RESERVED_KEYWORD=32]="RESERVED_KEYWORD",e[e.WHITESPACE=33]="WHITESPACE"}(r||(r={}));var K=function(e){for(var t=new U(e),n=[];!t.ended();){var o=t.curr(),u=void 0;if("<"===o)if("</"===t.peek(2))u=L(r.CLOSE_TAG,t.pos,t.take(2));else if("\x3c!--"===t.peek(4)){for(var i=t.take(4);!t.ended();){var a=t.curr();if("-"===a&&"--\x3e"===t.peek(3)){i+=t.take(3);break}t.next(),i+=a}u=L(r.COMMENT,t.pos,i)}else u="<="===t.peek(2)?L(r.LESS_THAN_OR_EQUAL,t.pos,t.take(2)):L(r.LESS_THAN,t.pos,t.shift());else if("&"===o&&"&&"===t.peek(2))u=L(r.AND,t.pos,t.take(2));else if("|"===o&&"||"===t.peek(2))u=L(r.OR,t.pos,t.take(2));else if(">"===o)u=">="===t.peek(2)?L(r.GREATER_THAN_OR_EQUAL,t.pos,t.take(2)):L(r.GREATER_THAN,t.pos,t.shift());else if("="===o)u="==="===t.peek(3)?L(r.TRIPPLE_EQUELS,t.pos,t.take(3)):"=="===t.peek(2)?L(r.DOUBLE_EQUALS,t.pos,t.take(2)):L(r.EQUALS,t.pos,t.shift());else if(":"===o)u=L(r.COLON,t.pos,t.shift());else if(";"===o)u=L(r.SEMICOLON,t.pos,t.shift());else if("@"===o)u=L(r.AT,t.pos,t.shift());else if(","===o)u=L(r.COMMA,t.pos,t.shift());else if("'"===o)u=L(r.SINGLE_QUOTE,t.pos,t.shift());else if("!"===o)u=L(r.BANG,t.pos,t.shift());else if("/"===o){if("/*"===t.peek(2)){t.match(/.*?\*\//);continue}u=L(r.BACKSLASH,t.pos,t.shift())}else if("."===o)u=/\.\d/.test(t.peek(2))?I(t):L(r.PERIOD,t.pos,t.shift());else if('"'===o)u=L(r.DOUBLE_QUOTE,t.pos,t.shift());else if("+"===o)u=L(r.PLUS,t.pos,t.shift());else if("-"===o)u=/\-\d/.test(t.peek(2))?I(t):L(r.MINUS,t.pos,t.shift());else if("*"===o)u=L(r.STAR,t.pos,t.shift());else if("%"===o)u=L(r.PERCENT,t.pos,t.shift());else if("["===o)u=L(r.BRACKET_OPEN,t.pos,t.shift());else if("]"===o)u=L(r.BRACKET_CLOSE,t.pos,t.shift());else if("("===o)u=L(r.PAREN_OPEN,t.pos,t.shift());else if(")"===o)u=L(r.PAREN_CLOSE,t.pos,t.shift());else if("{"===o)u=L(r.CURLY_BRACKET_OPEN,t.pos,t.shift());else if("}"===o)u=L(r.CURLY_BRACKET_CLOSE,t.pos,t.shift());else if(/\d/.test(o))u=I(t);else if(/[\s\r\n\t]/.test(o))u=L(r.WHITESPACE,t.pos,t.scan(/[\s\r\n\t]/));else{var s=t.scan(/[^-<>,='":@;\.\/\\(){}\[\]\s\r\n\t]/)||t.shift();u=L("undefined"===s?r.RESERVED_KEYWORD:r.TEXT,t.pos,s)}n.push(u)}return new b(e,n)},I=function(e){return L(r.NUMBER,e.pos,e.match(/^\-?(\d+(\.\d+)?|\.\d+)/))},M={},G=function(e){if(M[e])return M[e];var t=K(e);return M[e]=D(t)},w=function(e){if(M[e])return M[e];var t=K(e);return M[e]=ce(t)},D=function(t){for(var n=[];!t.ended();)n.push(k(t));return 1===n.length?n[0]:{type:e.PCExpressionType.FRAGMENT,location:$(0,t.source.length,t.source),childNodes:n}},k=function(e){switch(e.curr().type){case r.WHITESPACE:return Ce(e);case r.SINGLE_QUOTE:case r.DOUBLE_QUOTE:return ve(e);case r.LESS_THAN:return Te(e);case r.CLOSE_TAG:return fe(e);case r.COMMENT:return ae(e);default:return se(e)?V(e):Ce(e)}},V=function(t){var n=t.curr();t.next(),t.next(),he(t);var r=Y(t);return he(t),t.next(),t.next(),{type:e.PCExpressionType.BLOCK,location:$(n,t.curr(),t.source),value:r}},Y=function(t){switch(t.curr().value){case"bind":return ee(t);case"repeat":return re(t);case"if":return ne(t,e.BKExpressionType.IF);case"elseif":return ne(t,e.BKExpressionType.ELSEIF);case"else":return ne(t,e.BKExpressionType.ELSE);case"property":return te(t,e.BKExpressionType.PROPERTY);default:Se(t.source,t.curr())}},F=function(e){return H(e)},H=function(t){var n=j(t);he(t);var o=t.curr(),u=o.type;if(!(u===r.AND||u===r.OR||u==r.PLUS||u===r.MINUS||u===r.STAR||u===r.BACKSLASH||u===r.DOUBLE_EQUALS||u===r.TRIPPLE_EQUELS||u===r.GREATER_THAN||u===r.LESS_THAN||u===r.LESS_THAN_OR_EQUAL||u===r.GREATER_THAN_OR_EQUAL))return n;t.next(),he(t);var i=H(t);return{type:e.BKExpressionType.OPERATION,left:n,right:i,operator:o.value,location:$(n.location.start,i.location.end,t.source)}},j=function(e){switch(he(e),e.curr().type){case r.BANG:return ie(e);case r.SINGLE_QUOTE:case r.DOUBLE_QUOTE:return Q(e);case r.NUMBER:return W(e);case r.CURLY_BRACKET_OPEN:return J(e);case r.BRACKET_OPEN:return X(e);case r.PAREN_OPEN:return z(e);case r.TEXT:return oe(e);case r.RESERVED_KEYWORD:return Z(e);default:Se(e.source,e.curr())}},Q=function(t){var n=t.curr();t.next();for(var r="";!t.ended();){var o=t.curr();if(o.value===n.value)break;"\\"!==o.value?(r+=o.value,t.next()):(r+=t.next().value,t.next())}return Re(t,n.type),t.next(),{type:e.BKExpressionType.STRING,location:$(n,t.curr(),t.source),value:r}},W=function(t){var n=t.curr();return t.next(),{type:e.BKExpressionType.NUMBER,value:n.value,location:$(n,t.curr(),t.source)}},J=function(t){var n=t.curr();t.next();for(var o=[];!t.ended()&&(he(t),t.curr().type!==r.CURLY_BRACKET_CLOSE);){o.push(q(t)),he(t);var u=t.curr();u.type!==r.CURLY_BRACKET_CLOSE&&(u.type!==r.COMMA&&u&&Se(t.source,u),t.next())}return Re(t,r.CURLY_BRACKET_CLOSE),t.next(),{type:e.BKExpressionType.OBJECT,location:$(n,t.curr(),t.source),properties:o}},X=function(t){var n=t.curr();t.next(),he(t);var o=[];if(t.curr().type!==r.BRACKET_CLOSE)for(;;){if(o.push(j(t)),he(t),t.curr().type===r.BRACKET_CLOSE)break;Re(t,r.COMMA),t.next()}return Re(t,r.BRACKET_CLOSE),t.next(),{type:e.BKExpressionType.ARRAY,location:$(n,t.curr(),t.source),values:o}},q=function(t){var n;switch(t.curr().type){case r.SINGLE_QUOTE:case r.DOUBLE_QUOTE:n=Q(t);break;default:n=ue(t)}he(t),Re(t,r.COLON),t.next(),he(t);var o=F(t);return{type:e.BKExpressionType.KEY_VALUE_PAIR,location:$(n.location.start,o.location.end,t.source),key:n.name,value:o}},z=function(t){var n=t.curr();t.next();var r=F(t);return t.next(),{type:e.BKExpressionType.GROUP,value:r,location:$(n,t.curr(),t.source)}},Z=function(t){var n=t.curr();return t.next(),{type:e.BKExpressionType.RESERVED_KEYWORD,value:n.value,location:$(n,t.curr(),t.source)}},ee=function(t){var n=t.curr();return t.next(),t.next(),{type:e.BKExpressionType.BIND,value:F(t),location:$(n,t.curr(),t.source)}},te=function(e,t){var n=e.curr();return e.next(),e.next(),{type:t,name:ue(e).name,location:$(n,e.curr(),e.source)}},ne=function(e,t){var n=e.curr();return e.next(),he(e),{type:t,condition:e.curr().type!==r.BRACKET_CLOSE?F(e):null,location:$(n,e.curr(),e.source)}},re=function(t){var n=t.curr();t.next();var r=F(t);he(t),t.next();var o,u=ue(t);return","===t.curr().value&&(t.next(),o=ue(t)),{type:e.BKExpressionType.REPEAT,location:$(n,t.curr(),t.source),each:r,asKey:o,asValue:u}},oe=function(t){for(var n=ue(t),o=[n];!t.ended()&&t.curr().type===r.PERIOD;)t.next(),Re(t,r.TEXT),o.push(ue(t));return 1===o.length?o[0]:{type:e.BKExpressionType.PROP_REFERENCE,path:o,location:$(n.location.start,t.curr(),t.source)}},ue=function(t){he(t);var n=t.curr();return t.next(),{type:e.BKExpressionType.VAR_REFERENCE,name:n.value,location:$(n,t.curr(),t.source)}},ie=function(t){var n=t.curr();return t.next(),{type:e.BKExpressionType.NOT,value:j(t),location:$(n,t.curr(),t.source)}},ae=function(t){var n=t.curr();return t.next(),{type:e.PCExpressionType.COMMENT,value:n.value.substr(4,n.value.length-7),location:$(n,t.curr(),t.source)}},se=function(e){return e.curr().type===r.BRACKET_OPEN&&e.peek(1).type===r.BRACKET_OPEN},ce=function(t){for(var n=t.curr(),o=[];!t.ended()&&t.curr().type!==r.CLOSE_TAG;)o.push(pe(t)),he(t);return{type:e.CSSExpressionType.SHEET,children:o,location:$(n,t.curr(),t.source)}},pe=function(e){switch(he(e),e.curr().type){case r.AT:return Ee(e);default:return le(e)}},Ee=function(t){var n=t.curr();t.next();for(var o="";t.curr().type!==r.WHITESPACE&&t.curr().type!==r.CURLY_BRACKET_OPEN;)o+=t.curr().value,t.next();t.next();var u=[],i=[];for(he(t);!t.ended()&&(he(t),t.curr().type!==r.CURLY_BRACKET_OPEN&&t.curr().type!==r.SEMICOLON);)t.curr().type===r.SINGLE_QUOTE||t.curr().type===r.DOUBLE_QUOTE?u.push(Q(t).value):(u.push(t.curr().value),t.next());var a=t.curr();if(t.next(),a.type===r.CURLY_BRACKET_OPEN){for(;!t.ended()&&(he(t),t.curr().type!==r.CURLY_BRACKET_CLOSE);)i.push(pe(t));Re(t,r.CURLY_BRACKET_CLOSE),t.next()}return{type:e.CSSExpressionType.AT_RULE,name:o,params:u,children:i,location:$(n,t.curr(),t.source)}},le=function(t){for(var n=t.curr(),o="";!t.ended();){var u=t.curr();if(u.type==r.CURLY_BRACKET_OPEN||u.type===r.SEMICOLON||u.type===r.CURLY_BRACKET_CLOSE)break;u.type===r.SINGLE_QUOTE||u.type===r.DOUBLE_QUOTE?o+=u.value+Q(t).value+u.value:(o+=u.value,t.next())}if(t.curr().type===r.SEMICOLON||t.curr().type===r.CURLY_BRACKET_CLOSE){var i=o.match(/(.+?):(.+)/),a=(i[0],i[1]),s=i[2];return t.curr().type===r.SEMICOLON&&t.next(),{type:e.CSSExpressionType.DECLARATION_PROPERTY,location:$(n,t.curr(),t.source),name:a,value:s}}Re(t,r.CURLY_BRACKET_OPEN),t.next();var c=[];for(he(t);!t.ended()&&t.curr().type!==r.CURLY_BRACKET_CLOSE;)c.push(le(t)),he(t);return Re(t,r.CURLY_BRACKET_CLOSE),t.next(),o=o.trim(),{type:e.CSSExpressionType.STYLE_RULE,children:c,selectorText:o,location:$(n,t.curr(),t.source)}},fe=function(t){var n=t.curr();t.next();var o=Ne(t);return Re(t,r.GREATER_THAN),t.next(),{type:e.PCExpressionType.END_TAG,name:o,location:$(n,t.curr(),t.source)}},Te=function(t){var n=t.curr();Re(t,r.LESS_THAN),t.next();for(var o=Ne(t),u=[],i=[];!t.ended();){he(t);var a=t.curr();if(a.type===r.BACKSLASH||a.type==r.GREATER_THAN)break;se(t)?i.push(V(t)):u.push(de(t))}if(t.curr().type===r.BACKSLASH)return t.next(),t.next(),{type:e.PCExpressionType.SELF_CLOSING_ELEMENT,name:o,attributes:u,modifiers:i,location:$(n,t.curr(),t.source)};t.next();var s=t.curr(),c=ye(o,t),p=c[0],E=c[1];return{type:e.PCExpressionType.ELEMENT,startTag:{name:o,type:e.PCExpressionType.START_TAG,location:$(n,s,t.source),modifiers:i,attributes:u},childNodes:p,location:$(n,t.curr(),t.source),endTag:E}},ye=function(t,n){var o=[];if("style"===t){var u=ce(n);return he(n),Re(n,r.CLOSE_TAG),[[u],fe(n)]}if("style"===t||"script"===t){for(var i="",a=n.curr();!n.ended()&&n.curr().type!==r.CLOSE_TAG;)i+=n.curr().value,n.next();return[[{type:e.PCExpressionType.TEXT_NODE,value:i,location:$(a,n.curr(),n.source)}],k(n)]}for(var s;!n.ended();){var c=k(n);if(c.type===e.PCExpressionType.END_TAG){s=c;break}o.push(c)}return[o,s]},de=function(t){var n,o=t.curr(),u=Ne(t);return t.curr().type===r.EQUALS&&(t.next(),n=k(t)),{type:e.PCExpressionType.ATTRIBUTE,name:u,value:n,location:$(o,t.curr(),t.source)}},ve=function(t){var n=t.curr(),r=[],o=!1;for(t.next();!t.ended();){var u=t.curr();if(u.type===n.type)break;se(t)?(o=!0,r.push(V(t))):(t.next(),r.push({type:e.PCExpressionType.STRING,value:u.value,location:$(u.pos,t.curr(),t.source)}))}t.next();var i=$(n,t.curr(),t.source);return o?{type:e.PCExpressionType.STRING_BLOCK,location:i,values:r}:{type:e.PCExpressionType.STRING,location:i,value:r.map(function(e){return e.value}).join("")}},Ce=function(t){var n=t.curr();t.next();for(var o=n.value;!t.ended();){var u=t.curr();if(u.type===r.COMMENT||u.type===r.LESS_THAN||u.type==r.CLOSE_TAG||se(t))break;t.next(),o+=u.value}return{type:e.PCExpressionType.TEXT_NODE,value:o,location:$(n,t.curr(),t.source)}},he=function(e){for(;e.curr().type===r.WHITESPACE;)e.next()},Ne=function(e){for(var t="";e.curr().type!==r.WHITESPACE&&e.curr().type!==r.GREATER_THAN&&e.curr().type!==r.EQUALS;)t+=e.curr().value,e.next();return t},Se=function(e,t){if(!t)throw new Error("Unexpected end of file (missing closing expression).");var n=P(t,e);throw new Error('Unexpected token "'+t.value+'" at '+n.line+":"+n.column)},Re=function(e,t){var n=e.curr();n&&n.type===t||Se(e.source,e.curr())},me=function(e){e.curr()||Se(e.source,e.curr())};!function(e){e.TANDEM="TANDEM",e.WEB="WEB"}(e.PaperclipTargetType||(e.PaperclipTargetType={}));var _e=Symbol(),Ae=function(e,t){if(e[_e]&&e[_e][0]===e)return e[_e][1];var n=be(e,t);return e[_e]=[e,n],n},Oe=function(e,t){var n=t.split("/");n.pop();var r=(e=e.replace("./","")).split("../"),o=r.pop();return n.splice(n.length-r.length,n.length),n.join("/")+"/"+o},Le=function(e,t){var n={};return O(e).forEach(function(e){var r=Be(e,t);r&&(n[e]=r)}),n},xe=function(e,t){var n={};return e.module.components.forEach(function(e){Object.assign(n,Le(e.template,t))}),n},ge=function(e,t){return t.components.find(function(t){return t.id===e})},Pe=function(e,t){var n=[],r=(xe(e,t),xe(e,t));for(var o in r){var u=r[o];-1===n.indexOf(u)&&n.push(u)}return n},$e=function(e,t){var n=e.resolvedImportUris,r=[];for(var o in n)r.push(t[n[o]]);return r},Be=function(e,t){for(var n in t)for(var r=t[n],o=0,u=r.module.components.length;o<u;o++)if(r.module.components[o].id===e)return r},Ue=function(e,t,n){var r=t.readFile,o=t.resolveFile,u=void 0===o?Oe:o;return void 0===n&&(n={}),n[e]?Promise.resolve(n):Promise.resolve(r(e)).then(G).then(function(t){return Ae(t,e)}).then(function(t){var o={};return n[e]={module:t,resolvedImportUris:o},t.imports.length?Promise.all(t.imports.map(function(t){return Promise.resolve(u(t.href,e)).then(function(e){return o[t.href]=e,Ue(e,{readFile:r,resolveFile:u},n)})})).then(function(){return n}):Promise.resolve(n)}).catch(function(t){throw console.error("Error in "+e),t})},be=function(t,n){for(var r=t.type===e.PCExpressionType.FRAGMENT?t.childNodes:[t],i=[],c=[],p=[],E=[],l=0,f=r.length;l<f;l++){var T=r[l];if(T.type===e.PCExpressionType.SELF_CLOSING_ELEMENT||T.type===e.PCExpressionType.ELEMENT){var y=T,d=u(y),v=o(y),C=a(y),h=s(y);if("component"===d){c.push(Ge(h,C,v));continue}if("link"===d){i.push(we(C));continue}if("style"===d){p.push(y);continue}}E.push(T)}return{source:t,uri:n,imports:i,components:c,globalStyles:p,unhandledExpressions:E}},Ke=function(e){for(var t={},n=0,r=e.split(/,\s+/g);n<r.length;n++){var o=r[n].split("="),u=o[0],i=o[1];t[u]=i}return t},Ie=function(e,t){return e.metadata.filter(function(e){return e.name===t})},Me=function(e,t){return Ie(e,t).shift()},Ge=function(t,n,r){for(var s,c,p,E=[],f=t.map(function(e){return e.value}).filter(function(t){return t.type===e.BKExpressionType.PROPERTY}),T=0,y=n.length;T<y;T++){var d=n[T];"id"===d.name&&(s=i(d))}for(var T=0,y=r.length;T<y;T++){var v=r[T];if(v.type===e.PCExpressionType.SELF_CLOSING_ELEMENT||v.type===e.PCExpressionType.ELEMENT){var C=v,h=u(C);a(C),o(C);"style"===h?c=C:"template"===h?p=C:"meta"===h&&E.push({name:l(C,"name"),params:Ke(l(C,"content")||"")})}}return{id:s,style:c,metadata:E,properties:f,template:p}},we=function(e){for(var t,n,r=0,o=e.length;r<o;r++){var u=e[r];"href"===u.name?t=i(u):"type"===u.name&&(n=i(u))}return{type:n,href:t}},De=function(e,t){return Ue(e,t.io).then(function(t){return{code:Ye(e,t),graph:t,entryDependency:t[e]}})},ke=function(t){switch(t.type){case e.BKExpressionType.NOT:return"!"+ke(t.value);case e.BKExpressionType.PROP_REFERENCE:return(r=t).path.map(ke).join(".");case e.BKExpressionType.STRING:var n=t;return JSON.stringify(n.value);case e.BKExpressionType.NUMBER:return t.value;case e.BKExpressionType.VAR_REFERENCE:var r=t;return r.name;case e.BKExpressionType.ARRAY:return"["+t.values.map(ke)+"]";case e.BKExpressionType.OBJECT:for(var o=t,u="{",i=0,a=o.properties.length;i<a;i++){var s=o.properties[i];u+=s.key+":"+ke(s.value)+", "}return u+="}";case e.BKExpressionType.GROUP:return"("+ke(t.value)+")";case e.BKExpressionType.RESERVED_KEYWORD:return t.value;case e.BKExpressionType.OPERATION:var c=t,p=c.left,E=c.operator,l=c.right;return ke(p)+" "+E+" "+ke(l);default:throw new Error("Unable to transpile BK block "+t.type)}},Ve=function(e){return e.replace(/[\d-]+/g,"_")},Ye=function(e,t){var n="((window) => {";n+='var document = window.document;const $$each = (object, iterator) => {if (Array.isArray(object)) {object.forEach(iterator);} else {for (const key in object) {iterator(object[key], key);}}};const $$count = (object) => {return Array.isArray(object) ? object.length : Object.keys(object).length;};const $$defineModule = (run) => {let exports;return () => {if (exports) return exports;exports = {};return exports = run((dep) => {return $$modules[dep]()});}};const $$setElementProperty = (element, property, value) => {if (property === "style" && typeof value !== "string") {\nelement.style = "";\nObject.assign(element.style, value);\n} else {\nelement[property] = value;}\n};let updating = false;let toUpdate = [];const $$requestUpdate = (object) => {if (toUpdate.indexOf(object) === -1) {toUpdate.push(object);}if (updating) {return;}updating = true;requestAnimationFrame(function() {for(let i = 0; i < toUpdate.length; i++) {const target = toUpdate[i];target.update();}toUpdate = [];updating = false;});};',n+="$$modules = {};";for(var r in t)n+='$$modules["'+r+'"] = '+Fe(t[r].module,t[r].resolvedImportUris)+";";return n+='const entry = $$modules["'+e+'"]();',n+="return {entry,modules: $$modules};})(window)"},Fe=function(e,t){var n=e.source,r=e.imports,o=e.globalStyles,u=e.components,i=e.unhandledExpressions,a={varCount:0,root:n},s="$$defineModule((require) => {";s+="$$strays = [];",s+="$$globalStyles = [];";for(var c=Rt(o,a),p=0,E=c.length;p<E;p++)s+=(T=c[p]).content,s+="$$globalStyles.push("+T.varName+");";for(var p=0,E=r.length;p<E;p++){var l=r[p];s+=(T=_t("import","require("+JSON.stringify(t[l.href])+")",a)).content+" $$globalStyles.push(...("+T.varName+".globalStyles || []));"}for(var p=0,E=u.length;p<E;p++)s+=Qe(u[p],a).content;for(var f=Rt(i,a),p=0,E=f.length;p<E;p++){var T=f[p];s+=T.content,s+=T.bindings.map(He).join("\n"),s+="if ("+T.varName+".nodeType != null) {\n",s+="  $$strays.push("+T.varName+");\n",s+="}\n;"}return s+="return {strays: $$strays,globalStyles: $$globalStyles};",s+="})"},He=function(e){return"(() => {"+e+"} )();\n"},je=function(e){return"(() => { const binding = () => { "+e+" }; binding(); return binding; })()"},Qe=function(e,t){var r=e.id,o=e.style,u=e.template,i=e.properties,a=At(Ve(r),t),s=n({},t,{varCount:0,contextName:"this"}),c=o&&ot(o,s);return{varName:a,bindings:[],content:"class "+a+" extends HTMLElement {constructor() {super();this.$$bindings = [];}connectedCallback() {this.render();}"+i.map(function(e){var t=e.name;return"get "+t+"() {return this.$$"+t+";}set "+t+"(value) {if (this.$$"+t+" === value || String(this.$$"+t+") === String(value)) {return;}const oldValue = this.$"+t+";this.$$"+t+' = value;if (typeof value !== "object") {this.setAttribute('+JSON.stringify(t)+", value);}if (this._rendered) {$$requestUpdate(this);}}"}).join("\n")+'render() {if (this._rendered) {return;}this._rendered = true;const shadow = this.attachShadow({ mode: "open" });'+(c?c.content+"shadow.appendChild("+c.varName+");":"")+i.map(function(e){var t=e.name,n=e.defaultValue;return"if (this.$$"+t+" == null) {this.$$"+t+" = "+(n||'this.getAttribute("'+t+'");')+"}"}).join("\n")+"let $$bindings = [];"+(u?u.childNodes.map(function(e){var t=We(e,s);return e&&t?t.content+(t.bindings.length?"$$bindings = $$bindings.concat("+t.bindings.map(function(e){return"(() => {const $$binding = () => {const { "+i.map(function(e){return e.name}).join(",")+" } = this;"+e+"};$$binding();return $$binding;})()"})+");":"")+"shadow.appendChild("+t.varName+");":""}).join(""):"")+"this.$$bindings = $$bindings;}cloneShallow() {const clone = super.cloneShallow();clone._rendered = true;return clone;}static get observedAttributes() {return "+JSON.stringify(i.map(function(e){return e.name}))+";}attributeChangedCallback(name, oldValue, newValue) {if (super.attributeChangedCallback) {super.attributeChangedCallback(name, oldValue, newValue);}this[name] = newValue;}update() {if (!this._rendered) {return;}let bindings = this.$$bindings || [];"+nt("bindings")+'}}if (!customElements.get("'+r+'")) {customElements.define("'+r+'", '+a+');} else {console.error("Custom element \\"'+r+'\\" is already defined, ignoring");}'}},We=function(t,n){switch(t.type){case e.PCExpressionType.FRAGMENT:return Je(t,n);case e.PCExpressionType.TEXT_NODE:return Xe(t,n);case e.PCExpressionType.BLOCK:return qe(t,n);case e.PCExpressionType.ELEMENT:return rt(t,n);case e.PCExpressionType.SELF_CLOSING_ELEMENT:return ze(t,n)}return null},Je=function(e,t){return Ot('document.createDocumentFragment("")',t)},Xe=function(e,t){return Ot("document.createTextNode("+JSON.stringify(e.value.replace(/[\s\r\n\t]+/g," "))+")",t)},qe=function(e,t){var n=Ot('document.createTextNode("")',t),r=n.varName+"$$currentValue";return n.content+="let "+r+";",n.bindings.push(tt(r,ke(e.value.value),function(e){return n.varName+".nodeValue = "+e},t)),n},ze=function(e,t){return Ze(e,et(e,t),t)},Ze=function(t,n,r){if(!t.modifiers.length)return n;for(var o,u,i,a,s,p=t.modifiers,E=n,l=0,f=p.length;l<f;l++)(B=p[l].value).type===e.BKExpressionType.IF?o=B:B.type===e.BKExpressionType.ELSE?u=B:B.type===e.BKExpressionType.ELSEIF?i=B:B.type===e.BKExpressionType.REPEAT?a=B:B.type===e.BKExpressionType.BIND&&(s=B);if(s){var T=s.value,y=(E={varName:n.varName,content:n.content,bindings:n.bindings.slice()}).varName+"$$spreadValue",d=ke(T);E.content+="let "+y+";",E.bindings.push(tt(y,d,function(e){return"for (const $$key in "+y+") {$$setElementProperty("+n.varName+", $$key, "+y+"[$$key]);}"},r)),n=E}if(a){var v=a.each,C=a.asKey,h=a.asValue,N=ke(v),m=C?ke(C):"index",_=ke(h),O=xt(r),L=O.fragment,x=O.start,g=O.end,P=(E=L).varName+"$$currentValue",$=E.varName+"$$childBindings";E.content+="let "+P+" = [];let "+$+" = [];",E.bindings.push("let $$newValue = ("+N+") || [];if ($$newValue === "+P+") {return;}const $$oldValue = "+P+";"+P+" = $$newValue;const $$parent = "+x.varName+".parentNode;const $$startIndex = Array.prototype.indexOf.call($$parent.childNodes, "+x.varName+"); const $$newValueCount = $$count($$newValue);const $$oldValueCount = $$count($$oldValue);if ($$newValueCount > $$oldValueCount) {for (let $$i = $$newValueCount - $$oldValueCount; $$i--;) {"+n.content+"$$parent.insertBefore("+n.varName+", "+g.varName+");const $$bindings = ["+n.bindings.map(function(e){return"("+_+", "+m+") => { "+e+"}"}).join(",")+"];"+$+".push(($$newValue, $$newKey) => {"+nt("$$bindings","$$newValue, $$newKey")+"});}} else if ($$oldValue.length < $$newValue.length) {}let i = 0;$$each($$newValue, (value, k) => {"+$+"[i++](value, k);});"),n=E}if(o||i||u){for(var B=o||i||u,U=B.condition,b=r.root===t||r.root.startTag===t?[r.root]:A(r.root,t).childNodes,K=b.findIndex(function(n){return n===t||t.type===e.PCExpressionType.START_TAG&&n.type===e.PCExpressionType.ELEMENT&&n.startTag===t}),I=void 0,l=K+1;l--;){var M=b[l];if(c(M)&&S(M,e.BKExpressionType.IF)){I="condition_"+R(M,r.root).join("");break}}if(!I)throw new Error("Element condition "+e.BKExpressionType[B.type]+" defined without an IF block.");var G=xt(r),L=G.fragment,x=G.start,g=G.end,w=(E=L).varName+"$$bindings",P=E.varName+"$$currentValue";L.content+="let "+w+" = [];let "+P+" = false;",o&&(L.content+="let "+I+" = Infinity;"),E.bindings.push("const newValue = Boolean("+(U?ke(U):"true")+") && "+I+" >= "+K+";if (newValue) {"+I+" = "+K+";} else if ("+I+" === "+K+") {"+I+" = Infinity;}if (newValue && newValue === "+P+") {if ("+P+") {"+nt(w)+"}return;}"+P+" = newValue;"+w+" = [];if (newValue) {const elementFragment = document.createDocumentFragment();"+n.content+(n.bindings.length?w+" = "+w+".concat("+n.bindings.map(je)+");":"")+"elementFragment.appendChild("+n.varName+");"+g.varName+".parentNode.insertBefore(elementFragment, "+g.varName+");} else {let curr = "+x.varName+".nextSibling;while(curr !== "+g.varName+") {curr.parentNode.removeChild(curr);curr = "+x.varName+".nextSibling;}}")}return E},et=function(t,n){for(var r=Ot('document.createElement("'+t.name+'")',n),o=0,u=t.attributes.length;o<u;o++)!function(o,u){var i=t.attributes[o],a=i.name,s=i.value,c=Ve(a);if(s){if(s.type===e.PCExpressionType.STRING){var p=s;r.content+=r.varName+'.setAttribute("'+a+'", '+JSON.stringify(p.value)+");\n"}else if(s.type===e.PCExpressionType.STRING_BLOCK||s.type===e.PCExpressionType.BLOCK){var E=r.varName+"$$"+c+"$$currentValue";r.content+="let "+E+";\n";var l=void 0;l=s.type===e.PCExpressionType.STRING_BLOCK?tt(E,s.values.map(function(t){return t.type===e.PCExpressionType.BLOCK?ke(t.value.value):JSON.stringify(t.value)}).join(" + "),function(e){return r.varName+'.setAttribute("'+a+'", '+e+")"},n):tt(E,ke(s.value.value),function(e){return"$$setElementProperty("+r.varName+', "'+c+'", '+e+")"},n),r.bindings.push(l)}}else r.content+=r.varName+'.setAttribute("'+a+'", "true");'}(o);return r},tt=function(e,t,n,r){return"let $$newValue = "+t+";if ($$newValue !== "+e+") {"+e+" = $$newValue;"+n(e)+"}"},nt=function(e,t){return void 0===t&&(t=""),"for (let i = 0, n = "+e+".length; i < n; i++) {"+e+"[i]("+t+");}"},rt=function(e,t){switch(e.startTag.name){case"style":return ot(e,t);default:return Ze(e.startTag,mt(e,t),t)}},ot=function(e,t){var n=Ot('document.createElement("style")',t);n.content+="if (window.$synthetic) {";var r=ut(e.childNodes[0],t);return n.content+=r.content+(n.varName+".$$setSheet(")+r.varName+");",n.content+="} else {"+n.varName+".textContent = "+JSON.stringify(Nt(e.childNodes[0]))+";}",n},ut=function(e,t){var n=it(e.children,t),r=Lt("new CSSStyleSheet(["+n.map(function(e){return e.varName}).join(",")+"])",t);return r.content=n.map(function(e){return e.content}).join("\n")+r.content,r},it=function(e,t){return e.map(function(e){return at(e,t)}).filter(Boolean)},at=function(t,n){switch(t.type){case e.CSSExpressionType.AT_RULE:return st(t,n);case e.CSSExpressionType.STYLE_RULE:return Ct(t,n)}throw new Error("Unexpected rule "+t.type)},st=function(e,t){switch(e.name){case"media":return ct(e,t);case"keyframes":return lt(e,t);case"font-face":return pt(e,t);case"import":return yt(e,t);case"charset":return dt(e,t)}},ct=function(e,t){return ft(e,t,"CSSMediaRule",Ct)},pt=function(e,t){return Lt("new CSSFontFaceRule("+ht(Et(e),t)+")",t)},Et=function(t){return t.children.filter(function(t){return t.type===e.CSSExpressionType.DECLARATION_PROPERTY})},lt=function(e,t){return ft(e,t,"CSSKeyframesRule",Tt)},ft=function(e,t,n,r){var o=e.children.map(function(e){return r(e,t)}).filter(Boolean),u=Lt("new "+n+"("+JSON.stringify(e.params.join(" "))+", ["+o.map(function(e){return e.varName}).join(",")+"])",t);return u.content=o.map(function(e){return e.content}).join("\n")+u.content,u},Tt=function(e,t){return vt(e,"CSSKeyframeRule",t)},yt=function(e,t){return null},dt=function(e,t){return null},vt=function(e,t,n){return Lt("new "+t+"("+JSON.stringify(e.selectorText)+", "+ht(Et(e),n)+")",n)},Ct=function(e,t){return vt(e,"CSSStyleRule",t)},ht=function(e,t){for(var n="{",r=0,o=e;r<o.length;r++){var u=o[r];n+='"'+u.name+'": "'+u.value.replace(/"/g,'\\"').replace(/[\s\r\n\t]+/g," ")+'", '}return"CSSStyleDeclaration.fromObject("+(n+="}")+")"},Nt=function(e,t){return void 0===t&&(t=function(e){return e}),e.children.map(function(e){return St(e,t)}).filter(Boolean).join(" ")},St=function(t,n){switch(t.type){case e.CSSExpressionType.AT_RULE:var r=t;if("charset"===r.name||"import"===r.name)return null;i="@"+r.name+" "+r.params+" {";return i+=r.children.map(function(e){return St(e,n)}).filter(Boolean).join(" "),i+="}";case e.CSSExpressionType.DECLARATION_PROPERTY:var o=t;return o.name+": "+o.value+";";case e.CSSExpressionType.STYLE_RULE:var u=t,i=n(u.selectorText,u)+" {";return i+=u.children.map(function(e){return St(e,n)}).filter(Boolean).join(""),i+="}"}},Rt=function(t,n){for(var r=[],o=0,u=t.length;o<u;o++){var i=t[o];if(i.type===e.PCExpressionType.TEXT_NODE&&/^[\s\r\n\t]+$/.test(i.value)){var a=t[o-1],s=t[o+1];if((!a||c(a))&&(!s||c(s)))continue}var p=We(i,n);p&&r.push(p)}return r},mt=function(e,t){for(var n=et(e.startTag,t),r=Rt(e.childNodes,t),o=0,u=r.length;o<u;o++){var i=r[o];n.content+=i.content,n.content+=n.varName+".appendChild("+i.varName+");\n",(a=n.bindings).push.apply(a,i.bindings)}return n;var a},_t=function(e,t,n){var r=At(e,n);return{varName:r,bindings:[],content:t?"let "+r+" = "+t+";\n":"let "+r+";\n"}},At=function(e,t){return e+"_"+t.varCount++},Ot=function(e,t){return _t("node",e,t)},Lt=function(e,t){return _t("rule",e,t)},xt=function(e){var t=Ot('document.createDocumentFragment("")',e),n=Ot('document.createTextNode("")',e),r=Ot('document.createTextNode("")',e);return t.content+=n.content+""+r.content+t.varName+".appendChild("+n.varName+");"+t.varName+".appendChild("+r.varName+");",{fragment:t,start:n,end:r}};return e.getElementChildNodes=o,e.getElementTagName=u,e.getAttributeStringValue=i,e.getElementAttributes=a,e.getElementModifiers=s,e.isTag=c,e.filterPCElementsByStartTag=p,e.getElementStartTag=E,e.getPCStartTagAttribute=l,e.hasPCStartTagAttribute=f,e.getPCStyleElements=T,e.getPCLinkStyleElements=y,e.getPCCSSElements=d,e.getPCMetaTags=v,e.getPCMetaName=C,e.traversePCAST=h,e.getStartTag=N,e.getPCElementModifier=S,e.getExpressionPath=R,e.filterPCASTTree=m,e.getPCASTElementsByTagName=_,e.getPCParent=A,e.getAllChildElementNames=O,e.parseModuleSource=G,e.parseStyleSource=w,e.throwUnexpectedToken=Se,e.assertCurrTokenType=Re,e.assertCurrTokenExists=me,e.bundleVanilla=De,e.transpileBlockExpression=ke,e.transpileStyleElement=ot,e.transpileCSSSheet=Nt,e.loadModuleAST=Ae,e.defaultResolveModulePath=Oe,e.getChildComponentInfo=Le,e.getDependencyChildComponentInfo=xe,e.getModuleComponent=ge,e.getUsedDependencies=Pe,e.getImportDependencies=$e,e.getComponentDependency=Be,e.loadModuleDependencyGraph=Ue,e.parseMetaContent=Ke,e.getComponentMetadataItems=Ie,e.getComponentMetadataItem=Me,e}({});
